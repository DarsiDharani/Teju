<div class="flex h-screen bg-slate-100 font-sans">
  <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col shadow-2xl overflow-hidden z-20">
    <div class="px-6 py-4 text-center border-b border-slate-700/50">
      <div class="relative inline-block mb-4">
        <div
          class="w-20 h-20 bg-slate-700 rounded-full flex items-center justify-center shadow-lg ring-4 ring-slate-800">
          <i class="fa-solid fa-user-shield text-slate-400 text-3xl"></i>
        </div>
        <div class="absolute top-0 right-0 w-6 h-6 bg-green-400 rounded-full border-4 border-slate-900 animate-pulse">
        </div>
      </div>
      <h3 class="text-white text-xl font-semibold">{{ managerDisplayName || 'Manager' }}</h3>
      <p class="text-slate-400 text-sm mt-1">({{ manager?.id || 'N/A' }})</p>
    </div>
    <nav class="flex-1 px-4 py-3 space-y-1 pb-4">
      <button (click)="selectTab('dashboard')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'dashboard',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'dashboard'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-sky-500 to-cyan-400 shadow-md">
          <i class="fa-solid fa-chart-pie"></i>
        </div>
        <span class="font-medium">Dashboard</span>
      </button>
      <button (click)="selectTab('mySkills')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'mySkills',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'mySkills'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-violet-500 to-purple-500 shadow-md">
          <i class="fa-solid fa-graduation-cap"></i>
        </div>
        <span class="font-medium">My Skills</span>
      </button>
      <button (click)="selectTab('teamSkills')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'teamSkills',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'teamSkills'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-rose-500 to-pink-500 shadow-md">
          <i class="fa-solid fa-users"></i>
        </div>
        <span class="font-medium">Team Skills</span>
      </button>
      <button (click)="selectTab('trainingCatalog')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'trainingCatalog',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'trainingCatalog'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-emerald-500 to-green-400 shadow-md">
          <i class="fa-solid fa-book-open"></i>
        </div>
        <span class="font-medium">Training Catalog</span>
      </button>
      <button (click)="selectTab('assignTraining')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'assignTraining',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'assignTraining'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-blue-500 to-indigo-500 shadow-md">
          <i class="fa-solid fa-laptop-code"></i>
        </div>
        <span class="font-medium">Assign Training</span>
      </button>
      <button (click)="selectTab('assignedTrainings')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'assignedTrainings',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'assignedTrainings'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-amber-500 to-yellow-400 shadow-md">
          <i class="fa-solid fa-paperclip"></i>
        </div>
        <span class="font-medium">Assigned Trainings</span>
      </button>
      <button (click)="selectTab('myRequests')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'myRequests',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'myRequests'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-rose-500 to-pink-400 shadow-md">
          <i class="fa-solid fa-clock-rotate-left"></i>
        </div>
        <span class="font-medium">My Requests</span>
      </button>
      <button (click)="selectTab('myBadges')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'myBadges',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'myBadges'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-orange-500 to-amber-400 shadow-md">
          <i class="fa-solid fa-award"></i>
        </div>
        <span class="font-medium">My Badges</span>
      </button>
      <button *ngIf="managerIsTrainer" (click)="selectTab('trainerZone')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'trainerZone',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'trainerZone'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-teal-500 to-cyan-500 shadow-md">
          <i class="fa-solid fa-chalkboard-user"></i>
        </div>
        <span class="font-medium">Trainer Zone</span>
      </button>
      <button (click)="selectTab('levels')"
        class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" [ngClass]="{
          'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'levels',
          'hover:bg-slate-800/50 hover:text-white': activeTab !== 'levels'
        }">
        <div
          class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-indigo-500 to-blue-500 shadow-md">
          <i class="fa-solid fa-layer-group"></i>
        </div>
        <span class="font-medium">Levels</span>
      </button>
    </nav>
  </aside>

  <div class="flex-1 flex flex-col">

    <div *ngIf="activeTab === 'mySkills' || activeTab === 'trainingCatalog' || activeTab === 'assignedTrainings' || activeTab === 'myRequests'"
      class="bg-blue-600 px-6 py-3 shadow-lg rounded-2xl mx-6 mt-4">
      <!-- My Skills Filter Bar: Toggle between core skills and additional skills views -->
      <div *ngIf="activeTab === 'mySkills'" @fadeIn>
        <div class="flex flex-wrap items-center justify-between gap-2">
          <div class="flex items-center gap-4">
            <!-- View Toggle: Switch between Core Skills and Additional Skills -->
            <div class="inline-flex rounded-lg shadow-sm bg-blue-700 p-1">
              <!-- Core Skills Button: Shows job-required skills from API -->
              <button (click)="mySkillsView = 'core'"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-green-300 text-green-800 font-bold shadow': mySkillsView === 'core', 'text-blue-200 hover:bg-blue-500 font-semibold': mySkillsView !== 'core'}">
                <i class="fa-solid fa-briefcase mr-1.5"></i>Core Skills
              </button>
              <!-- Additional Skills Button: Shows self-reported skills -->
              <button (click)="mySkillsView = 'additional'"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-green-300 text-green-800 font-bold shadow': mySkillsView === 'additional', 'text-blue-200 hover:bg-blue-500 font-semibold': mySkillsView !== 'additional'}">
                <i class="fa-solid fa-star mr-1.5"></i>Additional Skills
              </button>
            </div>
          </div>
          <!-- Filter Controls: Search and filter options based on current view -->
          <div class="flex flex-wrap items-center gap-1.5">
            <!-- Core Skills Filters: Skill name filter and status filter -->
            <ng-container *ngIf="mySkillsView === 'core'">
              <!-- Color Code Legend -->
              <div class="text-xs text-blue-100 font-medium flex items-center gap-2">
                <span class="inline-flex items-center gap-1"><span class="w-px h-4 rounded" style="background:#fbbf24;box-shadow:0 0 6px #fbbf24"></span>Expected</span>
                <span class="inline-flex items-center gap-1"><span class="w-4 h-2 rounded" style="background:#10b981"></span>Actual</span>
              </div>
              <!-- Skill Name Filter: Searchable dropdown to filter by specific skill name -->
              <app-searchable-dropdown
                [(ngModel)]="mySkillsSkillFilter"
                [options]="uniqueMySkills"
                placeholder="All Skills"
                allOptionLabel="All Skills"
                allOptionValue=""
                iconClass="fa-filter"
                [multiple]="true"
                width="w-full sm:w-auto min-w-[140px]">
              </app-searchable-dropdown>
              <!-- Status Filter: Searchable dropdown to filter by timeline status (Not Started, Behind, On Track, Completed) -->
              <app-searchable-dropdown
                [(ngModel)]="mySkillsStatusFilter"
                [options]="['Not Started', 'Behind', 'On Track', 'Completed']"
                placeholder="All Statuses"
                allOptionLabel="All Statuses"
                allOptionValue=""
                iconClass="fa-filter"
                [multiple]="true"
                width="w-full sm:w-auto min-w-[140px]">
              </app-searchable-dropdown>
              <!-- Reset Filters Button: Clear all filter selections -->
              <button (click)="resetMySkillsFilters()" title="Reset Filters" class="w-7 h-7 flex items-center justify-center text-blue-200 hover:text-white hover:bg-blue-500 rounded-md transition-colors">
                <i class="fa-solid fa-rotate-right"></i>
              </button>
            </ng-container>
            <!-- Additional Skills Controls: Add new skill button -->
            <ng-container *ngIf="mySkillsView === 'additional'">
              <!-- Toggle Add Skill Form: Show/hide form to add new additional skill -->
              <button (click)="toggleAddSkillForm()"
                class="bg-white/20 hover:bg-white/30 text-white rounded-md px-3 py-1 text-sm font-medium transition-all duration-200 flex items-center gap-2 shadow-sm">
                <i class="fa-solid fa-plus transition-transform duration-300"
                  [ngClass]="{'rotate-45': showAddSkillForm}"></i>
                <span>{{ showAddSkillForm ? 'Cancel' : 'Add Skill' }}</span>
              </button>
            </ng-container>
          </div>
        </div>
      </div>
      <div *ngIf="activeTab === 'trainingCatalog'" @fadeIn>
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-3 flex-shrink-0">
            <h2 class="text-sm font-semibold text-white whitespace-nowrap">Training Catalog</h2>
            <div class="relative">
              <div
                class="bg-indigo-900/50 backdrop-blur-sm rounded-2xl p-1 border border-white/30 ring-1 ring-white/50">
                <div
                  class="absolute top-1 bottom-1 w-1/2 bg-gradient-to-r from-green-300 to-green-300 rounded-xl transition-all duration-500 ease-out shadow-lg"
                  [style.transform]="trainingCatalogType === 'live' ? 'translateX(0)' : 'translateX(100%)'"></div>

                <div class="relative flex">
                  <button (click)="setTrainingCatalogType('live')"
                    class="relative z-10 px-4 py-2 rounded-xl text-xs font-semibold transition-all duration-300 flex items-center gap-2 group"
                    [ngClass]="{
                                    'text-indigo-600': trainingCatalogType === 'live',
                                    'text-white hover:text-blue-200': trainingCatalogType !== 'live'
                                }">
                    <i class="fa-solid fa-video text-sm group-hover:scale-110 transition-transform"></i>
                    <span>Class Trainings</span>
                  </button>
                  <button (click)="setTrainingCatalogType('recorded')"
                    class="relative z-10 px-4 py-2 rounded-xl text-xs font-semibold transition-all duration-300 flex items-center gap-2 group"
                    [ngClass]="{
                                    'text-indigo-600': trainingCatalogType === 'recorded',
                                    'text-white hover:text-blue-200': trainingCatalogType !== 'recorded'
                                }">
                    <i class="fa-solid fa-video-slash text-sm group-hover:scale-110 transition-transform"></i>
                    <span>Recorded</span>
                  </button>
                </div>
              </div>
            </div>
            <div *ngIf="trainingCatalogType === 'live'"
              class="inline-flex rounded-lg shadow-sm bg-blue-700 p-1 flex-shrink-0">
              <button (click)="setTrainingCatalogView('list')"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-emerald-300 text-emerald-800 font-bold shadow': trainingCatalogView === 'list', 'text-blue-200 hover:bg-blue-500 font-semibold': trainingCatalogView !== 'list'}">
                <i class="fa-solid fa-list-ul mr-1.5"></i>List
              </button>
              <button (click)="setTrainingCatalogView('calendar')"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-emerald-300 text-emerald-800 font-bold shadow': trainingCatalogView === 'calendar', 'text-blue-200 hover:bg-blue-500 font-semibold': trainingCatalogView !== 'calendar'}">
                <i class="fa-solid fa-calendar-days mr-1.5"></i>Calendar
              </button>
            </div>
          </div>
          <div class="flex items-center gap-1.5 flex-1 justify-end min-w-0">
            <app-searchable-dropdown [(ngModel)]="catalogTypeFilter" [options]="['Online', 'Offline']"
              placeholder="All Types" allOptionLabel="All Types" allOptionValue="All" iconClass="fa-filter"
              [multiple]="true"
              width="w-auto min-w-[110px] text-xs">
            </app-searchable-dropdown>
            <app-searchable-dropdown [(ngModel)]="catalogCategoryFilter" [options]="skillCategoryLevels"
              placeholder="All Categories" allOptionLabel="All Categories" allOptionValue="All" iconClass="fa-filter"
              [multiple]="true"
              width="w-auto min-w-[100px] text-xs">
            </app-searchable-dropdown>
            <div class="relative">
              <i
                class="fa-solid fa-filter absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-600 text-xs pointer-events-none"></i>
              <i
                class="fa-solid fa-calendar-days absolute right-2.5 top-1/2 -translate-y-1/2 text-slate-600 text-xs pointer-events-none"></i>
              <input type="date" [(ngModel)]="catalogDateFilter"
                class="w-auto min-w-[130px] pl-8 pr-8 py-1 rounded-md border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white text-xs">
            </div>
            <button (click)="resetCatalogFilters()" title="Reset Filters"
              class="w-7 h-7 flex items-center justify-center text-blue-200 hover:text-white hover:bg-blue-500 rounded-md transition-colors flex-shrink-0">
              <i class="fa-solid fa-rotate-right"></i>
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="activeTab === 'assignedTrainings'" @fadeIn>
        <div class="flex flex-wrap items-center justify-between gap-2">
          <div class="flex items-center gap-4">
            <h2 class="text-sm font-semibold text-white">Assigned Trainings</h2>
            <div class="inline-flex rounded-lg shadow-sm bg-blue-700 p-1">
              <button (click)="setAssignedTrainingsView('list')"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-emerald-300 text-emerald-800 font-bold shadow': assignedTrainingsView === 'list', 'text-blue-200 hover:bg-blue-500 font-semibold': assignedTrainingsView !== 'list'}">
                <i class="fa-solid fa-list-ul mr-1.5"></i>List
              </button>
              <button (click)="setAssignedTrainingsView('calendar')"
                class="px-3 py-1 text-xs rounded-md transition-colors duration-200"
                [ngClass]="{'bg-emerald-300 text-emerald-800 font-bold shadow': assignedTrainingsView === 'calendar', 'text-blue-200 hover:bg-blue-500 font-semibold': assignedTrainingsView !== 'calendar'}">
                <i class="fa-solid fa-calendar-days mr-1.5"></i>Calendar
              </button>
            </div>
          </div>
          <div class="flex flex-wrap items-center gap-1.5">
            <app-searchable-dropdown [(ngModel)]="assignedSkillFilter" [options]="uniqueMySkills"
              placeholder="All Skills" allOptionLabel="All Skills" allOptionValue="All" iconClass="fa-filter"
              [multiple]="true"
              width="w-full sm:w-auto min-w-[140px]">
            </app-searchable-dropdown>
            <app-searchable-dropdown [(ngModel)]="assignedLevelFilter" [options]="skillCategoryLevels"
              placeholder="All Levels" allOptionLabel="All Levels" allOptionValue="All" iconClass="fa-filter"
              [multiple]="true"
              width="w-full sm:w-auto min-w-[140px]">
            </app-searchable-dropdown>
            <input type="date" [(ngModel)]="assignedDateFilter"
              class="w-full sm:w-auto px-3 py-1 rounded-md border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white text-sm">
            <button (click)="resetAssignedTrainingFilters()" title="Reset Filters"
              class="w-7 h-7 flex items-center justify-center text-blue-200 hover:text-white hover:bg-blue-500 rounded-md transition-colors">
              <i class="fa-solid fa-rotate-right"></i>
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="activeTab === 'myRequests'" @fadeIn>
        <div class="flex flex-wrap items-center justify-between gap-2">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-clock-rotate-left text-white text-lg"></i>
              <h2 class="text-sm font-semibold text-white">My Training Requests</h2>
            </div>
            <div class="inline-flex rounded-lg shadow-sm bg-blue-700 p-1">
              <button (click)="requestStatusFilter = 'all'"
                class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
                [ngClass]="{'bg-white text-blue-600 shadow': requestStatusFilter === 'all', 'text-blue-200 hover:bg-blue-500': requestStatusFilter !== 'all'}">
                <i class="fa-solid fa-list mr-1.5"></i>All
              </button>
              <button (click)="requestStatusFilter = 'pending'"
                class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
                [ngClass]="{'bg-white text-blue-600 shadow': requestStatusFilter === 'pending', 'text-blue-200 hover:bg-blue-500': requestStatusFilter !== 'pending'}">
                <i class="fa-solid fa-clock mr-1.5"></i>Pending
              </button>
              <button (click)="requestStatusFilter = 'approved'"
                class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
                [ngClass]="{'bg-white text-blue-600 shadow': requestStatusFilter === 'approved', 'text-blue-200 hover:bg-blue-500': requestStatusFilter !== 'approved'}">
                <i class="fa-solid fa-check mr-1.5"></i>Approved
              </button>
              <button (click)="requestStatusFilter = 'rejected'"
                class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
                [ngClass]="{'bg-white text-blue-600 shadow': requestStatusFilter === 'rejected', 'text-blue-200 hover:bg-blue-500': requestStatusFilter !== 'rejected'}">
                <i class="fa-solid fa-times mr-1.5"></i>Rejected
              </button>
            </div>
          </div>
          <div class="flex flex-wrap items-center gap-1.5">
            <div class="relative">
              <i class="fa-solid fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
              <input type="text" [(ngModel)]="requestSearch" placeholder="Search requests..."
                class="w-full sm:w-36 pl-8 pr-3 py-1 rounded-md border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white transition-all duration-300 focus:w-48 text-sm">
            </div>
            <div class="text-xs text-blue-200 font-medium">
              <i class="fa-solid fa-file-lines mr-1"></i>
              <span>{{ getFilteredRequests().length }} Request{{ getFilteredRequests().length !== 1 ? 's' : '' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <main class="flex-1 p-6 overflow-y-auto bg-gradient-to-br from-sky-100 to-cyan-500">
      <div *ngIf="isLoading" class="flex justify-center items-center h-full text-slate-500">
        <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-sky-600" xmlns="http://www.w3.org/2000/svg" fill="none"
          viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        <span class="text-lg">Loading your data...</span>
      </div>

      <div *ngIf="errorMessage" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg" role="alert">
        <strong class="font-bold">Error!</strong>
        <span class="block sm:inline ml-2">{{ errorMessage }}</span>
      </div>

      <div *ngIf="!isLoading && !errorMessage && activeTab === 'dashboard' && manager" class="space-y-6">
        <div #animatedElement class="animate-on-scroll">
          <div class="flex justify-between items-center bg-gradient-to-r from-blue-700 to-blue-700 text-white px-3 py-1.5 rounded-lg shadow-lg backdrop-blur-sm border border-white/10">
            <div class="flex items-center gap-2">
              <h2 class="text-xs font-bold tracking-tight">Welcome, {{ managerDisplayName }}!</h2>
              <div class="w-px h-3 bg-white/20"></div>
            </div>
            <div class="flex items-center gap-2">
              <p class="hidden lg:block text-white/90 text-lg font-bold tracking-tight">
                <b><span *ngIf="dashboardView === 'personal'">Personal development overview</span><span *ngIf="dashboardView === 'team'">Team management overview</span></b>
              </p>
              <div class="relative">
                <div
                  class="bg-indigo-900/50 backdrop-blur-sm rounded-2xl p-1 border border-white/30 ring-1 ring-white/50">
                  <div
                    class="absolute top-1 bottom-1 w-1/2 bg-gradient-to-r from-green-300 to-green-300 rounded-xl transition-all duration-500 ease-out shadow-lg"
                    [style.transform]="dashboardView === 'personal' ? 'translateX(0)' : 'translateX(100%)'"></div>

                  <div class="relative flex">
                    <button (click)="dashboardView = 'personal'"
                      class="relative z-10 px-6 py-2 rounded-xl text-xs font-semibold transition-all duration-300 flex items-center gap-2 group"
                      [ngClass]="{
                        'text-indigo-600': dashboardView === 'personal',
                        'text-white hover:text-blue-200': dashboardView !== 'personal'
                      }">
                      <i class="fa-solid fa-user text-sm group-hover:scale-110 transition-transform"></i>
                      <span>Individual</span>
                    </button>
                    <button (click)="dashboardView = 'team'"
                      class="relative z-10 px-6 py-2 rounded-xl text-xs font-semibold transition-all duration-300 flex items-center gap-2 group"
                      [ngClass]="{
                        'text-indigo-600': dashboardView === 'team',
                        'text-white hover:text-blue-200': dashboardView !== 'team'
                      }">
                      <i class="fa-solid fa-users text-sm group-hover:scale-110 transition-transform"></i>
                      <span>Team</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="dashboardView === 'personal'" @slideFadeIn class="space-y-4">


          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            <div @slideFadeIn
              class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-3 space-y-3">
              <div class="flex-shrink-0">
                <h3 class="text-base font-bold text-slate-900 mb-2 cursor-pointer hover:text-sky-600 transition-colors"
                  title="Skills required for your job role" (click)="openSkillsModal('all')"><b>Core Skills</b></h3>
              </div>
              <div class="flex-1 overflow-y-auto pr-1 min-h-0">
                <div class="grid grid-cols-3 sm:grid-cols-4 gap-2 mb-2" [@listStagger]="sections.length">
                  <div *ngFor="let section of sections"
                    class="group flex flex-col items-center p-1.5 bg-slate-50/70 hover:bg-white rounded-xl transition-all duration-300 text-center border-2 border-transparent hover:border-sky-400 hover:shadow-md">
                    <div
                      class="w-8 h-8 mb-1 rounded-full flex items-center justify-center bg-gradient-to-br from-sky-100 to-sky-50 group-hover:scale-110 transition-transform">
                      <i [ngClass]="getTrainingCardIcon(section.title)" class="text-sky-600"></i>
                    </div>
                    <div class="font-semibold text-slate-800 text-[11px] leading-tight">{{ section.title }}</div>
                  </div>
                </div>
              </div>
              <div class="border-t border-slate-200/80"></div>
              <div class="flex flex-col sm:flex-row items-center gap-3">
                <div class="relative w-24 h-24 flex-shrink-0">
                  <svg class="w-full h-full transform -rotate-90" viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="54" stroke-width="10" fill="none" class="stroke-slate-200/70" />
                    <circle cx="60" cy="60" r="54" stroke-width="10" fill="none"
                      [attr.stroke]="getAvgProgressOnTrack() >= 100 ? '#10b981' : '#0ea5e9'"
                      [attr.stroke-dasharray]="339.29"
                      [attr.stroke-dashoffset]="339.29 - (339.29 * getAvgProgressOnTrack() / 100)"
                      class="transition-all duration-1000 ease-out" stroke-linecap="round"></circle>
                  </svg>
                  <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                      <div class="text-xl font-extrabold text-slate-900">{{ getAvgProgressOnTrack() }}%</div>
                      <p class="text-[10px] text-slate-500 font-medium">On Track</p>
                    </div>
                  </div>
                </div>
                <div class="w-full">
                  <h3 class="text-base font-bold text-slate-900 mb-1 text-center sm:text-left"><b>Skills On Track</b>
                  </h3>
                  <p class="text-sm text-slate-600 text-center sm:text-left"><span
                      class="font-bold text-slate-800">{{ getTeamSkillsOnTrack() }}</span> skills on track with <span
                      class="font-bold text-slate-800">{{ getAvgProgressOnTrack() }}%</span> average progress</p>
                </div>
              </div>
            </div>

            <div @slideFadeIn
              class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-2 flex flex-col h-full">
              <div class="flex-shrink-0">
                <h3 class="text-base font-bold text-slate-900 mb-2"
                  title="Skills you have in addition to your job role."><b>Additional Skills</b></h3>
              </div>
              <div class="flex-1 overflow-y-auto pr-1 min-h-0">
                <div *ngIf="additionalSkills.length > 0; else noAdditionalSkills"
                  class="grid grid-cols-3 sm:grid-cols-4 gap-2" [@listStagger]="additionalSkills.length">
                  <div *ngFor="let skill of additionalSkills"
                    class="group flex flex-col items-center p-1.5 bg-slate-50/70 hover:bg-white rounded-xl transition-all duration-300 text-center border-2 border-transparent hover:border-sky-400 hover:shadow-md">
                    <div
                      class="w-8 h-8 mb-1 rounded-full flex items-center justify-center bg-gradient-to-br from-amber-100 to-amber-50 group-hover:scale-110 transition-transform">
                      <i class="fa-solid fa-star text-amber-600"></i>
                    </div>
                    <div class="font-semibold text-slate-800 text-[11px] leading-tight">{{ skill.skill_name }}</div>
                  </div>
                </div>
                <ng-template #noAdditionalSkills>
                  <div class="text-center py-10 text-slate-500 text-sm">
                    <div class="w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                      <i class="fa-solid fa-plus text-slate-400"></i>
                    </div>
                    No additional skills added yet.
                  </div>
                </ng-template>
              </div>
            </div>

            <div class="flex flex-col h-full space-y-2">
              <div @slideFadeIn
                class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-slate-200/60 p-2 flex-shrink-0">
                <h3 class="text-base font-bold text-slate-900 mb-3"><b>Training Overview</b></h3>
                <div class="grid grid-cols-3 gap-3 text-center">
                  <button (click)="selectTab('trainingCatalog')"
                    class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                    <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-1"><i
                        class="fa-solid fa-book-open text-emerald-600"></i></div>
                    <div class="font-bold text-xl text-slate-900">{{ allTrainings.length }}</div>
                    <div class="text-xs text-slate-500 font-medium">In Catalog</div>
                  </button>
                  <button (click)="selectTab('assignedTrainings')"
                    class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                    <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mx-auto mb-1"><i
                        class="fa-solid fa-paperclip text-amber-600"></i></div>
                    <div class="font-bold text-xl text-slate-900">{{ assignedTrainings.length }}</div>
                    <div class="text-xs text-slate-500 font-medium">Assigned</div>
                  </button>
                  <button (click)="openCompletedTrainingsModal()"
                    class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-1"><i
                        class="fa-solid fa-check-circle text-green-600"></i></div>
                    <div class="font-bold text-xl text-slate-900">{{ dashboardCompletedTrainings.length }}</div>
                    <div class="text-xs text-slate-500 font-medium">Completed</div>
                  </button>
                </div>
              </div>

              <div @slideFadeIn
                class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-slate-200/60 p-2 flex flex-col flex-1 min-h-0">
                <div class="flex-shrink-0">
                  <h3 class="text-base font-bold text-slate-900 mb-2"><b>Upcoming Trainings</b></h3>
                </div>
                <div class="flex-1 overflow-y-auto pr-1 min-h-0">
                  <div *ngIf="dashboardUpcomingTrainings.length > 0; else noUpcomingTrainingsRef" class="space-y-1.5">
                    <div *ngFor="let t of dashboardUpcomingTrainings | slice:0:4"
                      class="flex items-center justify-between p-1.5 bg-slate-50/70 rounded-lg border border-slate-200/80 hover:bg-white transition-colors">
                      <div class="flex items-center gap-2">
                        <div
                          class="w-8 h-8 bg-sky-100 text-sky-600 rounded-md flex items-center justify-center flex-shrink-0">
                          <i class="fa-solid fa-chalkboard-user"></i>
                        </div>
                        <div>
                          <div class="font-semibold text-slate-900 text-xs leading-tight">{{ t.training_name }}</div>
                          <div class="text-[10px] text-slate-500">{{ t.training_date ? (t.training_date |
                            date:'mediumDate') : 'TBD' }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <ng-template #noUpcomingTrainingsRef>
                  <div class="text-center py-6 text-slate-500 text-sm">
                    <div class="text-center py-8 text-slate-500 text-sm">You have no upcoming trainings.</div>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="dashboardView === 'team'" class="space-y-4">
          <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-4">
            <h3 class="text-lg font-bold text-slate-900 mb-2">Team Skills Matrix</h3>
            <div class="overflow-x-auto max-h-[400px] overflow-y-auto">
              <table class="w-full">
                <thead class="sticky top-0 bg-white z-10">
                  <tr class="border-b-2 border-slate-200">
                    <th class="text-left py-1.5 px-2 text-xs font-semibold text-slate-700">Team Member</th>
                    <th class="text-center py-1.5 px-2 text-xs font-semibold text-slate-700">
                      <div class="flex items-center justify-center gap-1">
                        <i class="fa-solid fa-check-circle text-slate-600 text-[10px]"></i>
                        <span>Skills Completed</span>
                      </div>
                    </th>
                    <th class="text-center py-1.5 px-2 text-xs font-semibold text-slate-700">
                      <div class="flex items-center justify-center gap-1">
                        <i class="fa-solid fa-exclamation-triangle text-slate-600 text-[10px]"></i>
                        <span>Skills Behind</span>
                      </div>
                    </th>
                    <th class="text-center py-1.5 px-2 text-xs font-semibold text-slate-700">Total Skills</th>
                    <th class="text-center py-1.5 px-2 text-xs font-semibold text-slate-700">Progress</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let member of manager?.team || []"
                    class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                    <td class="py-1.5 px-2">
                      <div class="flex items-center gap-1.5">
                        <img src="https://ui-avatars.com/api/?name={{member.name}}&background=random&color=fff&size=24"
                          alt="{{member.name}}" class="rounded-full h-6 w-6">
                        <span class="text-xs font-medium text-slate-800">{{ member.name }}</span>
                      </div>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span
                        class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-700 font-bold text-xs">
                        {{ getTeamSkillsMetCount(member) }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span
                        class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-700 font-bold text-xs">
                        {{ getTeamSkillsGapCount(member) }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span class="text-xs font-medium text-slate-600">
                        {{ member.skills.length }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <div class="flex items-center justify-center gap-1.5">
                        <div class="w-16 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                          <div
                            class="h-full bg-gradient-to-r from-green-500 to-green-600 rounded-full transition-all duration-300"
                            [style.width.%]="getMemberProgressPercentage(member)"></div>
                        </div>
                        <span class="text-[10px] font-medium text-slate-600 min-w-[2.5rem]">
                          {{ getMemberProgressPercentage(member) }}%
                        </span>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="!manager?.team || manager.team.length === 0" class="border-b border-slate-100">
                    <td colspan="5" class="py-6 text-center text-slate-500">
                      <i class="fa-solid fa-users text-xl mb-2 block"></i>
                      <p class="text-xs">No team members found</p>
                    </td>
                  </tr>
                </tbody>
                <tfoot class="sticky bottom-0 bg-slate-50">
                  <tr class="bg-slate-50 border-t-2 border-slate-200">
                    <td class="py-1.5 px-2 text-xs font-bold text-slate-800">Total</td>
                    <td class="py-1.5 px-2 text-center">
                      <span
                        class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-700 font-bold text-xs">
                        {{ teamSkillsMet }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span
                        class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-700 font-bold text-xs">
                        {{ teamSkillsGap }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span class="text-xs font-bold text-slate-700">
                        {{ getTotalTeamSkillsCount() }}
                      </span>
                    </td>
                    <td class="py-1.5 px-2 text-center">
                      <span class="text-xs font-bold text-slate-700">
                        {{ getTeamProgressPercentage() }}%
                      </span>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
            <!-- Team Submissions Section -->
            <div
              class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-4 flex flex-col max-h-[500px]">
              <div class="flex items-center justify-between mb-4 flex-shrink-0">
                <div class="flex items-center gap-3">
                  <button (click)="fetchTeamSubmissions()"
                    class="w-8 h-8 bg-indigo-500 hover:bg-indigo-600 rounded-full flex items-center justify-center transition-colors duration-200 shadow-sm"
                    title="Refresh submissions">
                    <i class="fa-solid fa-rotate-right text-white text-sm"></i>
                  </button>
                  <h3 class="text-lg font-bold text-slate-900">Team Training Submissions</h3>
                </div>
                <span *ngIf="!isLoadingSubmissions"
                  class="bg-indigo-100 text-indigo-800 text-xs rounded-full px-2 py-1 font-semibold">
                  {{ teamAssignmentSubmissions.length + teamFeedbackSubmissions.length }}
                </span>
              </div>

              <div *ngIf="isLoadingSubmissions" class="text-center py-6 flex-shrink-0">
                <i class="fa-solid fa-spinner fa-spin text-2xl text-indigo-600 mb-2"></i>
                <p class="text-slate-600 text-sm">Loading...</p>
              </div>

              <div
                *ngIf="!isLoadingSubmissions && teamAssignmentSubmissions.length === 0 && teamFeedbackSubmissions.length === 0"
                class="text-center py-6 flex-shrink-0">
                <i class="fa-solid fa-inbox text-3xl text-slate-400 mb-2"></i>
                <p class="text-slate-600 text-xs">No submissions yet</p>
              </div>

              <div *ngIf="!isLoadingSubmissions" class="space-y-3 overflow-y-auto flex-1 pr-1 submission-scrollbar">
                <!-- Assignment Submissions -->
                <div *ngIf="teamAssignmentSubmissions.length > 0" class="mb-4">
                  <h4 class="text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-file-circle-check text-green-600 text-xs"></i>
                    Assignments ({{ teamAssignmentSubmissions.length }})
                  </h4>
                  <div class="space-y-2">
                    <div *ngFor="let submission of teamAssignmentSubmissions"
                      class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 border border-green-200 hover:shadow-md transition-all">
                      <div class="flex items-start justify-between gap-3">
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center gap-2 mb-1.5 flex-wrap">
                            <h5 class="font-bold text-slate-900 text-sm truncate">{{ submission.training_name }}</h5>
                            <span class="px-2 py-0.5 text-xs font-semibold rounded-full flex-shrink-0" [ngClass]="{
                                    'bg-green-100 text-green-700': submission.score >= 70,
                                    'bg-yellow-100 text-yellow-700': submission.score >= 50 && submission.score < 70,
                                    'bg-red-100 text-red-700': submission.score < 50
                                  }">
                              {{ submission.score || 0 }}%
                            </span>
                          </div>
                          <p class="text-xs text-slate-600 mb-1">
                            <i class="fa-solid fa-user mr-1"></i>
                            <span class="font-medium">{{ submission.employee_name }}</span>
                            <span class="mx-1">•</span>
                            <span>{{ submission.correct_answers || 0 }}/{{ submission.total_questions || 0 }}
                              correct</span>
                            <span class="mx-1">•</span>
                            <span>Feedback: {{ submission.feedback_count || 0 }}/1</span>
                          </p>
                          <p class="text-xs text-slate-500">
                            <i class="fa-solid fa-clock mr-1"></i>
                            {{ submission.submitted_at | date:'short' }}
                          </p>
                        </div>
                        <div class="flex flex-col gap-2 flex-shrink-0">
                          <button (click)="openFeedbackModal(submission, 'assignment')"
                            class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-semibold rounded-lg transition-colors duration-200 flex items-center gap-1.5 shadow-sm">
                            <i class="fa-solid fa-comment-dots"></i>
                            {{ submission.has_feedback ? 'Update Feedback' : 'Provide Feedback' }}
                          </button>
                          <button *ngIf="submission.has_feedback" (click)="openFinalEvaluationFromCard(submission)"
                            class="px-3 py-1.5 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white text-xs font-semibold rounded-lg transition-all duration-200 flex items-center gap-1.5 shadow-sm">
                            <i class="fa-solid fa-trophy"></i>
                            Final Evaluation
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Feedback Submissions -->
                <div *ngIf="teamFeedbackSubmissions.length > 0">
                  <h4 class="text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-comment-dots text-amber-600 text-xs"></i>
                    Feedback ({{ teamFeedbackSubmissions.length }})
                  </h4>
                  <div class="space-y-2">
                    <div *ngFor="let submission of teamFeedbackSubmissions"
                      class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-3 border border-amber-200 hover:shadow-md transition-all">
                      <div class="flex items-start justify-between">
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center gap-2 mb-1.5 flex-wrap">
                            <h5 class="font-bold text-slate-900 text-sm truncate">{{ submission.training_name }}</h5>
                            <span
                              class="px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-700 rounded-full flex-shrink-0">
                              {{ submission.responses.length }}
                            </span>
                          </div>
                          <p class="text-xs text-slate-500 mb-2">
                            <i class="fa-solid fa-clock mr-1"></i>
                            {{ submission.submitted_at | date:'short' }}
                          </p>
                          <details class="mt-1">
                            <summary class="text-xs font-medium text-indigo-600 cursor-pointer hover:text-indigo-700">
                              View Responses
                            </summary>
                            <div class="mt-2 space-y-1.5 pl-3 border-l-2 border-amber-300">
                              <div *ngFor="let response of submission.responses" class="bg-white rounded p-2 text-xs">
                                <p class="font-medium text-slate-800 mb-0.5">{{ response.questionText }}</p>
                                <p class="text-slate-600">
                                  <span class="font-semibold text-amber-700">Answer:</span> {{ response.selectedOption
                                  }}
                                </p>
                              </div>
                            </div>
                          </details>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-4 flex flex-col max-h-[500px]">
              <div class="flex items-center justify-between mb-4 flex-shrink-0">
                <div class="flex items-center gap-3">
                  <button (click)="fetchPendingRequests()"
                    class="w-8 h-8 bg-orange-500 hover:bg-orange-600 rounded-full flex items-center justify-center transition-colors duration-200 shadow-sm"
                    title="Refresh pending requests">
                    <i class="fa-solid fa-rotate-right text-white text-sm"></i>
                  </button>
                  <h3 class="text-lg font-bold text-slate-900">Pending Training Requests</h3>
                  <span class="bg-red-100 text-red-800 text-xs rounded-full px-2 py-1 font-semibold">
                    {{ pendingRequests.length }} pending
                  </span>
                </div>
              </div>

              <div *ngIf="pendingRequests.length > 0; else noRequests"
                class="space-y-2 max-w-sm overflow-y-auto flex-1 pr-1 submission-scrollbar">
                <div *ngFor="let request of pendingRequests"
                  class="bg-white rounded-lg shadow-md border border-slate-200 p-2.5 hover:shadow-lg transition-all duration-300">

                  <div class="flex items-start justify-between mb-1.5">
                    <div class="flex items-start gap-2">
                      <div
                        class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-magnifying-glass text-sm"></i>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-1.5 mb-0.5">
                          <h4 class="text-xs font-bold text-slate-800 truncate">{{ request.training.training_name }}
                          </h4>
                          <span
                            class="inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-semibold bg-orange-100 text-orange-800 flex-shrink-0">
                            <i class="fa-solid fa-clock mr-0.5"></i>Pending
                          </span>
                        </div>
                        <p class="text-[10px] text-slate-500 mb-0.5">by {{ request.training.trainer_name }}</p>
                        <p class="text-[10px] font-semibold text-blue-600">
                          <i class="fa-solid fa-user mr-0.5"></i>
                          {{ request.employee?.name || request.employee?.username || 'Unknown' }}
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="space-y-1 mb-1.5">
                    <div class="flex items-center gap-1 flex-wrap">
                      <span
                        class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-700">
                        <i class="fa-solid fa-display mr-0.5 text-[9px]"></i>{{ request.training.training_type ||
                        'N/A'
                        }}
                      </span>
                      <span *ngIf="request.training.skill_category"
                        class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-700">
                        <i class="fa-solid fa-layer-group mr-0.5 text-[9px]"></i>{{ request.training.skill_category }}
                      </span>
                      <span *ngIf="request.training.skill"
                        class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-700">
                        <i class="fa-solid fa-code mr-0.5 text-[9px]"></i>{{ request.training.skill }}
                      </span>
                    </div>

                    <div class="text-[10px] text-slate-600 space-y-0.5">
                      <p><strong>Requested:</strong> {{ request.request_date | date:'mediumDate' }}</p>
                      <p *ngIf="request.training.training_date"><strong>Training Date:</strong> {{
                        request.training.training_date | date:'mediumDate' }}</p>
                      <p *ngIf="request.training.duration"><strong>Duration:</strong> {{ request.training.duration }}
                      </p>
                    </div>
                  </div>

                  <div class="flex gap-1.5 pt-1.5 border-t border-slate-200">
                    <button (click)="respondToRequestById(request.id, 'approved')"
                      class="flex-1 bg-green-600 hover:bg-green-700 text-white text-[10px] font-semibold py-1.5 px-2 rounded transition-colors duration-200 flex items-center justify-center gap-1">
                      <i class="fa-solid fa-check text-[9px]"></i> Approve
                    </button>
                    <button (click)="respondToRequestById(request.id, 'rejected')"
                      class="flex-1 bg-red-600 hover:bg-red-700 text-white text-[10px] font-semibold py-1.5 px-2 rounded transition-colors duration-200 flex items-center justify-center gap-1">
                      <i class="fa-solid fa-times text-[9px]"></i> Reject
                    </button>
                  </div>
                </div>
              </div>

              <ng-template #noRequests>
                <div class="text-center py-12 bg-slate-50 rounded-xl border-2 border-dashed border-slate-300">
                  <div
                    class="w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-inbox text-slate-400 text-2xl"></i>
                  </div>
                  <h4 class="text-lg font-bold text-slate-800 mb-2">No Pending Requests</h4>
                  <p class="text-slate-600 text-sm">There are no pending training requests from your team members at
                    the
                    moment.</p>
                </div>
              </ng-template>
            </div>
          </div>

        </div>
      </div>

      <div *ngIf="activeTab !== 'dashboard'">
        <div *ngIf="activeTab === 'mySkills'" @slideFadeIn class="space-y-8">
          <div *ngIf="mySkillsView === 'core'" @fadeIn class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
              [@listStagger]="(getFilteredMySkills() | skillFilter:mySkillsSearch:'').length">
              <div *ngFor="let competency of getFilteredMySkills() | skillFilter:mySkillsSearch:''"
                class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border hover:shadow-lg hover:-translate-y-1 transition-all duration-300"
                [ngClass]="{
                                    'border-slate-300/80': getTimelineStatus(competency) === 'Not Started',
                                    'border-orange-300/80': getTimelineStatus(competency) === 'Behind',
                                    'border-green-300/80': getTimelineStatus(competency) === 'On Track' || getTimelineStatus(competency) === 'Completed'
                                }">
                <div class="flex flex-col justify-between h-full space-y-3">
                  <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-3">
                      <div
                        class="w-10 h-10 bg-sky-100 text-sky-600 rounded-lg flex items-center justify-center text-lg flex-shrink-0">
                        <i [ngClass]="getTrainingCardIcon(competency.skill)"></i>
                      </div>
                      <div>
                        <h3 class="font-bold text-base text-slate-800 leading-tight">{{ competency.skill }}</h3>
                        <p class="text-xs text-slate-500">{{ competency.competency }}</p>
                      </div>
                    </div>
                    <div class="flex items-center gap-2 flex-wrap">
                      <span
                        class="px-2 py-0.5 rounded-full text-[10px] font-semibold uppercase tracking-wider flex-shrink-0"
                        [ngClass]="{
                                                'bg-slate-100 text-slate-700': getTimelineStatus(competency) === 'Not Started',
                                                'bg-orange-100 text-orange-800': getTimelineStatus(competency) === 'Behind',
                                                'bg-green-100 text-green-800': getTimelineStatus(competency) === 'On Track',
                                                'bg-emerald-100 text-emerald-800': getTimelineStatus(competency) === 'Completed'
                                                }">
                        {{ getTimelineStatus(competency) }}
                      </span>
                    </div>
                  </div>

                  <div class="space-y-2">
                    <div class="flex justify-between items-center text-xs text-slate-500 font-medium">
                      <span>Current: <span class="font-bold text-slate-700">{{ competency.current_expertise
                          }}</span></span>
                      <span>Target: <span class="font-bold text-slate-700">{{ competency.target_expertise
                          }}</span></span>
                    </div>
                    <!-- Target Completion Date -->
                    <div *ngIf="competency.target_completion_date" class="text-[11px] text-slate-600 bg-blue-50/60 px-2 py-1 rounded border border-blue-200/40">
                      <strong class="text-slate-700">Target Date:</strong> {{ competency.target_completion_date | date:'short' }}
                    </div>
                    <div>
                      <div class="flex justify-between items-center mb-1">
                        <span class="text-xs font-bold text-slate-700 uppercase tracking-wider">Progress</span>
                        <span class="text-[10px] font-semibold text-slate-600">Exp: {{ getExpectedProgress(competency) }}% • Act: {{ getSkillProgress(competency) }}%</span>
                      </div>
                      <!-- Single Progress Bar with Two Light Colors -->
                      <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden shadow-inner relative border-2 border-slate-300 progress-track">
                         <!-- Expected Progress (thin marker line at expected %) -->
                         <div class="progress-expected"
                             [style.--expected-width.%]="getExpectedProgress(competency)">
                         </div>
                         <!-- Actual Progress (solid fill bar) -->
                         <div class="progress-actual"
                             [style.width.%]="getSkillProgress(competency)">
                         </div>
                      </div>
                    </div>
                  </div>

                  <div class="pt-1">
                    <button (click)="openSkillFeedbackModal(competency.skill)"
                      class="w-full px-2.5 py-1.5 flex items-center justify-center gap-1.5 text-xs font-medium text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md border border-indigo-200 transition-all duration-200"
                      [title]="hasFeedbackForSkill(competency.skill) ? 'View Manager Feedback' : 'No feedback available yet'"
                      [ngClass]="{'opacity-50 cursor-not-allowed': !hasFeedbackForSkill(competency.skill), 'hover:border-indigo-300': hasFeedbackForSkill(competency.skill)}">
                      <i class="fa-solid fa-comment-dots text-[10px]"></i>
                      <span>Manager Feedback</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <p *ngIf="(getFilteredMySkills() | skillFilter:mySkillsSearch:'').length === 0"
              class="text-center text-slate-500 mt-8">No skills found matching your filters.</p>
          </div>

          <div *ngIf="mySkillsView === 'additional'" @fadeIn>
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden">
              <div class="absolute top-3 left-3 w-4 h-4 border-t-2 border-l-2 border-blue-400/50 rounded-tl-lg"></div>
              <div class="absolute top-3 right-3 w-4 h-4 border-t-2 border-r-2 border-blue-400/50 rounded-tr-lg">
              </div>
              <div class="absolute bottom-3 left-3 w-4 h-4 border-b-2 border-l-2 border-blue-400/50 rounded-bl-lg">
              </div>
              <div class="absolute bottom-3 right-3 w-4 h-4 border-b-2 border-r-2 border-blue-400/50 rounded-br-lg">
              </div>

              <div class="p-8">
                <div *ngIf="showAddSkillForm" @slideFadeIn
                  class="bg-slate-50/70 border border-slate-200/80 rounded-2xl p-6 mb-6">
                  <h4 class="text-xl font-semibold text-slate-900 mb-4">{{ editingSkillId ? 'Edit Skill' : 'Add New
                    Skill' }}</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-700 mb-2">Skill Name *</label><input
                        type="text" [(ngModel)]="newSkill.name" placeholder="e.g., Python, Public Speaking"
                        class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-700 mb-2">Skill Level</label><select
                        [(ngModel)]="newSkill.level"
                        class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none">
                        <option *ngFor="let level of additionalSkillLevels" [value]="level">{{ level }}</option>
                      </select>
                    </div>
                    <div class="md:col-span-2">
                      <label class="block text-sm font-medium text-slate-700 mb-2">Category</label><select
                        [(ngModel)]="newSkill.category"
                        class="w-full md:w-1/2 px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none">
                        <option *ngFor="let category of skillCategories" [value]="category">{{ category }}</option>
                      </select>
                    </div>
                    <div class="md:col-span-2">
                      <label class="block text-sm font-medium text-slate-700 mb-2">Description
                        (Optional)</label><input type="text" [(ngModel)]="newSkill.description"
                        placeholder="Brief description of your experience"
                        class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none">
                    </div>
                  </div>
                  <div class="flex items-center justify-end space-x-3 mt-6">
                    <button (click)="toggleAddSkillForm()"
                      class="px-4 py-2 text-slate-600 hover:text-slate-800 font-medium transition-colors duration-200">Cancel</button>
                    <button (click)="addNewSkill()" [disabled]="!newSkill.name.trim()"
                      class="px-4 py-2 bg-sky-600 text-white rounded-lg font-medium hover:bg-sky-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-all duration-200">{{
                      editingSkillId ? 'Update Skill' : 'Add Skill' }}</button>
                  </div>
                </div>
                <div *ngIf="additionalSkills.length > 0" class="space-y-3" [@listStagger]="additionalSkills.length">
                  <div *ngFor="let skill of additionalSkills"
                    class="bg-white/70 border border-slate-200/80 rounded-xl p-4 hover:shadow-md hover:border-slate-300 transition-all duration-200 flex items-center justify-between">
                    <div class="flex-1 flex items-center space-x-4">
                      <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
                        <i class="fa-solid fa-star text-amber-500"></i>
                      </div>
                      <div>
                        <h4 class="font-semibold text-slate-900">{{ skill.skill_name }}</h4>
                        <div class="flex items-center space-x-2 mt-1">
                          <span class="px-2 py-0.5 rounded text-xs font-medium"
                            [ngClass]="getSkillLevelColor(skill.skill_level)">{{ skill.skill_level }}</span>
                          <span class="px-2 py-0.5 rounded text-xs font-medium"
                            [ngClass]="getCategoryColor(skill.skill_category)">{{ skill.skill_category }}</span>
                        </div>
                        <p *ngIf="skill.description" class="text-slate-600 text-sm mt-2">{{ skill.description }}</p>
                      </div>
                    </div>
                    <div class="flex items-center space-x-1">
                      <button (click)="editAdditionalSkill(skill)"
                        class="w-9 h-9 text-slate-400 hover:text-sky-600 hover:bg-sky-50 rounded-lg transition-all duration-200 flex items-center justify-center">
                        <i class="fa-solid fa-edit text-sm"></i>
                      </button>
                      <button (click)="removeAdditionalSkill(skill.id)"
                        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 flex items-center justify-center">
                        <i class="fa-solid fa-trash text-sm"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div *ngIf="additionalSkills.length === 0 && !showAddSkillForm"
                  class="text-center py-12 bg-slate-50/70 rounded-2xl border-2 border-dashed border-slate-300">
                  <div class="w-12 h-12 bg-slate-200 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-plus text-slate-500 text-lg"></i>
                  </div>
                  <h4 class="text-lg font-semibold text-slate-900 mb-2">Build Your Skills Portfolio</h4>
                  <p class="text-slate-600 mb-6 max-w-md mx-auto">Showcase your other talents and expertise that
                    complement your core competencies.</p>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div *ngIf="activeTab === 'trainerZone' && managerIsTrainer" @slideFadeIn>
          <div *ngIf="trainerZoneView === 'overview'" @fadeIn>
            <div
              class="bg-sky-50/70 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 overflow-hidden mb-6">
              <div class="bg-gradient-to-r from-indigo-600 to-blue-600 px-8 py-6 text-white">
                <div>
                  <h2 class="text-3xl font-bold">Trainer Zone</h2>
                  <p class="text-indigo-100 mt-1">Manage and schedule training sessions for your team</p>
                </div>
              </div>
            </div>
            <!-- Schedule New Training Button -->
            <div class="mb-6">
              <button (click)="openScheduleTrainingModal()"
                class="bg-gradient-to-r from-sky-500 to-blue-600 text-white font-bold px-6 py-3 rounded-lg hover:from-sky-600 hover:to-blue-700 hover:shadow-lg transition-all duration-200 transform hover:scale-105">
                <i class="fa-solid fa-plus-circle mr-2"></i>Schedule New Training
              </button>
            </div>

            <!-- Scheduled Training Sessions List -->
            <div class="space-y-4">
              <h3 class="text-xl font-bold text-slate-800 mb-4">My Scheduled Training Sessions</h3>
              <div *ngIf="myTrainings.length === 0"
                class="bg-slate-50 rounded-xl p-8 text-center border-2 border-dashed border-slate-300">
                <i class="fa-solid fa-calendar-xmark text-4xl text-slate-400 mb-3"></i>
                <p class="text-slate-600 font-medium">No training sessions scheduled yet.</p>
                <p class="text-slate-500 text-sm mt-1">Click "Schedule New Training" to create your first session.</p>
              </div>
              <div *ngIf="myTrainings.length > 0" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4"
                [@listStagger]="myTrainings.length">
                <div *ngFor="let training of myTrainings"
                  class="bg-white/70 backdrop-blur-sm p-2.5 rounded-2xl shadow-lg border border-slate-200/60 transform hover:-translate-y-1 transition-all duration-300 hover:shadow-xl flex flex-col gap-2">
                  <div class="flex items-start justify-between">
                    <div class="flex items-start gap-2">
                      <div
                        class="w-9 h-9 bg-sky-100 text-sky-600 rounded-lg flex items-center justify-center flex-shrink-0">
                        <i [ngClass]="getTrainingCardIcon(training.skill)" class="text-lg"></i>
                      </div>
                      <div>
                        <h3 class="text-xs font-bold text-slate-800">{{ training.training_name }}</h3>
                        <p class="text-[10px] text-slate-500">by {{ training.trainer_name }}</p>
                      </div>
                    </div>
                    <span *ngIf="isUpcoming(training.training_date)"
                      class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-amber-100 text-amber-800 ring-1 ring-inset ring-amber-200">
                      <i class="fa-solid fa-clock mr-1"></i> Upcoming
                    </span>
                  </div>
                  <div class="border-t border-slate-200/80"></div>
                  <div class="flex items-center justify-between text-xs">
                    <div class="flex items-center gap-1.5 text-slate-600">
                      <i class="fa-solid fa-calendar-days text-slate-400"></i>
                      <span class="font-semibold text-slate-800">{{ training.training_date ? (training.training_date |
                        date:'fullDate') : 'Date TBD' }}</span>
                    </div>
                    <div class="flex items-center gap-1.5 text-slate-600">
                      <i class="fa-solid fa-clock text-slate-400"></i>
                      <span class="font-semibold text-slate-800">{{ training.time || 'Time TBD' }}</span>
                    </div>
                  </div>
                  <div class="flex items-center gap-1.5 flex-wrap pt-1">
                    <span *ngIf="training.training_type"
                      class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200"><i
                        class="fa-solid fa-display mr-1"></i>{{ training.training_type }}</span>
                    <span *ngIf="training.skill_category"
                      class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200"><i
                        class="fa-solid fa-layer-group mr-1"></i>{{ training.skill_category }}</span>
                    <span *ngIf="training.skill"
                      class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200"><i
                        class="fa-solid fa-code mr-1"></i>{{ training.skill }}</span>
                  </div>
                  <div *ngIf="training.training_topics" class="text-[10px] text-slate-600 pt-1 line-clamp-2">
                    {{ training.training_topics }}
                  </div>
                  <!-- Candidates List -->
                  <div *ngIf="getTrainingCandidates(training.id).length > 0" class="pt-2 border-t border-slate-200/80">
                    <div class="flex items-center justify-between mb-1.5">
                      <span class="text-[10px] font-semibold text-slate-700">
                        <i class="fa-solid fa-users mr-1"></i>Candidates ({{ getTrainingCandidates(training.id).length
                        }})
                      </span>
                    </div>
                    <div class="max-h-20 overflow-y-auto space-y-1">
                      <div *ngFor="let candidate of getTrainingCandidates(training.id)"
                        class="flex items-center gap-1.5 text-[10px]">
                        <i [ngClass]="candidate.attended ? 'fa-solid fa-check-circle text-green-600' : 'fa-solid fa-circle text-slate-400'"
                          class="text-xs"></i>
                        <span [ngClass]="candidate.attended ? 'text-slate-800 font-medium' : 'text-slate-500'">{{
                          candidate.employee_name || candidate.employee_empid }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-auto pt-2 border-t border-slate-200/80 flex flex-col gap-2">
                    <!-- Primary Actions Row -->
                    <div class="flex items-center gap-2">
                      <!-- Mark Attendance -->
                      <button *ngIf="training.id" (click)="openAttendanceModal(training.id)"
                        class="flex-1 bg-emerald-500 text-white font-semibold py-1.5 rounded-lg hover:bg-emerald-700 transition-colors duration-200 text-xs">
                        <i class="fa-solid fa-clipboard-check mr-1.5"></i>Attendance
                      </button>
                      <!-- View Solutions -->
                      <button (click)="viewSolutions(training.id)"
                        class="flex-1 bg-teal-500 text-white font-semibold py-1.5 rounded-lg hover:bg-teal-700 transition-colors duration-200 text-xs">
                        <i class="fa-solid fa-eye mr-1.5"></i>Solutions
                      </button>
                    </div>
                    <!-- Sharing Actions Row -->
                    <div class="flex items-center gap-2">
                      <!-- Share Assignment (with status indicator) -->
                      <button (click)="openShareAssignment(training.id)"
                        [class]="isAssignmentShared(training.id) ? 'flex-1 bg-slate-400 text-white font-semibold py-1.5 rounded-lg cursor-not-allowed transition-colors duration-200 text-xs' : 'flex-1 bg-violet-500 text-white font-semibold py-1.5 rounded-lg hover:bg-violet-700 transition-colors duration-200 text-xs'"
                        [disabled]="isAssignmentShared(training.id)">
                        <i
                          [class]="isAssignmentShared(training.id) ? 'fa-solid fa-check-circle mr-1.5' : 'fa-solid fa-file-lines mr-1.5'"></i>
                        {{ isAssignmentShared(training.id) ? 'Assignment Shared' : 'Share Assignment' }}
                      </button>
                      <!-- Share Feedback (with status indicator) -->
                      <button (click)="openShareFeedback(training.id)"
                        [class]="isFeedbackShared(training.id) ? 'flex-1 bg-slate-400 text-white font-semibold py-1.5 rounded-lg cursor-not-allowed transition-colors duration-200 text-xs' : 'flex-1 bg-amber-500 text-white font-semibold py-1.5 rounded-lg hover:bg-amber-700 transition-colors duration-200 text-xs'"
                        [disabled]="isFeedbackShared(training.id)">
                        <i
                          [class]="isFeedbackShared(training.id) ? 'fa-solid fa-check-circle mr-1.5' : 'fa-solid fa-comment-dots mr-1.5'"></i>
                        {{ isFeedbackShared(training.id) ? 'Feedback Shared' : 'Share Feedback' }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="trainerZoneView === 'assignmentForm'" @fadeIn
            class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60 p-8">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-bold text-slate-900">Create New Assignment</h3>
              <button (click)="setTrainerZoneView('overview')"
                class="bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-full px-4 py-2 transition-all duration-200 flex items-center gap-2 font-medium">
                <i class="fa-solid fa-arrow-left"></i><span>Back to Overview</span>
              </button>
            </div>
            <div class="bg-slate-50/70 border border-slate-200/80 rounded-2xl p-6">
              <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Training Name *</label>
                    <select [(ngModel)]="newAssignment.trainingId" name="assignmentTraining"
                      [disabled]="newAssignment.trainingId !== null"
                      class="w-full px-4 py-2.5 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition disabled:bg-slate-100 disabled:cursor-not-allowed">
                      <option [ngValue]="null">Select a Training</option>
                      <option *ngFor="let t of myTrainings" [value]="t.id">{{ t.training_name }}</option>
                    </select>
                    <p *ngIf="newAssignment.trainingId !== null" class="text-xs text-slate-500 mt-1">
                      <i class="fa-solid fa-info-circle mr-1"></i>Training pre-selected from your scheduled sessions
                    </p>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Assignment Title *</label>
                    <input type="text" [(ngModel)]="newAssignment.title" name="assignmentTitle" required
                      placeholder="e.g., Softcar Fundamentals Quiz"
                      class="w-full px-4 py-2.5 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">General Instructions (Optional)</label>
                  <textarea [(ngModel)]="newAssignment.description" name="assignmentDescription" rows="2"
                    placeholder="Provide overall instructions for the assignment..."
                    class="w-full px-4 py-2.5 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition"></textarea>
                </div>

                <div class="pt-4 border-t border-slate-300/80">
                  <h5 class="text-lg font-semibold text-slate-800 mb-3">Assignment Questions</h5>
                  <div class="space-y-5">
                    <div *ngFor="let question of newAssignment.questions; let qIndex = index; trackBy: trackByFn"
                      @slideFadeIn
                      class="bg-white border border-slate-300/90 rounded-xl p-4 space-y-3 relative shadow-sm">

                      <div class="flex items-start gap-3">
                        <span class="font-bold text-lg text-slate-500 pt-1.5">{{ qIndex + 1 }}.</span>
                        <div class="flex-grow space-y-2">
                          <label class="text-sm font-medium text-slate-700">Question Text *</label>
                          <input type="text" [(ngModel)]="question.text" [name]="'q_text_' + qIndex"
                            placeholder="e.g., What is the main goal of a Softcar simulation?"
                            class="w-full px-3 py-2 text-md bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                        </div>
                        <select [(ngModel)]="question.type" [name]="'q_type_' + qIndex"
                          (change)="onQuestionTypeChange(question)"
                          class="px-3 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white">
                          <option value="single-choice">Single Choice</option>
                          <option value="multiple-choice">Multiple Choice</option>
                          <option value="text-input">Text Input</option>
                          <option value="file-upload">File Upload</option>
                        </select>
                      </div>

                      <div class="pl-8">
                        <label class="text-xs font-medium text-slate-500">Helper Text (Optional)</label>
                        <input type="text" [(ngModel)]="question.helperText" [name]="'q_helper_' + qIndex"
                          placeholder="e.g., Please select at most 2 options."
                          class="w-full px-3 py-1.5 text-sm bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                      </div>

                      <div *ngIf="question.type === 'single-choice' || question.type === 'multiple-choice'" @fadeIn
                        class="pl-8 pt-2 space-y-2">
                        <label class="text-sm font-medium text-slate-700">Options (Mark correct answer/s)</label>
                        <div *ngFor="let option of question.options; let oIndex = index; trackBy: trackByFn" @fadeIn
                          class="flex items-center gap-3">
                          <input *ngIf="question.type === 'single-choice'" type="radio" [name]="'correct_opt_' + qIndex"
                            [checked]="option.isCorrect" (click)="toggleCorrectOption(qIndex, oIndex)"
                            class="h-5 w-5 text-sky-600 focus:ring-sky-500 cursor-pointer"
                            title="Mark as correct answer">
                          <input *ngIf="question.type === 'multiple-choice'" type="checkbox"
                            [(ngModel)]="option.isCorrect" [name]="'q' + qIndex + '_iscorrect' + oIndex"
                            class="h-5 w-5 rounded text-sky-600 focus:ring-sky-500 cursor-pointer"
                            title="Mark as a correct answer">

                          <input type="text" [(ngModel)]="option.text" [name]="'q' + qIndex + '_opt' + oIndex"
                            placeholder="Option {{ oIndex + 1 }}"
                            class="flex-grow px-3 py-1.5 text-sm bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                          <button type="button" (click)="removeOptionFromQuestion(qIndex, oIndex)"
                            class="w-8 h-8 flex-shrink-0 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 flex items-center justify-center"
                            title="Remove Option">
                            <i class="fa-solid fa-trash-alt text-sm"></i>
                          </button>
                        </div>
                        <button type="button" (click)="addOptionToQuestion(qIndex)"
                          class="text-sm font-medium text-sky-600 hover:text-sky-800 transition-colors duration-200 mt-2">
                          <i class="fa-solid fa-plus mr-1"></i> Add Another Option
                        </button>
                      </div>

                      <div *ngIf="question.type === 'file-upload'" class="pl-8 pt-2 space-y-3">
                        <div
                          class="p-3 rounded-lg bg-indigo-50 border border-dashed border-indigo-300 text-xs text-slate-700">
                          <p class="font-semibold text-indigo-900 mb-1">File Upload Question</p>
                          <p>
                            Use this when you want candidates to work with a separate document (e.g., case study,
                            dataset) and
                            upload their solution file as the answer.
                          </p>
                          <p class="mt-2">
                            You can attach the document for this question below. Candidates will be able to
                            <strong>download</strong> it and then <strong>upload their solution file</strong> while
                            taking the assignment.
                          </p>
                        </div>
                        <div class="flex items-center gap-3 text-xs"
                          *ngIf="newAssignment.trainingId; else selectTrainingFirst">
                          <label
                            class="flex-1 px-4 py-2.5 bg-white rounded-lg border border-slate-300 hover:bg-slate-50 cursor-pointer transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-file-upload text-slate-600"></i>
                            <span class="text-slate-700" *ngIf="!assignmentFile">Choose file to upload for this
                              question...</span>
                            <span class="text-slate-700" *ngIf="assignmentFile">{{ assignmentFile.name }}</span>
                            <input type="file" (change)="onAssignmentFileSelected($event)" class="hidden"
                              accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
                          </label>
                          <span *ngIf="assignmentFile" class="text-[11px] text-emerald-700 font-semibold">
                            File selected. It will be uploaded when you share this assignment.
                          </span>
                        </div>
                        <ng-template #selectTrainingFirst>
                          <p class="text-[11px] text-amber-700">
                            Select a <strong>Training Name</strong> above to enable file upload for this question.
                          </p>
                        </ng-template>
                      </div>

                      <button type="button" (click)="removeAssignmentQuestion(qIndex)"
                        class="absolute -top-2 -right-2 w-7 h-7 bg-slate-600 text-white rounded-full hover:bg-red-600 transition-all shadow flex items-center justify-center"
                        title="Delete This Question">
                        <i class="fa-solid fa-times text-xs"></i>
                      </button>
                    </div>

                    <div *ngIf="newAssignment.questions.length === 0"
                      class="text-center py-8 text-slate-500 border-2 border-dashed border-slate-300 rounded-lg">
                      <i class="fa-solid fa-file-circle-question text-3xl text-slate-400 mb-2"></i>
                      <p>No questions yet. Click below to build your assignment.</p>
                    </div>
                  </div>

                  <button type="button" (click)="addAssignmentQuestion()"
                    class="w-full mt-4 text-center py-2.5 text-md font-semibold text-sky-700 bg-sky-50 hover:bg-sky-100 border-2 border-dashed border-sky-300 rounded-lg transition-colors duration-200">
                    <i class="fa-solid fa-plus-circle mr-2"></i> Add a New Question
                  </button>
                </div>
              </div>

              <div class="pt-4 border-t border-slate-300/80">
                <label class="block text-sm font-medium text-slate-700 mb-2">Upload Assignment File (Optional)</label>
                <div class="flex items-center gap-3">
                  <label
                    class="flex-1 px-4 py-2.5 bg-white rounded-lg border border-slate-300 hover:bg-slate-50 cursor-pointer transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-file-upload text-slate-600"></i>
                    <span class="text-slate-700" *ngIf="!assignmentFile">Choose file to upload...</span>
                    <span class="text-slate-700" *ngIf="assignmentFile">{{ assignmentFile.name }}</span>
                    <input type="file" (change)="onAssignmentFileSelected($event)" class="hidden"
                      accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
                  </label>
                  <button *ngIf="assignmentFile" (click)="assignmentFile = null"
                    class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Remove file">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <p class="text-xs text-slate-500 mt-1">
                  <i class="fa-solid fa-info-circle mr-1"></i>Maximum file size: 10MB. All file types are accepted.
                </p>
              </div>
              <div class="flex items-center justify-end space-x-3 mt-8 pt-4 border-t border-slate-300/80">
                <button (click)="setTrainerZoneView('overview')"
                  class="px-5 py-2 text-slate-700 bg-slate-200 hover:bg-slate-300 font-semibold rounded-lg transition-colors duration-200">Cancel</button>
                <button (click)="submitAssignment()"
                  class="px-5 py-2 bg-violet-600 text-white rounded-lg font-semibold hover:bg-violet-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-all duration-200 shadow-md">
                  <i class="fa-solid fa-paper-plane mr-2"></i> Create and Share Assignment
                </button>
              </div>
            </div>
          </div>

          <div *ngIf="trainerZoneView === 'feedbackForm'" @fadeIn
            class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60 p-8">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-bold text-slate-900">New Feedback Form</h3>
              <button (click)="setTrainerZoneView('overview')"
                class="bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-full px-4 py-2 transition-all duration-200 flex items-center gap-2 font-medium">
                <i class="fa-solid fa-arrow-left"></i><span>Back to Overview</span>
              </button>
            </div>
            <div class="bg-slate-50/70 border border-slate-200/80 rounded-2xl p-6">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Training Name *</label>
                  <select [(ngModel)]="newFeedback.trainingId" name="feedbackTraining"
                    [disabled]="newFeedback.trainingId !== null"
                    class="w-full px-4 py-2.5 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition disabled:bg-slate-100 disabled:cursor-not-allowed">
                    <option [ngValue]="null">Select a Training</option>
                    <option *ngFor="let t of myTrainings" [value]="t.id">{{ t.training_name }}</option>
                  </select>
                  <p *ngIf="newFeedback.trainingId !== null" class="text-xs text-slate-500 mt-1">
                    <i class="fa-solid fa-info-circle mr-1"></i>Training pre-selected from your scheduled sessions
                  </p>
                </div>

                <div>
                  <h5 class="text-md font-semibold text-slate-800 pt-3 border-t border-slate-200/80">Default Questions
                  </h5>
                  <div class="space-y-3 mt-2">
                    <div *ngFor="let q of defaultFeedbackQuestions; let i = index" @fadeIn
                      class="text-sm text-slate-700 bg-slate-200/70 p-3 rounded-lg">
                      <p class="font-semibold">{{i+1}}. {{q.text}}</p>
                      <div class="flex flex-wrap gap-x-4 gap-y-2 mt-2 pl-4">
                        <span *ngFor="let opt of q.options"
                          class="px-2 py-0.5 text-xs bg-white border border-slate-300 rounded-full">{{opt}}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div>
                  <h5 class="text-md font-semibold text-slate-800 pt-3 border-t border-slate-200/80">Additional Custom
                    Questions</h5>
                  <div class="space-y-4 mt-2">
                    <div *ngFor="let question of newFeedback.customQuestions; let qIndex = index; trackBy: trackByFn"
                      @slideFadeIn class="bg-white/80 border border-slate-300/80 rounded-lg p-4 space-y-3">
                      <div class="flex items-center gap-2">
                        <input type="text" [(ngModel)]="question.text" [name]="'customQuestionText' + qIndex"
                          placeholder="Enter your custom question"
                          class="flex-grow px-3 py-2 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                        <button type="button" (click)="removeCustomQuestion(qIndex)"
                          class="w-9 h-9 flex-shrink-0 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 flex items-center justify-center">
                          <i class="fa-solid fa-trash text-sm"></i>
                        </button>
                      </div>
                      <div class="pl-4 space-y-2">
                        <label class="text-xs font-semibold text-slate-500">Options</label>
                        <div *ngFor="let option of question.options; let oIndex = index; trackBy: trackByFn"
                          @slideFadeIn class="flex items-center gap-2">
                          <input type="text" [(ngModel)]="question.options[oIndex]"
                            [name]="'customOption' + qIndex + '-' + oIndex" placeholder="Option {{oIndex + 1}}"
                            class="flex-grow px-3 py-1.5 text-sm bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition">
                          <button type="button" (click)="removeOption(qIndex, oIndex)"
                            class="w-7 h-7 flex-shrink-0 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 flex items-center justify-center">
                            <i class="fa-solid fa-times text-xs"></i>
                          </button>
                        </div>
                        <button type="button" (click)="addOption(qIndex)"
                          class="text-xs font-medium text-sky-600 hover:text-sky-800 transition-colors duration-200">
                          <i class="fa-solid fa-plus mr-1"></i> Add Option
                        </button>
                      </div>
                    </div>
                    <button type="button" (click)="addCustomQuestion()"
                      class="w-full text-center py-2 text-sm font-medium text-sky-600 bg-sky-50 hover:bg-sky-100 border-2 border-dashed border-sky-200 rounded-lg transition-colors duration-200">
                      <i class="fa-solid fa-plus mr-1"></i> Add a New Custom Question
                    </button>
                  </div>
                </div>
              </div>

              <div class="flex items-center justify-end space-x-3 mt-6 pt-4 border-t border-slate-300/80">
                <button (click)="setTrainerZoneView('overview')"
                  class="px-4 py-2 text-slate-700 bg-slate-200 hover:bg-slate-300 font-semibold rounded-lg transition-colors duration-200">Cancel</button>
                <button (click)="submitFeedback()" [disabled]="!newFeedback.trainingId"
                  class="px-4 py-2 bg-rose-600 text-white rounded-lg font-medium hover:bg-rose-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-all duration-200">Share
                  Feedback</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && !errorMessage && activeTab === 'teamSkills' && manager" class="space-y-6">
        <div #animatedElement
          class="animate-on-scroll bg-sky-50/70 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 overflow-hidden">
          <div class="bg-gradient-to-r from-indigo-600 to-blue-600 px-8 py-6 text-white">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-3xl font-bold">Team Skills Management</h2>
                <p class="text-indigo-100 mt-1">Monitor and manage your team's skill development</p>
              </div>
            </div>
          </div>
          <div class="px-8 py-6 bg-slate-50/70 border-b border-slate-200/60">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
              <div>
                <label for="team-name-filter" class="block text-sm font-semibold text-slate-700 mb-2"><i
                    class="fa-solid fa-user mr-2 text-indigo-600"></i>Filter by Team Member</label>
                <app-searchable-dropdown id="team-name-filter" [(ngModel)]="teamMemberNameFilter"
                  [options]="uniqueTeamMembers" placeholder="All Members" allOptionLabel="All Members"
                  allOptionValue="All" iconClass="fa-user" size="large" width="w-full"
                  [multiple]="true">
                </app-searchable-dropdown>
              </div>
              <div>
                <label for="team-skill-filter" class="block text-sm font-semibold text-slate-700 mb-2 transition-colors"
                  [ngClass]="{'text-slate-400': teamCompetencyFilter.length > 0}"><i
                    class="fa-solid fa-brain mr-2 text-green-600"></i>Filter by Skill</label>
                <app-searchable-dropdown id="team-skill-filter" [(ngModel)]="teamSkillsSkillFilter"
                  [options]="uniqueTeamSkills" placeholder="All Skills" allOptionLabel="All Skills" allOptionValue="All"
                  iconClass="fa-brain" [disabled]="teamCompetencyFilter.length > 0" size="large" width="w-full"
                  [multiple]="true">
                </app-searchable-dropdown>
              </div>
              <div>
                <label for="team-competency-filter"
                  class="block text-sm font-semibold text-slate-700 mb-2 transition-colors"
                  [ngClass]="{'text-slate-400': teamSkillsSkillFilter.length > 0}"><i
                    class="fa-solid fa-cogs mr-2 text-orange-600"></i>Filter by Competency</label>
                <app-searchable-dropdown id="team-competency-filter" [(ngModel)]="teamCompetencyFilter"
                  [options]="uniqueCompetencies" placeholder="All Competencies" allOptionLabel="All Competencies"
                  allOptionValue="All" iconClass="fa-cogs" [disabled]="teamSkillsSkillFilter.length > 0" size="large"
                  width="w-full"
                  [multiple]="true">
                </app-searchable-dropdown>
              </div>
              <div>
                <label for="team-skill-level-filter"
                  class="block text-sm font-semibold text-slate-700 mb-2 transition-colors"
                  [ngClass]="{'text-slate-400': teamSkillsSkillFilter.length === 0 && teamCompetencyFilter.length === 0}"><i
                    class="fa-solid fa-signal mr-2 text-indigo-600"></i>Filter by Current Level</label>
                <app-searchable-dropdown id="team-skill-level-filter" [(ngModel)]="teamSkillsCurrentLevelFilter"
                  [options]="skillLevelsForFilter" placeholder="All Levels" allOptionLabel="All Levels"
                  allOptionValue="All" iconClass="fa-signal"
                  [disabled]="teamSkillsSkillFilter.length === 0 && teamCompetencyFilter.length === 0" size="large"
                  width="w-full"
                  [multiple]="true">
                </app-searchable-dropdown>
              </div>
              <div>
                <label for="team-status-filter"
                  class="block text-sm font-semibold text-slate-700 mb-2 transition-colors"><i
                    class="fa-solid fa-chart-line mr-2 text-purple-600"></i>Filter by Status</label>
                <app-searchable-dropdown id="team-status-filter" [(ngModel)]="teamSkillsStatusFilter"
                  [options]="['Not Started', 'Behind', 'On Track', 'Completed']" placeholder="All Statuses" allOptionLabel="All Statuses" allOptionValue="All"
                  iconClass="fa-chart-line" size="large" width="w-full"
                  [multiple]="true">
                </app-searchable-dropdown>
              </div>
            </div>
          </div>
          <div *ngIf="!selectedTeamMember" class="p-8">
            <p *ngIf="filteredTeamMembers.length === 0" class="text-center text-slate-500 py-12">No team members match
              your selected filters.</p>
            <div *ngIf="filteredTeamMembers.length > 0"
              class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
              <div #animatedElement *ngFor="let member of filteredTeamMembers" (click)="viewMemberDetails(member)"
                class="animate-on-scroll bg-white/70 backdrop-blur-sm rounded-xl p-4 flex flex-col items-center text-center shadow-lg border border-transparent hover:border-indigo-300 hover:shadow-2xl transition-all duration-300 cursor-pointer">
                <div class="relative mb-3">
                  <img src="https://ui-avatars.com/api/?name={{member.name}}&background=random&color=fff&size=60"
                    alt="avatar" class="rounded-full h-16 w-16 ring-3 ring-indigo-500 ring-opacity-50">
                  <span *ngIf="getTeamSkillsMetCount(member) === member.skills.length"
                    class="absolute bottom-0 right-0 transform translate-x-1/4 translate-y-1/4 bg-green-500 text-white rounded-full p-2 text-xs"><i
                      class="fa-solid fa-check"></i></span>
                </div>
                <h3 class="font-bold text-xl text-slate-900">{{ member.name }}</h3>
                <p class="text-sm text-slate-500 mt-1"><span class="font-semibold">{{ getTeamSkillsMetCount(member)
                  }}</span> out of <span class="font-semibold">{{ member.skills.length }}</span> skills completed</p>
                <div class="relative w-24 h-24 my-3 flex items-center justify-center">
                  <svg class="w-full h-full transform -rotate-90">
                    <circle class="text-slate-200" stroke-width="12" stroke="currentColor" fill="transparent" r="42"
                      cx="48" cy="48" />
                    <circle class="text-cyan-500" stroke-width="12" stroke-linecap="round" stroke="currentColor"
                      fill="transparent" r="42" cx="48" cy="48" [style.stroke-dasharray]="2 * 3.14 * 42"
                      [style.stroke-dashoffset]="(2 * 3.14 * 42) - (2 * 3.14 * 42 * (calculateProgress(member.skills) / 100))"
                      style="transition: stroke-dashoffset 0.5s ease-in-out;">
                    </circle>
                  </svg>
                  <span class="absolute text-2xl font-bold text-slate-800">{{ calculateProgress(member.skills) |
                    number:'1.0-0' }}%</span>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="selectedTeamMember" class="p-8 bg-slate-50/70 border-t border-slate-200/60">
            <div class="flex items-center justify-between mb-6">
              <div>
                <h3 class="text-2xl font-bold text-slate-800" title="Skills required for this team member's job role">
                  Core Skills for {{ selectedTeamMember.name }}</h3>
              </div>
              <button (click)="clearMemberDetails()"
                class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"><i
                  class="fa-solid fa-arrow-left mr-2"></i>Back to Team</button>
            </div>
            <div *ngIf="successMessage"
              class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-4" role="alert">
              <strong class="font-bold">Success!</strong>
              <span class="block sm:inline ml-2">{{ successMessage }}</span>
            </div>
            <div class="bg-white/80 rounded-xl shadow-md overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200">
                  <thead class="bg-slate-50/70">
                    <tr>
                      <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Skill
                      </th>
                      <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Competency</th>
                      <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Current
                        Level</th>
                      <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Target
                        Level</th>
                      <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status
                      </th>
                      <th scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Actions
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-slate-200">
                    <ng-container *ngFor="let skill of selectedTeamMember.skills; let i = index">
                      <tr [ngClass]="{'bg-indigo-50': isEditingSkill(selectedTeamMember.id, i)}">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="text-sm font-semibold text-slate-900">{{ skill.skill }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">{{ skill.competency }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                          <span *ngIf="!isEditingSkill(selectedTeamMember.id, i)">{{ skill.current_expertise }}</span>
                          <select *ngIf="isEditingSkill(selectedTeamMember.id, i)"
                            [(ngModel)]="editSkillData.current_expertise"
                            class="rounded-lg border-slate-300 text-sm px-3 py-2">
                            <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
                          </select>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                          <span *ngIf="!isEditingSkill(selectedTeamMember.id, i)">{{ skill.target_expertise }}</span>
                          <select *ngIf="isEditingSkill(selectedTeamMember.id, i)"
                            [(ngModel)]="editSkillData.target_expertise"
                            class="rounded-lg border-slate-300 text-sm px-3 py-2">
                            <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
                          </select>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap"><span
                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                            [ngClass]="{
                              'bg-slate-100 text-slate-700': getTimelineStatus(skill, selectedTeamMember.skills) === 'Not Started',
                              'bg-orange-100 text-orange-800': getTimelineStatus(skill, selectedTeamMember.skills) === 'Behind',
                              'bg-sky-100 text-sky-800': getTimelineStatus(skill, selectedTeamMember.skills) === 'On Track',
                              'bg-emerald-100 text-emerald-800': getTimelineStatus(skill, selectedTeamMember.skills) === 'Completed'
                            }">{{
                            getTimelineStatus(skill, selectedTeamMember.skills) }}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <ng-container *ngIf="!isEditingSkill(selectedTeamMember.id, i)">
                            <button (click)="startEditSkill(selectedTeamMember.id, i)"
                              class="text-indigo-600 hover:text-indigo-900 transition-colors">Edit</button>
                          </ng-container>
                          <ng-container *ngIf="isEditingSkill(selectedTeamMember.id, i)">
                            <div class="flex space-x-2">
                              <button (click)="saveSkillEdit()"
                                class="px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm transition-colors">Save</button>
                              <button (click)="cancelEditSkill()"
                                class="px-3 py-1 text-slate-600 border border-slate-300 rounded-md hover:bg-slate-100 text-sm transition-colors">Cancel</button>
                            </div>
                          </ng-container>
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="mt-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-4">Additional Skills</h3>
              <div *ngIf="selectedTeamMember.additional_skills && selectedTeamMember.additional_skills.length > 0"
                class="space-y-3">
                <div *ngFor="let skill of selectedTeamMember.additional_skills"
                  class="bg-white/80 border border-slate-200/80 rounded-lg p-4 hover:shadow-sm transition-all duration-200">
                  <div class="flex items-center justify-between">
                    <div class="flex-1">
                      <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center"><i
                            class="fa-solid fa-star text-slate-600 text-sm"></i></div>
                        <div>
                          <h4 class="font-semibold text-slate-900">{{ skill.skill_name }}</h4>
                          <div class="flex items-center space-x-2 mt-1">
                            <span class="px-2 py-1 rounded text-xs font-medium"
                              [ngClass]="getSkillLevelColor(skill.skill_level)">{{ skill.skill_level }}</span>
                            <span class="px-2 py-1 rounded text-xs font-medium"
                              [ngClass]="getCategoryColor(skill.skill_category)">{{ skill.skill_category }}</span>
                          </div>
                        </div>
                      </div>
                      <p *ngIf="skill.description" class="text-slate-600 text-sm ml-11 mt-2">{{ skill.description }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngIf="!selectedTeamMember.additional_skills || selectedTeamMember.additional_skills.length === 0"
                class="text-center py-12 bg-white/80 rounded-lg border-2 border-dashed border-slate-300">
                <div class="w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-4"><i
                    class="fa-solid fa-folder-open text-slate-500 text-lg"></i></div>
                <h4 class="text-lg font-semibold text-slate-900">No Additional Skills</h4>
                <p class="text-slate-600">This team member has not added any additional skills.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && !errorMessage && activeTab === 'trainingCatalog' && manager" class="space-y-6">

        <!-- Live Trainings View -->
        <div *ngIf="trainingCatalogType === 'live' && trainingCatalogView === 'list'">
          <div *ngIf="filteredCatalog.length === 0" #animatedElement
            class="animate-on-scroll text-center py-20 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border-2 border-dashed border-slate-300">
            <div
              class="w-20 h-20 bg-gradient-to-br from-sky-100 to-sky-200 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fa-solid fa-folder-open text-sky-500 text-4xl"></i>
            </div>
            <h4 class="text-2xl font-bold text-slate-800 mb-2">No Trainings Found</h4>
            <p class="text-slate-600 max-w-md mx-auto">No training sessions match your current filters. Try resetting
              the filters.</p>
          </div>
          <div *ngIf="filteredCatalog.length > 0"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3"
            [@listStagger]="filteredCatalog.length">
            <div *ngFor="let training of filteredCatalog"
              [attr.data-training-id]="training.id"
              class="group bg-white/70 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 overflow-hidden transform transition-all duration-300 ease-in-out flex flex-col relative"
              [ngClass]="{
                'hover:-translate-y-1.5 hover:shadow-2xl': hoveredTrainingId !== training.id,
                'scale-105 -translate-y-2 shadow-2xl bg-gradient-to-br from-sky-50 to-blue-50 border-sky-300': hoveredTrainingId === training.id || selectedTrainingIdForEnrollment === training.id,
                'ring-4 ring-amber-400 shadow-amber-300/50': selectedTrainingFromCalendar === training.id
              }"
              (mouseenter)="hoveredTrainingId = training.id"
              (mouseleave)="hoveredTrainingId = null">
              <!-- Glow effect layer -->
              <div *ngIf="hoveredTrainingId === training.id || selectedTrainingIdForEnrollment === training.id" 
                class="absolute inset-0 bg-gradient-to-r from-sky-400/20 to-cyan-400/20 rounded-xl blur-lg opacity-75 -z-10 animate-pulse"></div>
              <div class="h-1.5 bg-gradient-to-r from-sky-500 to-cyan-400"></div>
              <div class="p-2 flex-grow flex flex-col">
                <div class="flex items-start gap-2 mb-1.5">
                  <div
                    class="flex-shrink-0 w-7 h-7 bg-slate-100 text-sky-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <i [ngClass]="getTrainingCardIcon(training.skill || '')" class="text-sm"></i>
                  </div>
                  <div>
                    <h3 class="text-xs font-bold leading-tight text-slate-800">{{ training.training_name }}</h3>
                    <p class="text-[10px] text-slate-500">by {{ training.trainer_name }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-1.5 flex-wrap mb-1.5">
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-sky-100 text-sky-800 ring-1 ring-inset ring-sky-200"><i
                      class="fa-solid fa-display mr-1"></i>{{ training.training_type || 'N/A' }}</span>
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-violet-100 text-violet-800 ring-1 ring-inset ring-violet-200"><i
                      class="fa-solid fa-layer-group mr-1"></i>{{ training.skill_category || 'N/A' }}</span>
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-rose-100 text-rose-800 ring-1 ring-inset ring-rose-200"
                    *ngIf="training.seats"><i class="fa-solid fa-users mr-1"></i>{{ training.seats }} Seats</span>
                </div>
                <div class="flex-grow text-[11px] text-slate-600 mb-2">
                  <p><strong class="font-semibold text-slate-700">Topics:</strong> {{ training.training_topics || 'Not
                    specified' }}</p>
                </div>
                <div class="pt-2 mt-auto border-t border-slate-200/80 space-y-1.5 text-xs">
                  <div class="flex items-center justify-between text-slate-600">
                    <div class="flex items-center gap-1.5">
                      <i class="fa-solid fa-calendar-days text-slate-400 w-4 text-center"></i>
                      <span class="font-medium text-slate-800">{{ training.training_date ? (training.training_date |
                        date:'mediumDate') : 'Date TBD' }}</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                      <i class="fa-solid fa-clock text-slate-400 w-4 text-center"></i>
                      <span class="font-medium text-slate-800">{{ training.time || 'Time TBD' }}</span>
                    </div>
                  </div>
                </div>
                <div class="pt-2 mt-2 border-t border-slate-200/80">
                  <button (click)="enrollInTraining(training)"
                    class="w-full bg-sky-600 text-white font-semibold py-1 rounded-lg hover:bg-sky-700 transition-colors duration-200 text-xs">
                    <i class="fa-solid fa-user-plus mr-2"></i>Enroll
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Live Trainings Calendar View -->
        <div *ngIf="trainingCatalogType === 'live' && trainingCatalogView === 'calendar'" @fadeIn>
          <div class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-2xl shadow-lg border border-slate-200/60">
            <!-- Calendar Header: Month navigation controls and current month/year display -->
            <div class="flex justify-between items-center mb-6">
              <!-- Previous Month Button: Navigates to previous month -->
              <button (click)="previousMonth()" class="w-10 h-10 bg-slate-200/70 rounded-lg hover:bg-slate-300/80 transition-colors flex items-center justify-center">
                <i class="fa-solid fa-chevron-left"></i>
              </button>
              <!-- Current Month/Year Display: Shows the calendar month and year -->
              <h3 class="text-2xl font-bold text-slate-800">{{ calendarMonth }} {{ calendarYear }}</h3>
              <!-- Next Month Button: Navigates to next month -->
              <button (click)="nextMonth()" class="w-10 h-10 bg-slate-200/70 rounded-lg hover:bg-slate-300/80 transition-colors flex items-center justify-center">
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
            <!-- Calendar Grid: 7-column grid for days of the week -->
            <div class="grid grid-cols-7 gap-1 sm:gap-2 text-center">
              <!-- Day Headers: Column labels for each day of the week -->
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">SUN</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">MON</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">TUE</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">WED</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">THU</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">FRI</div>
              <div class="font-bold text-slate-500 py-2 text-xs sm:text-sm">SAT</div>

              <!-- 
                CALENDAR DAY CELLS
                Purpose: Individual day cells in the calendar grid
                Features:
                - Dynamic background based on day state (today, current month, other month)
                - Date number display
                - Training event display if training exists on that date
                - Conditional styling for today highlighting
              -->
              <div *ngFor="let day of calendarDays" class="relative h-20 font-semibold rounded-lg transition-colors border border-slate-200/60"
                   [ngClass]="{
                     'bg-sky-50': isToday(day),
                     'bg-white': day && !isToday(day),
                     'bg-slate-50/50': !day,
                     'text-slate-400': !day || day.getMonth() !== currentDate.getMonth()
                   }">
                  <!-- Date Number: Displays the day number (1-31)
                       Styled differently for today (sky-500 background) vs other days -->
                  <div *ngIf="day" class="absolute top-1.5 left-2 text-xs sm:text-sm w-6 h-6 flex items-center justify-center rounded-full"
                      [ngClass]="{'bg-sky-500 text-white': isToday(day), 'text-slate-800': !isToday(day)}">
                     {{ day.getDate() }}
                 </div>
                  <!-- Training Event Display: Shows training name if training exists on this date
                       Uses getEventForDate() to find matching training from allTrainingsCalendarEvents
                       Styled with blue colors for training catalog calendar -->
                  <div *ngFor="let event of getEventForDate(day, allTrainingsCalendarEvents)"
                      class="absolute top-9 left-1 right-1 p-1 text-[10px] bg-blue-100 text-blue-900 rounded cursor-pointer leading-tight shadow-sm hover:bg-blue-200 hover:ring-2 hover:ring-blue-400 z-10 transition-all duration-200"
                      [title]="event.title + ' - by ' + event.trainer"
                      (click)="onCatalogCalendarEventClick(event)">
                      <p class="font-bold truncate"><i class="fa-solid fa-circle text-blue-500 text-[6px] mr-1 align-middle"></i>{{ event.title }}</p>
                  </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recorded Trainings View -->
        <div *ngIf="trainingCatalogType === 'recorded'">
          <div *ngIf="filteredRecordedTrainings.length === 0" #animatedElement
            class="animate-on-scroll text-center py-20 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border-2 border-dashed border-slate-300">
            <div
              class="w-20 h-20 bg-gradient-to-br from-cyan-100 to-teal-200 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fa-solid fa-video text-cyan-600 text-4xl"></i>
            </div>
            <h4 class="text-2xl font-bold text-slate-800 mb-2">No Recorded Trainings Found</h4>
            <p class="text-slate-600 max-w-md mx-auto">No recorded training sessions match your current filters. Try
              resetting the filters.</p>
          </div>
          <div *ngIf="filteredRecordedTrainings.length > 0"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3"
            [@listStagger]="filteredRecordedTrainings.length">
            <div *ngFor="let training of filteredRecordedTrainings"
              class="group bg-white/70 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 overflow-hidden transform hover:-translate-y-1.5 transition-all duration-300 ease-in-out hover:shadow-2xl flex flex-col">
              <div class="h-1.5 bg-gradient-to-r from-cyan-500 to-teal-400"></div>
              <div class="p-2 flex-grow flex flex-col">
                <div class="flex items-start gap-2 mb-1.5">
                  <div
                    class="flex-shrink-0 w-7 h-7 bg-cyan-100 text-cyan-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <i class="fa-solid fa-video text-sm"></i>
                  </div>
                  <div>
                    <h3 class="text-xs font-bold leading-tight text-slate-800">{{ training.training_name }}</h3>
                    <p class="text-[10px] text-slate-500">by {{ training.trainer_name }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-1.5 flex-wrap mb-1.5">
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-cyan-100 text-cyan-800 ring-1 ring-inset ring-cyan-200"
                    *ngIf="training.skill"><i class="fa-solid fa-tag mr-1"></i>{{ training.skill }}</span>
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-teal-100 text-teal-800 ring-1 ring-inset ring-teal-200"
                    *ngIf="training.skill_category"><i class="fa-solid fa-layer-group mr-1"></i>{{
                    training.skill_category }}</span>
                  <span
                    class="inline-flex items-center px-1.5 py-0.5 rounded-md text-[10px] font-medium bg-emerald-100 text-emerald-800 ring-1 ring-inset ring-emerald-200"
                    *ngIf="training.duration"><i class="fa-solid fa-hourglass mr-1"></i>{{ training.duration }} hrs</span>
                </div>
                <div class="flex-grow text-[11px] text-slate-600 mb-2">
                  <p *ngIf="training.training_topics"><strong class="font-semibold text-slate-700">Topics:</strong> {{
                    training.training_topics }}</p>
                  <p *ngIf="training.description" class="mt-1 text-[10px] text-slate-500">{{ training.description }}
                  </p>
                </div>
                <div class="pt-2 mt-auto border-t border-slate-200/80">
                  <button (click)="openRecordedTraining(training.lecture_url)"
                    class="w-full bg-cyan-600 text-white font-semibold py-1 rounded-lg hover:bg-cyan-700 transition-colors duration-200 text-xs flex items-center justify-center gap-2">
                    <i class="fa-solid fa-play mr-1"></i>Watch Now
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && !errorMessage && activeTab === 'assignTraining' && manager" class="space-y-6">
        <!-- Header - Matching other tabs -->
        <div class="bg-blue-600 px-6 py-2 shadow-lg rounded-2xl mx-6 mt-3">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-3">
              <h2 class="text-sm font-semibold text-white whitespace-nowrap">Assign Training</h2>
              <div class="ml-4">
                <div class="segmented-control bg-indigo-900/30 backdrop-blur-sm rounded-full p-1 flex items-center gap-1">
                  <button (click)="assignTrainingType = 'live'" class="segmented-pill" [ngClass]="{ 'active': assignTrainingType === 'live' }">
                    <div class="flex items-center gap-2 px-3 py-2">
                      <i class="fa-solid fa-chalkboard text-[13px]"></i>
                      <div class="text-left">
                        <div class="text-xs font-semibold">Class</div>
                        <div class="text-[10px] text-slate-200">{{ liveAssignCount }} available</div>
                      </div>
                    </div>
                  </button>
                  <button (click)="assignTrainingType = 'recorded'" class="segmented-pill" [ngClass]="{ 'active': assignTrainingType === 'recorded' }">
                    <div class="flex items-center gap-2 px-3 py-2">
                      <i class="fa-solid fa-video-slash text-[13px]"></i>
                      <div class="text-left">
                        <div class="text-xs font-semibold">Recorded</div>
                        <div class="text-[10px] text-slate-200">{{ recordedAssignCount }} available</div>
                      </div>
                    </div>
                  </button>
                </div>
                <div class="text-[11px] text-white/90 mt-1">Toggle between live/class sessions and polished recorded lectures.</div>
              </div>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[11px] text-blue-100">
                      <div class="flex items-center gap-1 bg-blue-700/60 rounded-md px-2 py-0.5 text-[10px]">
                <i class="fa-solid fa-book-open text-[10px]"></i>
                <span class="uppercase tracking-wide">Trainings</span>
                <span class="font-semibold text-white">{{ selectedTrainingIds.length }}/{{ filteredAssignTrainings.length }}</span>
              </div>
                      <div class="flex items-center gap-1 bg-blue-700/60 rounded-md px-2 py-0.5 text-[10px]">
                <i class="fa-solid fa-users text-[10px]"></i>
                <span class="uppercase tracking-wide">Members</span>
                <span class="font-semibold text-white">{{ selectedMemberIds.length }}/{{ filteredAssignMembers.length }}</span>
              </div>
                      <div class="flex items-center gap-1 bg-emerald-400/90 text-emerald-950 rounded-md px-2 py-0.5 text-[10px]">
                <i class="fa-solid fa-calculator text-[10px]"></i>
                <span class="uppercase tracking-wide">Total</span>
                <span class="font-semibold">{{ selectedTrainingIds.length * selectedMemberIds.length || 0 }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div #animatedElement class="animate-on-scroll bg-white/95 rounded-2xl shadow border border-slate-200 p-4 lg:p-6 mx-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6">
            <!-- LEFT: Trainings & Members -->
            <div class="lg:col-span-2 space-y-4">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Trainings Section -->
                <div class="space-y-3">
                  <div class="flex items-center justify-between gap-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Trainings</span>
                      <span class="text-xs text-slate-400">({{ filteredAssignTrainings.length }})</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <button (click)="selectAllTrainings()" class="text-[11px] text-indigo-600 hover:text-indigo-800 font-semibold">
                        Select all
                      </button>
                      <span class="h-4 w-px bg-slate-200"></span>
                      <button (click)="clearAllTrainings()" class="text-[11px] text-slate-500 hover:text-slate-700 font-semibold">
                        Clear
                      </button>
                    </div>
                  </div>
                  <div class="relative">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                    <input
                      [(ngModel)]="assignTrainingSearch"
                      placeholder="Search by name, topic, trainer..."
                      class="w-full pl-8 pr-3 py-2 rounded-lg border border-slate-300 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-xs"
                    />
                  </div>
                  <div *ngIf="filteredAssignTrainings.length > 0" class="border border-slate-200 rounded-lg max-h-80 overflow-y-auto custom-scrollbar">
                    <table class="min-w-full text-xs">
                      <thead class="bg-slate-50 border-b border-slate-200 sticky top-0 z-10">
                          <tr>
                            <th class="px-3 py-2 text-left font-semibold text-slate-600 w-9">
                              <input
                                type="checkbox"
                                (change)="onToggleAllTrainings($event)"
                                [checked]="selectedTrainingIds.length > 0 && selectedTrainingIds.length === filteredAssignTrainings.length"
                                class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500 accent-indigo-600"
                              />
                            </th>
                            <th class="px-3 py-2 text-left font-semibold text-slate-600">Training</th>
                          </tr>
                        </thead>
                      <tbody>
                        <tr
                          *ngFor="let training of filteredAssignTrainings"
                          [ngClass]="{
                            'bg-indigo-50/60': isTrainingSelected(training.id),
                            'hover:bg-slate-50': !isTrainingSelected(training.id)
                          }"
                          class="border-b last:border-b-0 border-slate-100 cursor-pointer"
                          (click)="toggleTrainingSelection(training.id)"
                        >
                          <td class="px-3 py-2 align-top">
                            <input
                              type="checkbox"
                              [checked]="isTrainingSelected(training.id)"
                              (change)="toggleTrainingSelection(training.id)"
                              (click)="$event.stopPropagation()"
                              class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500 accent-indigo-600"
                            />
                          </td>
                          <td class="px-3 py-2 align-top">
                            <div class="training-card">
                              <div class="flex items-start justify-between">
                                <div class="font-semibold text-slate-800 text-xs truncate" [title]="training.training_name">
                                  {{ training.training_name }}
                                </div>
                                <div>
                                  <span [ngClass]="{'type-badge-recorded': (training.training_type || '').toLowerCase().includes('record'), 'type-badge-live': !(training.training_type || '').toLowerCase().includes('record')}" class="training-badge">
                                    <i class="fa-solid" [ngClass]="{ 'fa-video-slash': (training.training_type || '').toLowerCase().includes('record'), 'fa-chalkboard': !(training.training_type || '').toLowerCase().includes('record') }"></i>
                                    {{ training.training_type || 'Live' }}
                                  </span>
                                </div>
                              </div>
                              <div *ngIf="training.training_topics" class="text-[11px] text-slate-500 mt-2 line-clamp-2" [title]="training.training_topics">
                                {{ training.training_topics }}
                              </div>
                              <div class="flex items-center gap-2 mt-3 flex-wrap">
                                <div class="muted-xs"><i class="fa-solid fa-user mr-1 text-xs"></i> {{ training.trainer_name }}</div>
                                <div *ngIf="training.training_date" class="muted-xs"><i class="fa-solid fa-calendar-day mr-1 text-xs"></i>{{ training.training_date | date: 'MMM d, y' }}</div>
                              </div>
                            </div>
                            <div
                              *ngIf="getSelectedMembersAlreadyAssigned(training.id).length > 0 && isTrainingSelected(training.id)"
                              class="mt-1 text-[11px] text-amber-700"
                            >
                              <i class="fa-solid fa-circle-exclamation mr-1"></i>
                              {{ getSelectedMembersAlreadyAssigned(training.id).length }} selected member(s) already assigned
                            </div>
                          </td>
                          
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="filteredAssignTrainings.length === 0" class="text-center text-xs text-slate-500 border border-dashed border-slate-200 rounded-lg py-6">
                    <i class="fa-solid fa-circle-info text-slate-400 mb-1 block"></i>
                    No training sessions match your filters.
                  </div>
                </div>

                <!-- Members Section -->
                <div class="space-y-3">
                  <div class="flex items-center justify-between gap-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Team members</span>
                      <span class="text-xs text-slate-400">({{ filteredAssignMembers.length }})</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <button (click)="selectAllMembers()" class="text-[11px] text-cyan-600 hover:text-cyan-800 font-semibold">
                        Select all
                      </button>
                      <span class="h-4 w-px bg-slate-200"></span>
                      <button (click)="clearAllMembers()" class="text-[11px] text-slate-500 hover:text-slate-700 font-semibold">
                        Clear
                      </button>
                    </div>
                  </div>
                  <div class="relative">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                    <input
                      [(ngModel)]="assignMemberSearch"
                      placeholder="Search by name..."
                      class="w-full pl-8 pr-3 py-2 rounded-lg border border-slate-300 focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500 outline-none text-xs"
                    />
                  </div>
                  <div *ngIf="filteredAssignMembers.length > 0" class="border border-slate-200 rounded-lg max-h-80 overflow-y-auto custom-scrollbar">
                    <table class="min-w-full text-xs">
                      <thead class="bg-slate-50 border-b border-slate-200 sticky top-0 z-10">
                        <tr>
                          <th class="px-3 py-2 text-left font-semibold text-slate-600 w-9">
                            <input
                              type="checkbox"
                              (change)="onToggleAllMembers($event)"
                              [checked]="selectedMemberIds.length > 0 && selectedMemberIds.length === filteredAssignMembers.length"
                              class="w-4 h-4 text-cyan-600 rounded border-slate-300 focus:ring-cyan-500 accent-cyan-600"
                            />
                          </th>
                          <th class="px-3 py-2 text-left font-semibold text-slate-600">Member</th>
                          <th class="px-3 py-2 text-left font-semibold text-slate-600 hidden xl:table-cell">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          *ngFor="let member of filteredAssignMembers"
                          [ngClass]="{
                            'bg-emerald-50/60': isMemberSelected(member.id),
                            'hover:bg-slate-50': !isMemberSelected(member.id)
                          }"
                          class="border-b last:border-b-0 border-slate-100 cursor-pointer"
                          (click)="toggleMemberSelection(member.id)"
                        >
                          <td class="px-3 py-2 align-top">
                            <input
                              type="checkbox"
                              [checked]="isMemberSelected(member.id)"
                              (change)="toggleMemberSelection(member.id)"
                              (click)="$event.stopPropagation()"
                              class="w-4 h-4 text-cyan-600 rounded border-slate-300 focus:ring-cyan-500 accent-cyan-600"
                            />
                          </td>
                          <td class="px-3 py-2 align-top">
                            <div class="flex items-center gap-2">
                              <div class="h-7 w-7 rounded-full bg-slate-100 flex items-center justify-center text-[11px] font-semibold text-slate-700">
                                {{ member.name.charAt(0) ? member.name.charAt(0).toUpperCase() : '?' }}
                              </div>
                              <div>
                                <div class="font-semibold text-slate-800 text-xs truncate" [title]="member.name">
                                  {{ member.name }}
                                </div>
                                <div
                                  *ngIf="getSelectedTrainingsAlreadyAssignedForMember(member.id).length > 0 && isMemberSelected(member.id)"
                                  class="mt-0.5 text-[11px] text-amber-700"
                                >
                                  <i class="fa-solid fa-circle-exclamation mr-1"></i>
                                  Already has {{ getSelectedTrainingsAlreadyAssignedForMember(member.id).length }} selected training(s)
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="px-3 py-2 align-top hidden xl:table-cell">
                            <div class="text-[11px] text-slate-500">
                              Selected:
                              <span class="font-semibold text-slate-700">{{ isMemberSelected(member.id) ? 'Yes' : 'No' }}</span>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="filteredAssignMembers.length === 0" class="text-center text-xs text-slate-500 border border-dashed border-slate-200 rounded-lg py-6">
                    <i class="fa-solid fa-circle-info text-slate-400 mb-1 block"></i>
                    No team members match your filters.
                  </div>
                </div>
              </div>
            </div>

            <!-- RIGHT: Summary & confirm -->
            <div class="lg:col-span-1 border-t lg:border-t-0 lg:border-l border-slate-200 pt-4 lg:pt-0 lg:pl-6 space-y-4">
              <!-- Counts -->
              <div class="space-y-2">
                <h3 class="text-sm font-semibold text-slate-800">Summary</h3>
                <div class="flex flex-col gap-1 text-xs text-slate-600">
                  <div class="flex items-center justify-between">
                    <span>Selected trainings</span>
                    <span class="font-semibold text-slate-900">{{ selectedTrainingIds.length }}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span>Selected members</span>
                    <span class="font-semibold text-slate-900">{{ selectedMemberIds.length }}</span>
                  </div>
                  <div class="flex items-center justify-between border-t border-slate-200 pt-2 mt-1">
                    <span class="text-[11px] uppercase tracking-wide text-slate-500">Total combinations</span>
                    <span class="font-semibold text-slate-900">
                      {{ selectedTrainingIds.length * selectedMemberIds.length || 0 }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Target date -->
              <div class="space-y-2">
                <label class="text-xs font-semibold text-slate-700 flex items-center gap-1">
                  Target completion date
                  <span class="text-[10px] font-normal text-slate-400">(optional)</span>
                </label>
                <div class="flex items-center gap-2">
                  <input
                    type="date"
                    [(ngModel)]="assignmentTargetDate"
                    class="w-full px-2.5 py-2 rounded-lg border border-slate-300 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-xs bg-slate-50"
                  />
                  <button
                    *ngIf="assignmentTargetDate"
                    type="button"
                    (click)="assignmentTargetDate = null"
                    class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border border-slate-200 text-[11px] font-semibold text-slate-600 hover:bg-slate-50"
                  >
                    <i class="fa-solid fa-xmark"></i>
                    Clear
                  </button>
                </div>
                <p class="text-[11px] text-slate-500">
                  This date will be attached to each new assignment in this batch.
                </p>
              </div>

              <!-- Info about duplicates -->
              <div class="bg-slate-50 border border-slate-200 rounded-lg p-3 text-[11px] text-slate-600 space-y-1">
                <div class="flex items-center gap-2">
                  <i class="fa-solid fa-circle-info text-slate-400"></i>
                  <span class="font-semibold text-slate-800">Duplicate safety</span>
                </div>
                <p>
                  Any training–member pair that already exists will be skipped automatically and marked in the lists on the left, so you only create
                  truly new assignments.
                </p>
              </div>

              <!-- Assign button -->
              <div class="pt-1">
                <button
                  (click)="assignTraining()"
                  [disabled]="selectedTrainingIds.length === 0 || selectedMemberIds.length === 0 || isAssigningTraining"
                  class="w-full inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-xs font-semibold text-white
                         bg-slate-900 hover:bg-slate-800 disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed
                         focus:outline-none focus:ring-2 focus:ring-slate-300 transition-colors"
                >
                  <ng-container *ngIf="!isAssigningTraining; else assigning">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>
                      Assign {{ selectedTrainingIds.length * selectedMemberIds.length || 0 }}
                      training{{ (selectedTrainingIds.length * selectedMemberIds.length) !== 1 ? 's' : '' }}
                    </span>
                  </ng-container>
                  <ng-template #assigning>
                    <i class="fa-solid fa-spinner fa-spin"></i>
                    <span>Processing assignments…</span>
                  </ng-template>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Professional Success Modal for Training Assignment -->
      <div *ngIf="showAssignmentSuccessModal && assignmentSuccessData" @modalScale
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
        (click)="closeAssignmentSuccessModal()">
        <div (click)="$event.stopPropagation()"
          class="bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden border border-slate-200 transform transition-all duration-300">
          <!-- Professional Header -->
          <div class="bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200 px-4 py-3">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                  <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
                </div>
                <div>
                  <h2 class="text-lg font-bold text-slate-900">Assignment Completed</h2>
                  <p class="text-xs text-slate-600 mt-0.5">Training assignments processed successfully</p>
                </div>
              </div>
              <button (click)="closeAssignmentSuccessModal()"
                class="w-7 h-7 rounded-lg bg-slate-200 hover:bg-slate-300 flex items-center justify-center transition-all duration-200">
                <i class="fa-solid fa-times text-slate-600 text-xs"></i>
              </button>
            </div>
          </div>

          <!-- Content Area -->
          <div class="p-4 space-y-3">
            <!-- Unified Professional Sections -->
            <div class="space-y-3">
              <!-- Training Modules Section -->
              <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-3 border border-blue-100">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center shadow-sm">
                    <i class="fa-solid fa-laptop-code text-white text-sm"></i>
                  </div>
                  <div class="flex-1">
                    <p class="text-xs text-slate-600 font-semibold uppercase tracking-wide">Training Modules Assigned
                    </p>
                    <h3 class="text-sm font-bold text-slate-900 mt-0.5">{{ assignmentSuccessData.trainingNames.length
                      }}
                      {{ assignmentSuccessData.trainingNames.length === 1 ? 'Training' : 'Trainings' }}</h3>
                  </div>
                </div>
                <div class="space-y-1.5 max-h-32 overflow-y-auto pr-1">
                  <div *ngFor="let trainingName of assignmentSuccessData.trainingNames"
                    class="flex items-center gap-2 p-2 bg-white rounded-lg border border-blue-100 shadow-sm">
                    <i class="fa-solid fa-book text-blue-500 text-xs"></i>
                    <span class="font-medium text-slate-700 flex-1 text-xs">{{ trainingName }}</span>
                    <div class="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center">
                      <i class="fa-solid fa-check text-white text-xs"></i>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Team Members Section -->
              <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-lg p-3 border border-emerald-100">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center shadow-sm">
                    <i class="fa-solid fa-users text-white text-sm"></i>
                  </div>
                  <div class="flex-1">
                    <p class="text-xs text-slate-600 font-semibold uppercase tracking-wide">Assigned To</p>
                    <h3 class="text-sm font-bold text-slate-900 mt-0.5">{{ assignmentSuccessData.memberNames.length }}
                      {{ assignmentSuccessData.memberNames.length === 1 ? 'Team Member' : 'Team Members' }}</h3>
                  </div>
                </div>
                <div class="space-y-1.5 max-h-32 overflow-y-auto pr-1">
                  <div *ngFor="let memberName of assignmentSuccessData.memberNames"
                    class="flex items-center gap-2 p-2 bg-white rounded-lg border border-emerald-100 shadow-sm">
                    <div
                      class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center text-white font-semibold text-xs shadow-sm">
                      {{ memberName.charAt(0) }}
                    </div>
                    <span class="font-medium text-slate-700 flex-1 text-xs">{{ memberName }}</span>
                    <div class="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center">
                      <i class="fa-solid fa-check text-white text-xs"></i>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Summary Statistics - Unified Design -->
              <div class="grid grid-cols-2 gap-3">
                <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-3 border border-slate-200">
                  <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-slate-600 rounded-lg flex items-center justify-center shadow-sm">
                      <i class="fa-solid fa-paper-plane text-white text-sm"></i>
                    </div>
                    <div>
                      <p class="text-xs text-slate-600 uppercase tracking-wide font-semibold">Total Assignments</p>
                      <p class="text-xl font-bold text-slate-900 mt-0.5">{{ assignmentSuccessData.totalAssignments }}
                      </p>
                    </div>
                  </div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-3 border border-green-100">
                  <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center shadow-sm">
                      <i class="fa-solid fa-check-circle text-white text-sm"></i>
                    </div>
                    <div>
                      <p class="text-xs text-slate-600 uppercase tracking-wide font-semibold">Status</p>
                      <p class="text-lg font-bold text-green-600 mt-0.5">Completed</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Single Back Button -->
            <div class="pt-3 border-t border-slate-200">
              <button (click)="closeAssignmentSuccessModal()"
                class="w-full bg-slate-900 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-slate-800 transition-all duration-200 shadow-sm hover:shadow-md flex items-center justify-center gap-2">
                <i class="fa-solid fa-arrow-left"></i>
                <span>Back to Assign Training</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Professional Duplicate Assignments Modal -->
      <div *ngIf="showDuplicateModal" @modalScale
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
        (click)="closeDuplicateModal()">
        <div (click)="$event.stopPropagation()"
          class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full overflow-hidden border-2 border-amber-200 transform transition-all duration-300">
          <!-- Header -->
          <div class="relative bg-gradient-to-r from-amber-500 via-orange-500 to-red-500 px-6 py-5 text-white">
            <div class="absolute inset-0 bg-black/10"></div>
            <div class="relative z-10 flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm border-2 border-white/30">
                  <i class="fa-solid fa-exclamation-triangle text-2xl text-white"></i>
                </div>
                <div>
                  <h2 class="text-2xl font-bold">Duplicate Assignments Detected</h2>
                  <p class="text-amber-100 mt-1 text-sm">Some assignments already exist</p>
                </div>
              </div>
              <button (click)="closeDuplicateModal()"
                class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all duration-200 backdrop-blur-sm">
                <i class="fa-solid fa-times text-white"></i>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6 space-y-5">
            <!-- Warning Message -->
            <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-lg">
              <div class="flex items-start gap-3">
                <i class="fa-solid fa-info-circle text-amber-600 text-xl mt-0.5"></i>
                <div class="flex-1">
                  <p class="text-sm font-semibold text-amber-900 mb-1">The following training assignments already
                    exist:
                  </p>
                  <p class="text-xs text-amber-700">These duplicates will be skipped. Only new assignments will be
                    created.</p>
                </div>
              </div>
            </div>

            <!-- Duplicate List -->
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 max-h-80 overflow-y-auto">
              <div class="space-y-2">
                <div *ngFor="let dup of duplicateAssignments; let i = index"
                  class="flex items-center gap-3 p-3 bg-white rounded-lg border border-slate-200 hover:border-amber-300 hover:shadow-sm transition-all">
                  <div
                    class="w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0 border border-amber-200">
                    <span class="text-xs font-bold text-amber-700">{{ i + 1 }}</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-laptop-code text-amber-600 text-sm"></i>
                      <span class="text-sm font-semibold text-slate-700 truncate">{{ dup.training }}</span>
                    </div>
                    <div class="flex items-center gap-2 mt-1">
                      <i class="fa-solid fa-arrow-right text-slate-400 text-xs"></i>
                      <span class="text-xs text-slate-600 truncate">{{ dup.member }}</span>
                    </div>
                  </div>
                  <div class="w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-times text-white text-xs"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Summary -->
            <div class="bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-4 border-2 border-slate-200">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-semibold text-slate-700">New Assignments to Create:</p>
                  <p class="text-xs text-slate-500 mt-0.5">{{ pendingValidAssignments.length }} valid assignment{{
                    pendingValidAssignments.length !== 1 ? 's' : '' }} will be processed</p>
                </div>
                <div class="text-right">
                  <p class="text-sm font-semibold text-slate-700">Duplicates Skipped:</p>
                  <p class="text-xs text-slate-500 mt-0.5">{{ duplicateAssignments.length }} assignment{{
                    duplicateAssignments.length !== 1 ? 's' : '' }}</p>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center gap-3 pt-2">
              <button (click)="closeDuplicateModal()"
                class="flex-1 bg-slate-200 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-300 transition-all duration-200 transform hover:scale-105">
                <i class="fa-solid fa-times mr-2"></i>Cancel
              </button>
              <button (click)="confirmProceedWithAssignments()"
                class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                <i class="fa-solid fa-check mr-2"></i>Proceed with New Assignments
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Feedback Modal -->
      <div *ngIf="showFeedbackModal && selectedSubmissionForFeedback" @modalScale
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
        (click)="closeFeedbackModal()">
        <div (click)="$event.stopPropagation()"
          class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border-2 border-indigo-200 transform transition-all duration-300">
          <!-- Header -->
          <div class="sticky top-0 z-10 bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm border-2 border-white/30">
                  <i class="fa-solid fa-comment-dots text-2xl text-white"></i>
                </div>
                <div>
                  <h2 class="text-2xl font-bold">Performance Feedback</h2>
                  <p class="text-indigo-100 mt-1 text-sm">
                    {{ selectedSubmissionForFeedback.submission.training_name }} - {{
                    selectedSubmissionForFeedback.submission.employee_name }}
                  </p>
                  <p *ngIf="feedbackHistory.length > 0" class="text-xs text-indigo-200 mt-1">
                    <i class="fa-solid fa-info-circle mr-1"></i>{{ feedbackHistory.length }} previous {{
                    feedbackHistory.length === 1 ? 'entry' : 'entries' }} available <span
                      *ngIf="feedbackHistory.length > 0">(Latest: {{ feedbackHistory[0].updated_at | date:'short'
                      }})</span>
                  </p>
                </div>
              </div>
              <button (click)="closeFeedbackModal()"
                class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all duration-200 backdrop-blur-sm">
                <i class="fa-solid fa-times text-white"></i>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6 space-y-6">
            <!-- Previous Feedback History Grouped by Skill Type -->
            <div *ngIf="feedbackHistoryByType.size > 0" class="space-y-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                  <i class="fa-solid fa-history text-indigo-600"></i>
                  Previous Feedback History
                </h3>
                <span
                  class="px-3 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-700 border border-indigo-300">
                  {{ feedbackHistory.length }} {{ feedbackHistory.length === 1 ? 'Entry' : 'Entries' }}
                </span>
              </div>
              <div *ngIf="isLoadingFeedbackHistory" class="text-center py-4">
                <i class="fa-solid fa-spinner fa-spin text-indigo-600 text-xl"></i>
                <p class="text-sm text-slate-600 mt-2">Loading feedback history...</p>
              </div>
              <div *ngIf="!isLoadingFeedbackHistory" class="space-y-4">
                <!-- Iterate over skill types (L1, L2, L3, L4, L5) -->
                <ng-container *ngFor="let skillTypeEntry of getSkillTypeEntries()">
                  <div
                    class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-5 border-2 border-indigo-200 shadow-sm hover:shadow-md transition-all">
                    <!-- Skill Type Header -->
                    <div class="flex items-center justify-between mb-4 pb-3 border-b-2 border-indigo-300">
                      <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-indigo-600 text-white rounded-lg flex items-center justify-center">
                          <i class="fa-solid fa-graduation-cap text-sm"></i>
                        </div>
                        <div>
                          <h4 class="font-bold text-lg text-slate-900">
                            {{ selectedSubmissionForFeedback.submission.training_name || 'N/A' }} - {{
                            getSkillTypeDisplayName(skillTypeEntry.key) }}
                          </h4>
                          <p class="text-xs text-slate-600 mt-0.5">
                            <i class="fa-solid fa-layer-group mr-1"></i>
                            {{ skillTypeEntry.value.length }} Feedback {{ skillTypeEntry.value.length === 1 ? 'Entry'
                            :
                            'Entries' }}
                          </p>
                        </div>
                      </div>
                      <button (click)="openFeedbackHistoryModal(skillTypeEntry.key)"
                        class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold rounded-lg transition-colors flex items-center gap-2 shadow-sm hover:shadow-md">
                        <i class="fa-solid fa-history"></i>
                        History
                      </button>
                    </div>

                    <!-- Latest Feedback for this Type -->
                    <ng-container *ngIf="getLatestFeedbackForType(skillTypeEntry.value) as latestFeedback">
                      <div class="bg-white rounded-lg p-4 border border-indigo-100 shadow-sm">
                        <div class="flex items-center justify-between mb-3">
                          <div class="flex items-center gap-2">
                            <span
                              class="px-2 py-1 text-[10px] font-semibold rounded-full bg-green-100 text-green-700 border border-green-300">
                              <i class="fa-solid fa-star mr-1"></i>Latest
                            </span>
                            <span class="text-xs text-slate-600">
                              <i class="fa-solid fa-clock mr-1"></i>
                              Updated: {{ latestFeedback.updated_at | date:'short' }}
                            </span>
                          </div>
                          <span class="px-3 py-1 text-xs font-semibold rounded-full flex-shrink-0" [ngClass]="{
                                  'bg-green-100 text-green-700': latestFeedback.overall_performance >= 4,
                                  'bg-yellow-100 text-yellow-700': latestFeedback.overall_performance === 3,
                                  'bg-red-100 text-red-700': latestFeedback.overall_performance < 3
                                }">
                            {{ latestFeedback.overall_performance }}/5
                          </span>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 mb-3">
                          <div *ngIf="latestFeedback.application_of_training"
                            class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                            <p class="text-[10px] text-slate-600 font-medium">Application</p>
                            <p class="text-xs font-bold text-slate-800">{{ latestFeedback.application_of_training }}/5
                            </p>
                          </div>
                          <div *ngIf="latestFeedback.quality_of_deliverables"
                            class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                            <p class="text-[10px] text-slate-600 font-medium">Quality</p>
                            <p class="text-xs font-bold text-slate-800">{{ latestFeedback.quality_of_deliverables }}/5
                            </p>
                          </div>
                          <div *ngIf="latestFeedback.problem_solving_capability"
                            class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                            <p class="text-[10px] text-slate-600 font-medium">Problem-Solving</p>
                            <p class="text-xs font-bold text-slate-800">{{ latestFeedback.problem_solving_capability
                              }}/5</p>
                          </div>
                          <div *ngIf="latestFeedback.productivity_independence"
                            class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                            <p class="text-[10px] text-slate-600 font-medium">Productivity</p>
                            <p class="text-xs font-bold text-slate-800">{{ latestFeedback.productivity_independence
                              }}/5
                            </p>
                          </div>
                          <div *ngIf="latestFeedback.process_compliance_adherence"
                            class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                            <p class="text-[10px] text-slate-600 font-medium">Compliance</p>
                            <p class="text-xs font-bold text-slate-800">{{ latestFeedback.process_compliance_adherence
                              }}/5</p>
                          </div>
                        </div>

                        <div
                          *ngIf="latestFeedback.strengths || latestFeedback.improvement_areas || latestFeedback.additional_comments"
                          class="space-y-2">
                          <div *ngIf="latestFeedback.strengths"
                            class="bg-green-50 border-l-2 border-green-400 rounded px-3 py-2">
                            <p class="text-[10px] font-semibold text-green-800 mb-1">
                              <i class="fa-solid fa-thumbs-up mr-1"></i>Strengths
                            </p>
                            <p class="text-xs text-green-700 whitespace-pre-wrap break-words">
                              {{ latestFeedback.strengths }}
                            </p>
                          </div>
                          <div *ngIf="latestFeedback.improvement_areas"
                            class="bg-amber-50 border-l-2 border-amber-400 rounded px-3 py-2">
                            <p class="text-[10px] font-semibold text-amber-800 mb-1">
                              <i class="fa-solid fa-arrow-up mr-1"></i>Improvement Areas
                            </p>
                            <p class="text-xs text-amber-700 whitespace-pre-wrap break-words">
                              {{ latestFeedback.improvement_areas }}
                            </p>
                          </div>
                          <div *ngIf="latestFeedback.additional_comments"
                            class="bg-blue-50 border-l-2 border-blue-400 rounded px-3 py-2">
                            <p class="text-[10px] font-semibold text-blue-800 mb-1">
                              <i class="fa-solid fa-comment mr-1"></i>Comments
                            </p>
                            <p class="text-xs text-blue-700 whitespace-pre-wrap break-words">
                              {{ latestFeedback.additional_comments }}
                            </p>
                          </div>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>

            <!-- New Feedback Form Header -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-200">
              <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i class="fa-solid fa-plus-circle text-indigo-600"></i>
                Provide New Feedback
              </h3>
              <p class="text-sm text-slate-600 mt-1">
                Fill in the details below to provide performance feedback. This will create a new entry and all
                previous
                feedback will be preserved.
              </p>
            </div>

            <!-- Performance Ratings -->
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-5 border border-indigo-100">
              <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-star text-amber-500"></i>
                Performance Ratings (1-5 Scale)
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                <!-- Application of Training in Daily Work -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">
                    Application of Training in Daily Work
                  </label>
                  <p class="text-xs text-slate-500 mb-2">How effectively the employee is using the learned
                    concepts/tools in real tasks.</p>
                  <select [(ngModel)]="performanceFeedback.application_of_training"
                    (ngModelChange)="calculateOverallPerformance()"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                    <option [value]="null">Not Rated</option>
                    <option [value]="1">1 - Poor</option>
                    <option [value]="2">2 - Below Average</option>
                    <option [value]="3">3 - Average</option>
                    <option [value]="4">4 - Good</option>
                    <option [value]="5">5 - Excellent</option>
                  </select>
                </div>

                <!-- Quality of Deliverables -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">
                    Quality of Deliverables
                  </label>
                  <p class="text-xs text-slate-500 mb-2">Impact of training on code quality, test quality, design
                    accuracy, defect reduction, etc.</p>
                  <select [(ngModel)]="performanceFeedback.quality_of_deliverables"
                    (ngModelChange)="calculateOverallPerformance()"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                    <option [value]="null">Not Rated</option>
                    <option [value]="1">1 - Poor</option>
                    <option [value]="2">2 - Below Average</option>
                    <option [value]="3">3 - Average</option>
                    <option [value]="4">4 - Good</option>
                    <option [value]="5">5 - Excellent</option>
                  </select>
                </div>

                <!-- Problem-Solving Capability -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">
                    Problem-Solving Capability
                  </label>
                  <p class="text-xs text-slate-500 mb-2">Ability to apply trained methods to analyze issues, debug,
                    and
                    provide correct solutions.</p>
                  <select [(ngModel)]="performanceFeedback.problem_solving_capability"
                    (ngModelChange)="calculateOverallPerformance()"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                    <option [value]="null">Not Rated</option>
                    <option [value]="1">1 - Poor</option>
                    <option [value]="2">2 - Below Average</option>
                    <option [value]="3">3 - Average</option>
                    <option [value]="4">4 - Good</option>
                    <option [value]="5">5 - Excellent</option>
                  </select>
                </div>

                <!-- Productivity & Independence -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">
                    Productivity & Independence
                  </label>
                  <p class="text-xs text-slate-500 mb-2">Whether the employee completes tasks faster, with less
                    support,
                    and shows improved efficiency after training.</p>
                  <select [(ngModel)]="performanceFeedback.productivity_independence"
                    (ngModelChange)="calculateOverallPerformance()"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                    <option [value]="null">Not Rated</option>
                    <option [value]="1">1 - Poor</option>
                    <option [value]="2">2 - Below Average</option>
                    <option [value]="3">3 - Average</option>
                    <option [value]="4">4 - Good</option>
                    <option [value]="5">5 - Excellent</option>
                  </select>
                </div>

                <!-- Process & Compliance Adherence -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">
                    Process & Compliance Adherence
                  </label>
                  <p class="text-xs text-slate-500 mb-2">Correct use of processes, tools, templates, and standards
                    learned during training (ASPICE, ISO26262, etc.).</p>
                  <select [(ngModel)]="performanceFeedback.process_compliance_adherence"
                    (ngModelChange)="calculateOverallPerformance()"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                    <option [value]="null">Not Rated</option>
                    <option [value]="1">1 - Poor</option>
                    <option [value]="2">2 - Below Average</option>
                    <option [value]="3">3 - Average</option>
                    <option [value]="4">4 - Good</option>
                    <option [value]="5">5 - Excellent</option>
                  </select>
                </div>
              </div>

              <!-- Overall Performance -->
              <div class="mt-5">
                <label class="block text-sm font-semibold text-slate-700 mb-2">
                  Overall Performance <span class="text-red-500">*</span>
                  <span class="text-xs text-slate-500 font-normal ml-2">(Calculated automatically from the five
                    ratings
                    above)</span>
                </label>
                <div class="w-full px-4 py-2 rounded-lg border border-slate-300 bg-slate-50 text-slate-700 font-medium">
                  {{ getOverallPerformanceText() }}
                </div>
              </div>
            </div>

            <!-- Strengths -->
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">
                <i class="fa-solid fa-thumbs-up text-green-600 mr-1"></i>
                Key Strengths
              </label>
              <textarea [(ngModel)]="performanceFeedback.strengths" rows="3"
                placeholder="Describe the key strengths demonstrated by the employee during this training..."
                class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"></textarea>
            </div>

            <!-- Improvement Areas -->
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">
                <i class="fa-solid fa-arrow-up text-amber-600 mr-1"></i>
                Areas for Improvement
              </label>
              <textarea [(ngModel)]="performanceFeedback.improvement_areas" rows="3"
                placeholder="Describe areas where the employee can improve..."
                class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"></textarea>
            </div>

            <!-- Additional Comments -->
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">
                <i class="fa-solid fa-comment text-blue-600 mr-1"></i>
                Additional Comments
              </label>
              <textarea [(ngModel)]="performanceFeedback.additional_comments" rows="4"
                placeholder="Any additional comments or observations..."
                class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center gap-3 pt-4 border-t border-slate-200">
              <button (click)="closeFeedbackModal()"
                class="flex-1 bg-slate-200 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-300 transition-all duration-200">
                <i class="fa-solid fa-times mr-2"></i>Cancel
              </button>
              <button (click)="submitPerformanceFeedback()" [disabled]="isSubmittingFeedback"
                class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl">
                <i *ngIf="!isSubmittingFeedback" class="fa-solid fa-check mr-2"></i>
                <i *ngIf="isSubmittingFeedback" class="fa-solid fa-spinner fa-spin mr-2"></i>
                {{ isSubmittingFeedback ? 'Submitting...' : 'Submit Feedback' }}
              </button>
            </div>

            <!-- Final Evaluation Button -->
            <div class="pt-4 border-t border-slate-200 mt-4">
              <button (click)="openFinalEvaluationModal()"
                class="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-emerald-700 hover:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                <i class="fa-solid fa-trophy mr-2"></i>
                Final Evaluation & Badge Award
              </button>
              <p class="text-xs text-slate-500 mt-2 text-center">
                Assess if the candidate has achieved their target state and award a badge
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback History Modal -->
      <div *ngIf="showFeedbackHistoryModal" @modalScale
        class="fixed inset-0 z-[55] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
        (click)="closeFeedbackHistoryModal()">
        <div (click)="$event.stopPropagation()"
          class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border-2 border-indigo-200 transform transition-all duration-300">
          <!-- Header -->
          <div class="sticky top-0 z-10 bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm border-2 border-white/30">
                  <i class="fa-solid fa-history text-2xl text-white"></i>
                </div>
                <div>
                  <h2 class="text-2xl font-bold">Feedback History</h2>
                  <p class="text-indigo-100 mt-1 text-sm">
                    {{ selectedTrainingNameForHistory }} - {{ getSkillTypeDisplayName(selectedSkillTypeForHistory) }}
                    -
                    {{ selectedEmployeeNameForHistory }}
                  </p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <div *ngIf="feedbackHistoryList.length > 0" class="text-right">
                  <p class="text-xs text-indigo-200">Total Entries</p>
                  <p class="text-lg font-bold text-white">{{ feedbackHistoryList.length }}</p>
                </div>
                <button (click)="closeFeedbackHistoryModal()"
                  class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all duration-200 backdrop-blur-sm">
                  <i class="fa-solid fa-times text-white"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6 space-y-4">
            <div *ngIf="feedbackHistoryList.length > 0" class="space-y-4">
              <div *ngFor="let feedback of feedbackHistoryList; let i = index"
                class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-200 hover:shadow-md transition-all relative"
                [ngClass]="{
                     'border-l-4 border-l-green-500': i === 0,
                     'border-l-4 border-l-purple-500': i > 0
                   }">
                <div class="flex items-start justify-between gap-2 mb-3">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1 flex-wrap">
                      <span *ngIf="i === 0"
                        class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-green-100 text-green-700 border border-green-300 flex-shrink-0"
                        title="Latest feedback">
                        <i class="fa-solid fa-star mr-1"></i>Latest
                      </span>
                      <span *ngIf="i > 0"
                        class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-purple-100 text-purple-700 border border-purple-300 flex-shrink-0"
                        [title]="'Entry ' + (i + 1) + ' of ' + feedbackHistoryList.length">
                        <i class="fa-solid fa-history mr-1"></i>Entry {{ i + 1 }}/{{ feedbackHistoryList.length }}
                      </span>
                    </div>
                    <p class="text-xs text-slate-600">
                      <i class="fa-solid fa-clock mr-1"></i>
                      {{ feedback.updated_at | date:'short' }}
                      <span *ngIf="feedback.created_at !== feedback.updated_at" class="ml-1 text-slate-500">
                        (Updated)
                      </span>
                    </p>
                  </div>
                  <span class="px-3 py-1 text-xs font-semibold rounded-full flex-shrink-0" [ngClass]="{
                          'bg-green-100 text-green-700': feedback.overall_performance >= 4,
                          'bg-yellow-100 text-yellow-700': feedback.overall_performance === 3,
                          'bg-red-100 text-red-700': feedback.overall_performance < 3
                        }">
                    {{ feedback.overall_performance }}/5
                  </span>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 mb-3">
                  <div *ngIf="feedback.application_of_training" class="bg-white/70 rounded px-2 py-1 text-center">
                    <p class="text-[10px] text-slate-600 font-medium">Application</p>
                    <p class="text-xs font-bold text-slate-800">{{ feedback.application_of_training }}/5</p>
                  </div>
                  <div *ngIf="feedback.quality_of_deliverables" class="bg-white/70 rounded px-2 py-1 text-center">
                    <p class="text-[10px] text-slate-600 font-medium">Quality</p>
                    <p class="text-xs font-bold text-slate-800">{{ feedback.quality_of_deliverables }}/5</p>
                  </div>
                  <div *ngIf="feedback.problem_solving_capability" class="bg-white/70 rounded px-2 py-1 text-center">
                    <p class="text-[10px] text-slate-600 font-medium">Problem-Solving</p>
                    <p class="text-xs font-bold text-slate-800">{{ feedback.problem_solving_capability }}/5</p>
                  </div>
                  <div *ngIf="feedback.productivity_independence" class="bg-white/70 rounded px-2 py-1 text-center">
                    <p class="text-[10px] text-slate-600 font-medium">Productivity</p>
                    <p class="text-xs font-bold text-slate-800">{{ feedback.productivity_independence }}/5</p>
                  </div>
                  <div *ngIf="feedback.process_compliance_adherence" class="bg-white/70 rounded px-2 py-1 text-center">
                    <p class="text-[10px] text-slate-600 font-medium">Compliance</p>
                    <p class="text-xs font-bold text-slate-800">{{ feedback.process_compliance_adherence }}/5</p>
                  </div>
                </div>
                <div *ngIf="feedback.strengths || feedback.improvement_areas || feedback.additional_comments"
                  class="space-y-2">
                  <div *ngIf="feedback.strengths" class="bg-green-50 border-l-2 border-green-400 rounded px-3 py-2">
                    <p class="text-[10px] font-semibold text-green-800 mb-1">
                      <i class="fa-solid fa-thumbs-up mr-1"></i>Strengths
                    </p>
                    <p class="text-xs text-green-700 whitespace-pre-wrap break-words">{{ feedback.strengths }}</p>
                  </div>
                  <div *ngIf="feedback.improvement_areas"
                    class="bg-amber-50 border-l-2 border-amber-400 rounded px-3 py-2">
                    <p class="text-[10px] font-semibold text-amber-800 mb-1">
                      <i class="fa-solid fa-arrow-up mr-1"></i>Improvement Areas
                    </p>
                    <p class="text-xs text-amber-700 whitespace-pre-wrap break-words">{{ feedback.improvement_areas }}
                    </p>
                  </div>
                  <div *ngIf="feedback.additional_comments"
                    class="bg-blue-50 border-l-2 border-blue-400 rounded px-3 py-2">
                    <p class="text-[10px] font-semibold text-blue-800 mb-1">
                      <i class="fa-solid fa-comment mr-1"></i>Comments
                    </p>
                    <p class="text-xs text-blue-700 whitespace-pre-wrap break-words">{{ feedback.additional_comments
                      }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="feedbackHistoryList.length === 0" class="text-center py-12 text-slate-500">
              <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-history text-3xl text-slate-400"></i>
              </div>
              <p class="text-lg font-semibold text-slate-700 mb-2">No History Available</p>
              <p class="text-sm text-slate-500 max-w-md mx-auto">No feedback history found for <span
                  class="font-medium text-slate-700">{{ selectedTrainingNameForHistory }} - {{
                  getSkillTypeDisplayName(selectedSkillTypeForHistory) }}</span>.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Success Popup Modal -->
      <div *ngIf="showSuccessPopup" @modalScale
        class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
        (click)="closeSuccessPopup()">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all"
          (click)="$event.stopPropagation()">
          <div class="flex items-center justify-center mb-4">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
              <i class="fa-solid fa-check-circle text-green-600 text-3xl"></i>
            </div>
          </div>
          <h3 class="text-2xl font-bold text-slate-800 text-center mb-3">Success!</h3>
          <p class="text-slate-600 text-center mb-6">{{ successPopupMessage }}</p>
          <button (click)="closeSuccessPopup()"
            class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl">
            <i class="fa-solid fa-check mr-2"></i>OK
          </button>
        </div>
      </div>

      <!-- Attendance Success Popup Modal -->
      <div *ngIf="showAttendanceSuccessPopup && attendanceSuccessData" @modalScale
        class="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/70 backdrop-blur-md"
        (click)="closeAttendanceSuccessPopup()">
        <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full transform transition-all border-2 border-green-200"
          (click)="$event.stopPropagation()">
          <!-- Header with gradient -->
          <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-t-3xl px-6 py-5">
            <div class="flex items-center justify-center mb-2">
              <div
                class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border-4 border-white/30">
                <i class="fa-solid fa-check-circle text-white text-4xl"></i>
              </div>
            </div>
            <h3 class="text-2xl font-bold text-white text-center">Attendance Saved!</h3>
          </div>

          <!-- Content -->
          <div class="p-6 space-y-4">
            <div class="text-center">
              <p class="text-lg font-semibold text-slate-800 mb-1">{{ attendanceSuccessData.trainingName }}</p>
              <p class="text-sm text-slate-500">Attendance has been marked successfully</p>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-3 gap-3 mt-4">
              <div class="bg-green-50 rounded-xl p-4 text-center border-2 border-green-200">
                <div class="text-2xl font-bold text-green-700">{{ attendanceSuccessData.attendedCount }}</div>
                <div class="text-xs font-medium text-green-600 mt-1">Attended</div>
              </div>
              <div class="bg-red-50 rounded-xl p-4 text-center border-2 border-red-200">
                <div class="text-2xl font-bold text-red-700">{{ attendanceSuccessData.absentCount }}</div>
                <div class="text-xs font-medium text-red-600 mt-1">Absent</div>
              </div>
              <div class="bg-blue-50 rounded-xl p-4 text-center border-2 border-blue-200">
                <div class="text-2xl font-bold text-blue-700">{{ attendanceSuccessData.totalCount }}</div>
                <div class="text-xs font-medium text-blue-600 mt-1">Total</div>
              </div>
            </div>

            <!-- Attended Candidates List -->
            <div *ngIf="attendanceSuccessData.attendedNames" class="mt-4 pt-4 border-t border-slate-200">
              <p class="text-sm font-semibold text-slate-700 mb-2">
                <i class="fa-solid fa-users mr-2 text-green-600"></i>Attended Candidates:
              </p>
              <p class="text-sm text-slate-600 bg-slate-50 rounded-lg p-3 max-h-32 overflow-y-auto">
                {{ attendanceSuccessData.attendedNames }}
              </p>
            </div>
          </div>

          <!-- Footer Button -->
          <div class="px-6 pb-6">
            <button (click)="closeAttendanceSuccessPopup()"
              class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02]">
              <i class="fa-solid fa-check mr-2"></i>Got it!
            </button>
          </div>
        </div>
      </div>

      <!-- Final Evaluation Modal -->
      <div *ngIf="showFinalEvaluationModal && selectedSubmissionForFeedback" @modalScale
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
        (click)="closeFinalEvaluationModal()">
        <div (click)="$event.stopPropagation()"
          class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto border-2 border-emerald-200 transform transition-all duration-300">
          <!-- Header -->
          <div class="sticky top-0 z-10 bg-gradient-to-r from-emerald-600 to-teal-600 px-6 py-5 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm border-2 border-white/30">
                  <i class="fa-solid fa-trophy text-2xl text-white"></i>
                </div>
                <div>
                  <h2 class="text-2xl font-bold">Final Evaluation & Badge Award</h2>
                  <p class="text-emerald-100 mt-1 text-sm">
                    {{ selectedSubmissionForFeedback.submission.training_name }} - {{
                    selectedSubmissionForFeedback.submission.employee_name }}
                  </p>
                  <p class="text-xs text-emerald-200 mt-1">
                    <i class="fa-solid fa-info-circle mr-1"></i>Assess if the candidate has achieved their target
                    state
                  </p>
                </div>
              </div>
              <button (click)="closeFinalEvaluationModal()"
                class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all duration-200 backdrop-blur-sm">
                <i class="fa-solid fa-times text-white"></i>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6 space-y-6">
            <div *ngIf="isLoadingEmployeeSkills" class="text-center py-8">
              <i class="fa-solid fa-spinner fa-spin text-emerald-600 text-3xl mb-3"></i>
              <p class="text-slate-600">Loading employee skills...</p>
            </div>

            <div *ngIf="!isLoadingEmployeeSkills && employeeSkillsForEvaluation.length > 0">
              <!-- Skills List -->
              <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-5 border border-emerald-100 mb-4">
                <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <i class="fa-solid fa-list-check text-emerald-600"></i>
                  Skills Assessment
                </h3>
                <div class="space-y-3 max-h-96 overflow-y-auto pr-2">
                  <div *ngFor="let skill of employeeSkillsForEvaluation"
                    class="bg-white rounded-lg p-4 border-2 transition-all" [ngClass]="{
                         'border-emerald-300 shadow-md': skill.targetAchieved,
                         'border-slate-200': !skill.targetAchieved
                       }">
                    <div class="flex items-start justify-between gap-4">
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                          <h4 class="font-bold text-slate-900 text-base">{{ skill.skill }}</h4>
                          <span *ngIf="skill.targetAchieved"
                            class="px-2 py-0.5 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-700 border border-emerald-300">
                            <i class="fa-solid fa-check-circle mr-1"></i>Target Achieved
                          </span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-3">
                          <div class="bg-slate-50 rounded-lg p-2">
                            <p class="text-xs text-slate-500 mb-1">Current State</p>
                            <p class="font-semibold text-slate-800">{{ skill.current_expertise }}</p>
                          </div>
                          <div class="bg-emerald-50 rounded-lg p-2">
                            <p class="text-xs text-slate-500 mb-1">Target State</p>
                            <p class="font-semibold text-emerald-800">{{ skill.target_expertise }}</p>
                          </div>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="checkbox" [id]="'achieved-' + skill.skill" [(ngModel)]="skill.targetAchieved"
                            class="w-4 h-4 text-emerald-600 border-slate-300 rounded focus:ring-emerald-500">
                          <label [for]="'achieved-' + skill.skill" class="text-sm text-slate-700 cursor-pointer">
                            Candidate has achieved target state for this skill
                          </label>
                        </div>
                        <div *ngIf="skill.targetAchieved"
                          class="mt-3 bg-emerald-50 border-l-4 border-emerald-500 rounded p-3">
                          <p class="text-xs text-emerald-800 font-semibold mb-1">
                            <i class="fa-solid fa-info-circle mr-1"></i>Action on Approval:
                          </p>
                          <p class="text-xs text-emerald-700">
                            Current state will be updated to <strong>{{ skill.target_expertise }}</strong> and a badge
                            will be awarded.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Summary -->
              <div class="bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-4 border-2 border-slate-200">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-semibold text-slate-700">Skills to Update:</p>
                    <p class="text-xs text-slate-500 mt-0.5">{{ getAchievedSkillsCount() }} skill{{
                      getAchievedSkillsCount() !== 1 ? 's' : '' }} selected</p>
                  </div>
                  <div class="text-right">
                    <p class="text-sm font-semibold text-slate-700">Badges to Award:</p>
                    <p class="text-xs text-slate-500 mt-0.5">{{ getAchievedSkillsCount() }} badge{{
                      getAchievedSkillsCount() !== 1 ? 's' : '' }}</p>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="!isLoadingEmployeeSkills && employeeSkillsForEvaluation.length === 0"
              class="text-center py-8 bg-slate-50 rounded-xl">
              <i class="fa-solid fa-info-circle text-slate-400 text-3xl mb-3"></i>
              <p class="text-slate-600">No skills found for this employee.</p>
            </div>

            <!-- Manager Satisfaction Section -->
            <div *ngIf="!isLoadingEmployeeSkills && employeeSkillsForEvaluation.length > 0"
              class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border-2 border-amber-200">
              <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-clipboard-check text-amber-600"></i>
                Manager Evaluation
              </h3>
              <div class="space-y-3">
                <div class="flex items-center gap-3">
                  <input type="radio" id="satisfied-option" name="satisfaction" [value]="true"
                    (change)="isManagerSatisfied = true" [checked]="isManagerSatisfied === true"
                    class="w-4 h-4 text-emerald-600 border-slate-300 focus:ring-emerald-500">
                  <label for="satisfied-option" class="text-sm text-slate-700 cursor-pointer flex items-center gap-2">
                    <i class="fa-solid fa-check-circle text-emerald-600"></i>
                    <span>I am satisfied with the candidate's performance</span>
                  </label>
                </div>
                <div class="flex items-center gap-3">
                  <input type="radio" id="not-satisfied-option" name="satisfaction" [value]="false"
                    (change)="isManagerSatisfied = false" [checked]="isManagerSatisfied === false"
                    class="w-4 h-4 text-amber-600 border-slate-300 focus:ring-amber-500">
                  <label for="not-satisfied-option"
                    class="text-sm text-slate-700 cursor-pointer flex items-center gap-2">
                    <i class="fa-solid fa-times-circle text-amber-600"></i>
                    <span>I am not satisfied - Reassign training</span>
                  </label>
                </div>
                <div *ngIf="isManagerSatisfied === false"
                  class="mt-3 bg-amber-100 border-l-4 border-amber-500 rounded p-3">
                  <p class="text-xs text-amber-800 font-semibold mb-1">
                    <i class="fa-solid fa-info-circle mr-1"></i>Action on Reassignment:
                  </p>
                  <p class="text-xs text-amber-700">
                    The training will be reassigned to the employee, allowing them to retake it. No badges will be
                    awarded.
                  </p>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center gap-3 pt-4 border-t border-slate-200">
              <button (click)="closeFinalEvaluationModal()"
                class="flex-1 bg-slate-200 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-300 transition-all duration-200">
                <i class="fa-solid fa-times mr-2"></i>Cancel
              </button>
              <button *ngIf="isManagerSatisfied !== false" (click)="submitFinalEvaluation()"
                [disabled]="isSubmittingEvaluation || getAchievedSkillsCount() === 0 || isManagerSatisfied === null"
                class="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-emerald-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl">
                <i *ngIf="!isSubmittingEvaluation" class="fa-solid fa-trophy mr-2"></i>
                <i *ngIf="isSubmittingEvaluation" class="fa-solid fa-spinner fa-spin mr-2"></i>
                {{ isSubmittingEvaluation ? 'Processing...' : 'Approve & Award Badges' }}
              </button>
              <button *ngIf="isManagerSatisfied === false" (click)="reassignTraining()"
                [disabled]="isReassigningTraining"
                class="flex-1 bg-gradient-to-r from-amber-600 to-orange-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-amber-700 hover:to-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl">
                <i *ngIf="!isReassigningTraining" class="fa-solid fa-redo mr-2"></i>
                <i *ngIf="isReassigningTraining" class="fa-solid fa-spinner fa-spin mr-2"></i>
                {{ isReassigningTraining ? 'Reassigning...' : 'Reassign Training' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && !errorMessage && activeTab === 'assignedTrainings' && manager" class="space-y-6">
        <div #animatedElement class="animate-on-scroll">
        </div>

        <div *ngIf="assignedTrainingsView === 'list'">
          <div *ngIf="filteredAssignedTrainings && filteredAssignedTrainings.length > 0; else noAssigned"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <div *ngFor="let training of filteredAssignedTrainings"
              [attr.data-training-id]="training.id"
              class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg border border-slate-200/60 p-4 hover:shadow-xl hover:-translate-y-1 transition-all duration-300"
              [ngClass]="{'ring-4 ring-amber-400 shadow-amber-300/50': selectedTrainingFromCalendar === training.id}">
              <div class="flex items-start gap-3 mb-3">
                <div
                  class="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-sky-100 text-sky-600">
                  <i class="fa-solid fa-laptop-code text-lg"></i>
                </div>
                <div class="flex-1">
                  <h3 class="text-lg font-bold text-slate-800">{{ training.training_name }}</h3>
                  <p class="text-sm text-slate-500">by {{ training.trainer_name }}</p>
                </div>
                <span
                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-sky-100 text-sky-800">
                  <i class="fa-solid fa-user-check mr-1"></i>
                  Assigned to Me
                </span>
              </div>

              <div class="space-y-3">
                <div class="flex items-center gap-2 flex-wrap">
                  <span
                    class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-indigo-100 text-indigo-800">
                    <i class="fa-solid fa-display mr-1.5"></i>{{ training.training_type || 'N/A' }}
                  </span>
                  <span
                    class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-violet-100 text-violet-800">
                    <i class="fa-solid fa-layer-group mr-1.5"></i>{{ training.skill_category || 'N/A' }}
                  </span>
                  <span *ngIf="training.skill"
                    class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-rose-100 text-rose-800">
                    <i class="fa-solid fa-code mr-1.5"></i>{{ training.skill }}
                  </span>
                </div>

                <div class="text-sm text-slate-600">
                  <p><strong class="font-semibold text-slate-700">Topics:</strong> {{ training.training_topics || 'Not
                    specified' }}</p>
                </div>

                <div class="flex items-center justify-between text-sm text-slate-600 pt-3 border-t border-slate-200/80">
                  <div class="flex items-center gap-2">
                    <i class="fa-solid fa-calendar-days text-slate-400"></i>
                    <span class="font-medium">{{ training.training_date ? (training.training_date | date:'mediumDate')
                      :
                      'Date TBD' }}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <i class="fa-solid fa-clock text-slate-400"></i>
                    <span class="font-medium">{{ training.time || 'Time TBD' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noAssigned>
            <div
              class="text-center py-20 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border-2 border-dashed border-slate-300">
              <div
                class="w-20 h-20 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-inbox text-slate-400 text-4xl"></i>
              </div>
              <h4 class="text-2xl font-bold text-slate-800 mb-2">No Assigned Trainings</h4>
              <p class="text-slate-600 max-w-md mx-auto">No trainings have been assigned to you by your manager yet,
                or
                none match your current filters.</p>
            </div>
          </ng-template>
        </div>

        <div *ngIf="assignedTrainingsView === 'calendar'">
          <div class="bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-slate-200/60">
            <div class="flex justify-between items-center mb-6">
              <button (click)="previousMonth()"
                class="w-10 h-10 bg-slate-200/70 rounded-lg hover:bg-slate-300/80 transition-colors flex items-center justify-center">
                <i class="fa-solid fa-chevron-left"></i>
              </button>
              <h3 class="text-2xl font-bold text-slate-800">{{ calendarMonth }} {{ calendarYear }}</h3>
              <button (click)="nextMonth()"
                class="w-10 h-10 bg-slate-200/70 rounded-lg hover:bg-slate-300/80 transition-colors flex items-center justify-center">
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
            <div class="grid grid-cols-7 gap-2 text-center">
              <div class="font-bold text-slate-500 py-2">SUN</div>
              <div class="font-bold text-slate-500 py-2">MON</div>
              <div class="font-bold text-slate-500 py-2">TUE</div>
              <div class="font-bold text-slate-500 py-2">WED</div>
              <div class="font-bold text-slate-500 py-2">THU</div>
              <div class="font-bold text-slate-500 py-2">FRI</div>
              <div class="font-bold text-slate-500 py-2">SAT</div>

              <div *ngFor="let day of calendarDays"
                class="relative h-20 font-semibold rounded-lg transition-colors border border-slate-200/60" [ngClass]="{
                     'bg-sky-50': isToday(day),
                     'bg-white': day && !isToday(day),
                     'bg-slate-50/50': !day,
                     'text-slate-400': !day || day.getMonth() !== currentDate.getMonth()
                   }">
                <div *ngIf="day"
                  class="absolute top-1.5 left-2 text-sm w-6 h-6 flex items-center justify-center rounded-full"
                  [ngClass]="{'bg-sky-500 text-white': isToday(day), 'text-slate-800': !isToday(day)}">
                  {{ day.getDate() }}
                </div>
                <div
                  *ngFor="let event of getEventForDate(day, assignedTrainingsCalendarEvents); trackBy: trackByEventId"
                  class="absolute top-9 left-1 right-1 p-1 text-xs bg-rose-100 text-rose-900 rounded cursor-pointer leading-tight shadow-sm hover:bg-rose-200 hover:ring-2 hover:ring-rose-400 z-10 transition-all duration-200"
                  [title]="event.title + ' - by ' + event.trainer"
                  (click)="onCalendarEventClick(event)">
                  <p class="font-bold truncate">
                    <i class="fa-solid fa-circle text-rose-500 text-xs mr-1 align-middle"></i>{{ event.title }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="activeTab === 'myRequests'" @slideFadeIn class="space-y-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4" [@listStagger]="getFilteredRequests().length">
          <div *ngFor="let request of getFilteredRequests()"
            class="bg-white/70 backdrop-blur-sm p-4 rounded-2xl shadow-lg border border-slate-200/60 transform hover:-translate-y-1 transition-all duration-300 hover:shadow-xl flex flex-col gap-3">
            <div class="flex items-start justify-between">
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 bg-sky-100 text-sky-600 rounded-lg flex items-center justify-center flex-shrink-0">
                  <i [ngClass]="getTrainingCardIcon(request.training.skill)" class="text-lg"></i>
                </div>
                <div>
                  <h3 class="text-sm font-bold text-slate-800">{{ request.training.training_name }}</h3>
                  <p class="text-xs text-slate-500">by {{ request.training.trainer_name }}</p>
                </div>
              </div>
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-yellow-100 text-yellow-800 ring-1 ring-inset ring-yellow-200': request.status === 'pending',
                  'bg-green-100 text-green-800 ring-1 ring-inset ring-green-200': request.status === 'approved',
                  'bg-red-100 text-red-800 ring-1 ring-inset ring-red-200': request.status === 'rejected'
                }">
                <i class="fa-solid fa-clock mr-1" *ngIf="request.status === 'pending'"></i>
                <i class="fa-solid fa-check mr-1" *ngIf="request.status === 'approved'"></i>
                <i class="fa-solid fa-times mr-1" *ngIf="request.status === 'rejected'"></i>
                {{ request.status | titlecase }}
              </span>
            </div>
            
            <div class="border-t border-slate-200/80 pt-3">
              <div class="flex items-center justify-between text-xs text-slate-600 mb-2">
                <div class="flex items-center gap-1.5">
                  <i class="fa-solid fa-calendar-days text-slate-400"></i>
                  <span class="font-semibold text-slate-800">Requested: {{ request.request_date | date:'mediumDate' }}</span>
                </div>
                <div class="flex items-center gap-1.5" *ngIf="request.response_date">
                  <i class="fa-solid fa-clock text-slate-400"></i>
                  <span class="font-semibold text-slate-800">Responded: {{ request.response_date | date:'mediumDate' }}</span>
                </div>
              </div>
              
              <div class="flex items-center gap-1.5 flex-wrap mb-2">
                <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200">
                  <i class="fa-solid fa-display mr-1"></i>{{ request.training.training_type || 'N/A' }}
                </span>
                <span *ngIf="request.training.skill_category" class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200">
                  <i class="fa-solid fa-layer-group mr-1"></i>{{ request.training.skill_category }}
                </span>
                <span *ngIf="request.training.skill" class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-200">
                  <i class="fa-solid fa-code mr-1"></i>{{ request.training.skill }}
                </span>
              </div>

              <div *ngIf="request.manager_notes" class="mt-2 p-2 bg-slate-50 rounded-lg border border-slate-200">
                <p class="text-xs text-slate-600">
                  <strong class="font-semibold text-slate-700">Manager Notes:</strong> {{ request.manager_notes }}
                </p>
              </div>

              <!-- Cancel Request Button for Pending Requests -->
              <div *ngIf="request.status === 'pending'" class="mt-3 pt-3 border-t border-slate-200/80 space-y-1">
                <button disabled class="w-full bg-yellow-100 text-yellow-800 px-3 py-1.5 rounded-lg font-semibold text-xs hover:bg-yellow-100 transition-colors disabled:cursor-not-allowed">
                  <i class="fa-solid fa-clock mr-1"></i>Request Pending
                </button>
                <button (click)="cancelEnrollment(request.training)" class="w-full bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg font-semibold text-xs transition-colors shadow-md hover:shadow-lg">
                  <i class="fa-solid fa-trash mr-1"></i>Cancel Request
                </button>
              </div>

              <!-- Approved Status -->
              <div *ngIf="request.status === 'approved'" class="mt-3 pt-3 border-t border-slate-200/80">
                <button disabled class="w-full bg-green-100 text-green-800 px-3 py-1.5 rounded-lg font-semibold text-xs hover:bg-green-100 transition-colors disabled:cursor-not-allowed">
                  <i class="fa-solid fa-check mr-1"></i>Approved
                </button>
              </div>

              <!-- Rejected Status -->
              <div *ngIf="request.status === 'rejected'" class="mt-3 pt-3 border-t border-slate-200/80">
                <button disabled class="w-full bg-red-100 text-red-800 px-3 py-1.5 rounded-lg font-semibold text-xs hover:bg-red-100 transition-colors disabled:cursor-not-allowed mb-1">
                  <i class="fa-solid fa-times mr-1"></i>Rejected
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="getFilteredRequests().length === 0" class="text-center py-20 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border-2 border-dashed border-slate-300">
          <div class="w-20 h-20 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fa-solid fa-inbox text-slate-400 text-4xl"></i>
          </div>
          <h4 class="text-2xl font-bold text-slate-800 mb-2">
            <span *ngIf="trainingRequests.length === 0">No Training Requests</span>
            <span *ngIf="trainingRequests.length > 0">No Requests Match Your Filters</span>
          </h4>
          <p class="text-slate-600 max-w-md mx-auto">
            <span *ngIf="trainingRequests.length === 0">You haven't requested any trainings yet. Browse the Training Catalog to find courses you'd like to take!</span>
            <span *ngIf="trainingRequests.length > 0">Try adjusting your filters or search terms to see more results.</span>
          </p>
        </div>
      </div>

      <div *ngIf="activeTab === 'myBadges'" @slideFadeIn>
        <div class="bg-blue-600 px-6 py-3 shadow-lg rounded-2xl mx-6 mt-4 mb-6">
          <div class="flex flex-wrap items-center justify-between gap-2">
            <div class="flex items-center gap-2 text-white">
              <h2 class="text-sm font-semibold">My Badges & Achievements</h2>
            </div>
            <div class="flex flex-wrap items-center gap-1.5">
              <div class="relative">
                <i class="fa-solid fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                <input type="text" [(ngModel)]="badgeSearch" placeholder="Search badges..."
                  class="w-full sm:w-48 pl-8 pr-3 py-1 rounded-md border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white transition-all duration-300 focus:w-64 text-sm">
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="getFilteredBadges().length > 0" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8" [@listStagger]="getFilteredBadges().length">
          <div *ngFor="let badge of getFilteredBadges()"
            class="group flex flex-col items-center text-center p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60 transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl">
            <div class="relative w-36 h-36">
              <div
                class="absolute inset-0 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full transform group-hover:scale-110 transition-transform duration-300 shadow-lg">
              </div>
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="w-28 h-28 bg-white/30 backdrop-blur-sm rounded-full"></div>
              </div>
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="w-24 h-24 bg-white rounded-full shadow-inner">
                  <i class="fa-solid fa-award text-5xl text-amber-500 group-hover:animate-pulse mt-5"></i>
                </div>
              </div>
            </div>
            <h3 class="mt-6 text-xl font-bold text-slate-800">{{ badge.skill }}</h3>
            <p class="text-sm text-slate-500 mt-1">Competency Met</p>
            <p class="text-xs text-slate-400 mt-2">Achieved on {{ getFormattedDate() }}</p>
          </div>
        </div>
        <div *ngIf="getFilteredBadges().length === 0"
          class="text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60">
          <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa-solid fa-award text-slate-400 text-3xl"></i>
          </div>
          <h4 class="text-xl font-semibold text-slate-900 mb-2">No Badges Earned Yet</h4>
          <p class="text-slate-600">Keep learning and meeting your skill targets to earn badges!</p>
        </div>
      </div>
      
      <div *ngIf="activeTab === 'levels'" @slideFadeIn>
        <div class="bg-blue-600 px-6 py-3 shadow-lg rounded-2xl mx-6 mt-4 mb-6">
          <div class="flex flex-wrap items-center justify-between gap-2">
            <div class="flex items-center gap-2 text-white">
              <h2 class="text-sm font-semibold">Levels Definitions</h2>
            </div>
            <div class="flex flex-wrap items-center gap-1.5">
              <div class="relative">
                <i class="fa-solid fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                <input [(ngModel)]="levelsSearch" type="text" placeholder="Search levels, keywords..."
                  class="w-full sm:w-48 pl-8 pr-3 py-1 rounded-md border border-slate-300 focus:ring-2 focus:ring-sky-500 outline-none bg-white transition-all duration-300 focus:w-64 text-sm" />
              </div>
              <app-searchable-dropdown
                [(ngModel)]="selectedSkills"
                [options]="sectionTitles"
                placeholder="All Skills"
                allOptionLabel="All Skills"
                allOptionValue=""
                iconClass="fa-filter"
                [multiple]="true"
                width="w-full sm:w-auto min-w-[140px]">
              </app-searchable-dropdown>
            </div>
          </div>
        </div>
      
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/60 overflow-auto">
          <div class="grid min-w-[1200px] sticky top-0 z-20" style="grid-template-columns: minmax(220px, 16%) repeat(5, 1fr);">
            <div class="px-4 py-3 font-bold text-xs text-slate-700 uppercase bg-slate-200/70 border-b border-slate-300">Skill</div>
            <div *ngFor="let header of levelHeaders" class="px-4 py-3 font-bold text-xs text-slate-700 uppercase bg-slate-200/70 border-b border-l border-slate-300">
              L{{ header.num }} - {{ header.title }}
            </div>
          </div>
          
          <div class="min-w-[1200px]">
            <ng-container *ngIf="getFilteredSections().length > 0; else noLevelsFound">
              <div *ngFor="let section of getFilteredSections()" class="grid border-b border-slate-200 last:border-b-0" style="grid-template-columns: minmax(220px, 16%) repeat(5, 1fr);">
                
                <div class="sticky left-0 z-10 px-4 py-3 font-bold text-slate-800 bg-slate-50/90 border-r border-slate-200 flex items-center">
                  <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg flex-shrink-0 flex items-center justify-center bg-gradient-to-br from-sky-100 to-sky-50">
                      <i [ngClass]="getTrainingCardIcon(section.title)" class="text-sky-600"></i>
                    </div>
                    <div>
                      {{ section.title }}
                      <p *ngIf="section.subtitle" class="text-xs font-normal text-slate-500">{{ section.subtitle }}</p>
                    </div>
                  </div>
                </div>
                
                <div *ngFor="let header of levelHeaders" class="text-sm px-4 py-3 align-top border-l border-slate-200 bg-white">
                  <ng-container *ngIf="getLevelItems(section, header.num) as items">
                    <ul *ngIf="items.length > 0" class="space-y-1.5 list-disc list-inside text-slate-700">
                      <li *ngFor="let item of items">{{ item }}</li>
                    </ul>
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </div>
          <ng-template #noLevelsFound>
            <div class="min-w-[1200px] text-center py-20">
              <div class="w-20 h-20 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-magnifying-glass text-slate-400 text-4xl"></i>
              </div>
              <h4 class="text-2xl font-bold text-slate-800 mb-2">No Levels Found</h4>
              <p class="text-slate-600 max-w-md mx-auto">No skills or levels match your current filters. Try changing your search.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </main>
  </div>
</div>

<div *ngIf="showDetailModal" (click)="closeDetailModal()"
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl m-4 transform transition-all"
    (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-slate-50 rounded-t-2xl border-b border-slate-200">
      <h3 class="text-xl font-bold text-slate-900">{{ modalTitle }}</h3>
      <button (click)="closeDetailModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="max-h-[60vh] overflow-y-auto p-6">
      <div *ngIf="modalData.length === 0" class="text-center text-slate-500 p-8">No data to display.</div>

      <ul *ngIf="modalDataType === 'members'" class="space-y-3">
        <li *ngFor="let member of modalData" class="flex items-center bg-slate-50/70 p-3 rounded-lg">
          <img src="https://ui-avatars.com/api/?name={{member.name}}&background=random&color=fff&size=40" alt="avatar"
            class="rounded-full h-10 w-10 mr-4">
          <span class="font-semibold text-slate-800">{{ member.name }}</span>
        </li>
      </ul>

      <div *ngIf="modalDataType === 'skills'" class="space-y-3">
        <div *ngFor="let skill of modalData" class="bg-slate-50/70 p-3 rounded-lg">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <p class="font-bold text-slate-800">{{ skill.skill || skill.skill_name }}</p>
              <p *ngIf="skill.memberName" class="text-sm text-slate-500">Member: {{ skill.memberName }}</p>
            </div>
            <div *ngIf="skill.current_expertise || skill.target_expertise || skill.status" class="px-3 py-1 text-sm font-semibold rounded-full"
              [ngClass]="{
                'bg-slate-100 text-slate-700': getTimelineStatus(skill) === 'Not Started',
                'bg-orange-100 text-orange-700': getTimelineStatus(skill) === 'Behind',
                'bg-sky-100 text-sky-800': getTimelineStatus(skill) === 'On Track',
                'bg-emerald-100 text-emerald-700': getTimelineStatus(skill) === 'Completed'
              }">
              {{ getTimelineStatus(skill) }}
            </div>
            <div *ngIf="skill.skill_level" class="px-3 py-1 text-sm font-semibold rounded-full"
              [ngClass]="getSkillLevelColor(skill.skill_level)">
              {{ skill.skill_level }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div *ngIf="showScheduleTrainingModal"
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50"
  (click)="closeScheduleTrainingModal()">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl m-4 transform transition-all"
    (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-slate-50 rounded-t-2xl border-b border-slate-200">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-calendar-plus text-2xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-900">Schedule a New Training</h3>
          <p class="text-sm text-slate-500">Create a new session for the training catalog.</p>
        </div>
      </div>
      <button (click)="closeScheduleTrainingModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <form (ngSubmit)="scheduleTraining()" #trainingForm="ngForm" class="max-h-[75vh] overflow-y-auto p-8">
      <div class="space-y-8">
        <fieldset>
          <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Core Details
          </legend>
          <div class="space-y-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Training Name *</label>
              <div class="relative">
                <i class="fa-solid fa-laptop-code absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="text" [(ngModel)]="newTraining.training_name" name="training_name" required
                  placeholder="e.g., Advanced Python for Automation"
                  class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Topics Covered</label>
              <div class="relative">
                <i class="fa-solid fa-list-check absolute left-4 top-5 -translate-y-1/2 text-slate-400"></i>
                <textarea [(ngModel)]="newTraining.training_topics" name="training_topics" rows="3"
                  placeholder="List the main topics separated by commas..."
                  class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Classification
          </legend>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Division</label>
              <input type="text" [(ngModel)]="newTraining.division" name="division" placeholder="e.g., R&D"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Department</label>
              <input type="text" [(ngModel)]="newTraining.department" name="department" placeholder="e.g., Software"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Competency</label>
              <input type="text" [(ngModel)]="newTraining.competency" name="competency" placeholder="e.g., Python"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Skill</label>
              <select [(ngModel)]="newTraining.skill" name="skill"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                <option value="">Select Skill</option>
                <option *ngFor="let name of skillNames" [value]="name">{{ name }}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Skill Category</label>
              <select [(ngModel)]="newTraining.skill_category" name="skill_category"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                <option *ngFor="let level of skillCategoryLevels" [value]="level">{{ level }}</option>
              </select>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Trainer
            Information</legend>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Trainer Name *</label>
              <div class="relative">
                <i class="fa-solid fa-chalkboard-user absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="text" [(ngModel)]="newTraining.trainer_name" name="trainer_name" required
                  placeholder="Enter trainer's full name"
                  class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Trainer Email</label>
              <div class="relative">
                <i class="fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="email" [(ngModel)]="newTraining.email" name="email" placeholder="Enter trainer's email"
                  class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Logistics &
            Scheduling</legend>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Date *</label>
              <input type="date" [(ngModel)]="newTraining.training_date" name="training_date" required
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Time</label>
              <input type="time" [(ngModel)]="newTraining.time" name="time"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Duration</label>
              <input type="text" [(ngModel)]="newTraining.duration" name="duration" placeholder="e.g., 2 hours"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Training Type</label>
              <select [(ngModel)]="newTraining.training_type" name="training_type"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                <option>Online</option>
                <option>In-Person</option>
                <option>Hybrid</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Available Seats</label>
              <input type="text" [(ngModel)]="newTraining.seats" name="seats" placeholder="e.g., 25"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Additional
            Information</legend>
          <div class="space-y-5">
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Prerequisites</label>
              <input type="text" [(ngModel)]="newTraining.prerequisites" name="prerequisites"
                placeholder="e.g., Basic Python knowledge"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-2">Assessment Details</label>
              <textarea [(ngModel)]="newTraining.assessment_details" name="assessment_details" rows="3"
                placeholder="Describe the assessment process, if any."
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="flex items-center justify-end space-x-4 pt-6 border-t border-slate-200 mt-8">
        <button type="button" (click)="closeScheduleTrainingModal()"
          class="px-6 py-2.5 font-semibold text-slate-600 hover:bg-slate-100 rounded-full transition-colors">Cancel</button>
        <button type="submit" [disabled]="trainingForm.invalid"
          class="px-7 py-2.5 bg-indigo-600 text-white rounded-full font-semibold hover:bg-indigo-700 disabled:bg-slate-400 disabled:cursor-not-allowed shadow-lg hover:shadow-indigo-300 transition-all">
          <i class="fa-solid fa-check mr-2"></i> Schedule Training
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Attendance Marking Modal -->
<div *ngIf="showAttendanceModal" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl m-4" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-emerald-50 rounded-t-2xl border-b border-emerald-200">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-clipboard-check text-2xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-900">Mark Training Attendance</h3>
          <p class="text-sm text-slate-600">Select candidates who attended the training</p>
        </div>
      </div>
      <button (click)="closeAttendanceModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="max-h-[70vh] overflow-y-auto p-6">
      <div *ngIf="attendanceCandidates.length === 0" class="text-center py-12 text-slate-500">
        <i class="fa-solid fa-users-slash text-4xl text-slate-400 mb-3"></i>
        <p class="text-lg font-semibold text-slate-700 mb-2">No Candidates Assigned</p>
        <p class="text-sm text-slate-500">No candidates have been assigned to this training yet.</p>
      </div>
      <div *ngIf="attendanceCandidates.length > 0" class="space-y-3">
        <div class="mb-4 p-3 bg-slate-50 rounded-lg border border-slate-200">
          <p class="text-sm text-slate-700">
            <i class="fa-solid fa-info-circle mr-2 text-sky-500"></i>
            Select all candidates who attended the training. Only selected candidates will receive assignments.
          </p>
        </div>
        <div *ngFor="let candidate of attendanceCandidates; let i = index" (click)="toggleCandidateAttendance(i)"
          class="flex items-center gap-3 p-4 bg-white rounded-lg border-2 cursor-pointer transition-all hover:shadow-md"
          [ngClass]="{
               'border-emerald-500 bg-emerald-50': candidate.attended,
               'border-slate-200 hover:border-slate-300': !candidate.attended
             }">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 rounded-full flex items-center justify-center" [ngClass]="{
                   'bg-emerald-100 text-emerald-600': candidate.attended,
                   'bg-slate-100 text-slate-400': !candidate.attended
                 }">
              <i [ngClass]="candidate.attended ? 'fa-solid fa-check' : 'fa-solid fa-user'" class="text-lg"></i>
            </div>
          </div>
          <div class="flex-grow">
            <p class="font-semibold text-slate-900">{{ candidate.employee_name || candidate.employee_empid }}</p>
            <p class="text-xs text-slate-500">ID: {{ candidate.employee_empid }}</p>
          </div>
          <div class="flex-shrink-0">
            <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all" [ngClass]="{
                   'border-emerald-500 bg-emerald-500': candidate.attended,
                   'border-slate-300': !candidate.attended
                 }">
              <i *ngIf="candidate.attended" class="fa-solid fa-check text-white text-xs"></i>
            </div>
          </div>
        </div>
        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
          <p class="text-sm text-blue-800">
            <i class="fa-solid fa-check-circle mr-2"></i>
            <strong>{{ getAttendedCount() }}</strong> out of
            <strong>{{ getTotalCandidatesCount() }}</strong> candidates selected
          </p>
        </div>
      </div>
    </div>
    <div class="flex items-center justify-end space-x-4 pt-6 border-t border-slate-200 px-6 pb-6">
      <button (click)="closeAttendanceModal()"
        class="px-6 py-2.5 font-semibold text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">
        Cancel
      </button>
      <button (click)="markAttendance()" [disabled]="!canMarkAttendance()"
        class="px-7 py-2.5 bg-emerald-600 text-white rounded-lg font-semibold hover:bg-emerald-700 disabled:bg-slate-400 disabled:cursor-not-allowed shadow-lg hover:shadow-emerald-300 transition-all">
        <i class="fa-solid fa-check mr-2"></i>
        <span *ngIf="!isMarkingAttendance">Mark Attendance</span>
        <span *ngIf="isMarkingAttendance">Marking...</span>
      </button>
    </div>
  </div>
</div>

<!-- Solutions View Modal -->
<div *ngIf="showSolutionsModal" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl m-4" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-teal-50 rounded-t-2xl border-b border-teal-200">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-teal-100 text-teal-600 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-file-pdf text-2xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-900">View Solutions</h3>
          <p class="text-sm text-slate-600">{{ getTrainingName(selectedTrainingForSolutions || 0) }}</p>
        </div>
      </div>
      <button (click)="closeSolutionsModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="max-h-[70vh] overflow-y-auto p-6">
      <div *ngIf="isLoadingSolutions" class="text-center py-12">
        <i class="fa-solid fa-spinner fa-spin text-4xl text-slate-400 mb-3"></i>
        <p class="text-slate-600">Loading solutions...</p>
      </div>
      <div *ngIf="!isLoadingSolutions && solutionsList.length === 0" class="text-center py-12 text-slate-500">
        <i class="fa-solid fa-file-circle-question text-4xl text-slate-400 mb-3"></i>
        <p class="text-lg font-semibold text-slate-700 mb-2">No Solutions Submitted</p>
        <p class="text-sm text-slate-500">No engineers have submitted solution files for this training yet.</p>
      </div>
      <div *ngIf="!isLoadingSolutions && solutionsList.length > 0" class="space-y-3">
        <div class="mb-4 p-3 bg-slate-50 rounded-lg border border-slate-200">
          <p class="text-sm text-slate-700">
            <i class="fa-solid fa-info-circle mr-2 text-sky-500"></i>
            <strong>{{ solutionsList.length }}</strong> solution file(s) submitted by engineers.
          </p>
        </div>
        <div *ngFor="let solution of solutionsList"
          class="flex items-center justify-between p-4 bg-white rounded-lg border-2 border-slate-200 hover:border-teal-300 hover:shadow-md transition-all">
          <div class="flex items-center gap-4 flex-grow">
            <div class="w-12 h-12 bg-teal-100 text-teal-600 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-file-pdf text-xl"></i>
            </div>
            <div class="flex-grow">
              <p class="font-semibold text-slate-900">{{ solution.employee_name || solution.employee_empid }}</p>
              <p class="text-xs text-slate-500">ID: {{ solution.employee_empid }}</p>
              <p class="text-xs text-slate-600 mt-1">
                <i class="fa-solid fa-file mr-1"></i>{{ solution.file_name }}
                <span *ngIf="solution.file_size" class="ml-2">
                  ({{ (solution.file_size / 1024).toFixed(2) }} KB)
                </span>
              </p>
              <p class="text-xs text-slate-500 mt-1">
                <i class="fa-solid fa-clock mr-1"></i>Uploaded: {{ solution.uploaded_at | date:'medium' }}
              </p>
            </div>
          </div>
          <div class="flex-shrink-0">
            <button (click)="downloadSolutionFile(solution.training_id, solution.employee_empid, solution.file_name)"
              class="px-4 py-2 bg-teal-600 text-white rounded-lg font-semibold hover:bg-teal-700 transition-colors shadow-md hover:shadow-teal-300">
              <i class="fa-solid fa-download mr-2"></i>Download
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="flex items-center justify-end space-x-4 pt-6 border-t border-slate-200 px-6 pb-6">
      <button (click)="closeSolutionsModal()"
        class="px-6 py-2.5 font-semibold text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Skill Feedback Modal -->
<div *ngIf="showSkillFeedbackModal" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50"
  (click)="closeSkillFeedbackModal()">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl m-4 max-h-[85vh] flex flex-col"
    (click)="$event.stopPropagation()">
    <div
      class="flex items-center justify-between px-3 py-2 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-t-2xl border-b border-indigo-200">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 bg-indigo-600 text-white rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-comment-dots text-base"></i>
        </div>
        <div>
          <h3 class="text-lg font-bold text-slate-900 leading-tight">Manager Feedback</h3>
          <p class="text-xs text-slate-600">{{ selectedSkillForFeedback }}</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <div *ngIf="skillFeedbackList.length > 0" class="text-right">
          <p class="text-xs text-slate-600">Total Feedback Entries</p>
          <p class="text-lg font-bold text-indigo-600">{{ skillFeedbackList.length }}</p>
        </div>
        <button (click)="closeSkillFeedbackModal()"
          class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
          <i class="fa-solid fa-times text-lg"></i>
        </button>
      </div>
    </div>
    <div class="flex-1 overflow-y-auto px-4 py-3">
      <!-- Skill Type Tabs -->
      <div class="flex flex-wrap items-center gap-2 mb-3" *ngIf="skillCategoryLevels && skillCategoryLevels.length > 0">
        <span class="text-xs font-semibold text-slate-500 mr-1">Levels:</span>
        <button *ngFor="let level of skillCategoryLevels" type="button" (click)="selectedFeedbackSkillType = level"
          class="px-2.5 py-1 text-[11px] font-semibold rounded-full border transition-all duration-150" [ngClass]="selectedFeedbackSkillType === level
                        ? 'bg-indigo-600 text-white border-indigo-600 shadow-sm'
                        : 'bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50'">
          {{ level }} - {{ getSkillTypeDisplayName(level) }}
        </button>
      </div>
      <div *ngIf="skillFeedbackByType.size > 0" class="space-y-4">
        <!-- Iterate over skill types (L1, L2, L3, L4, L5) -->
        <ng-container *ngFor="let skillTypeEntry of getFilteredSkillTypeEntries()">
          <div
            class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border-2 border-indigo-200 shadow-sm hover:shadow-md transition-all">
            <!-- Skill Type Header -->
            <div class="flex items-center justify-between mb-3 pb-2 border-b-2 border-indigo-300">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 text-white rounded-lg flex items-center justify-center">
                  <i class="fa-solid fa-graduation-cap text-sm"></i>
                </div>
                <div>
                  <h4 class="font-bold text-lg text-slate-900">
                    {{ selectedSkillForFeedback }} - {{ getSkillTypeDisplayName(skillTypeEntry.key) }}
                  </h4>
                  <p class="text-xs text-slate-600 mt-0.5">
                    <i class="fa-solid fa-layer-group mr-1"></i>
                    {{ skillTypeEntry.value.length }} Feedback {{ skillTypeEntry.value.length === 1 ? 'Entry' :
                    'Entries' }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Latest Feedback for this Type -->
            <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)" class="space-y-3">
              <div class="bg-white rounded-lg p-3 border border-indigo-100 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <span
                      class="px-2 py-1 text-[10px] font-semibold rounded-full bg-green-100 text-green-700 border border-green-300">
                      <i class="fa-solid fa-star mr-1"></i>Latest
                    </span>
                    <span class="text-xs text-slate-600">
                      <i class="fa-solid fa-clock mr-1"></i>
                      Updated: {{ getLatestFeedbackForType(skillTypeEntry.value)?.updated_at | date:'short' }}
                    </span>
                  </div>
                  <span class="px-3 py-1 text-xs font-semibold rounded-full flex-shrink-0"
                    [ngClass]="getRatingColorClass(getLatestFeedbackForType(skillTypeEntry.value)?.overall_performance)">
                    {{ getLatestFeedbackForType(skillTypeEntry.value)?.overall_performance }}/5
                  </span>
                </div>

                <div class="mb-2">
                  <p class="text-xs text-slate-600 mb-2">
                    <i class="fa-solid fa-user-tie mr-1"></i>
                    {{ getLatestFeedbackForType(skillTypeEntry.value)?.manager_name }}
                    <span class="mx-1">•</span>
                    <i class="fa-solid fa-graduation-cap mr-1"></i>
                    {{ getLatestFeedbackForType(skillTypeEntry.value)?.training_name }}
                  </p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-1.5 mb-2">
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.application_of_training"
                    class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                    <p class="text-[10px] text-slate-600 font-medium">Application</p>
                    <p class="text-xs font-bold text-slate-800">{{
                      getLatestFeedbackForType(skillTypeEntry.value)?.application_of_training }}/5</p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.quality_of_deliverables"
                    class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                    <p class="text-[10px] text-slate-600 font-medium">Quality</p>
                    <p class="text-xs font-bold text-slate-800">{{
                      getLatestFeedbackForType(skillTypeEntry.value)?.quality_of_deliverables }}/5</p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.problem_solving_capability"
                    class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                    <p class="text-[10px] text-slate-600 font-medium">Problem-Solving</p>
                    <p class="text-xs font-bold text-slate-800">{{
                      getLatestFeedbackForType(skillTypeEntry.value)?.problem_solving_capability }}/5</p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.productivity_independence"
                    class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                    <p class="text-[10px] text-slate-600 font-medium">Productivity</p>
                    <p class="text-xs font-bold text-slate-800">{{
                      getLatestFeedbackForType(skillTypeEntry.value)?.productivity_independence }}/5</p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.process_compliance_adherence"
                    class="bg-indigo-50 rounded px-2 py-1 text-center border border-indigo-100">
                    <p class="text-[10px] text-slate-600 font-medium">Compliance</p>
                    <p class="text-xs font-bold text-slate-800">{{
                      getLatestFeedbackForType(skillTypeEntry.value)?.process_compliance_adherence }}/5</p>
                  </div>
                </div>

                <div
                  *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.strengths || getLatestFeedbackForType(skillTypeEntry.value)?.improvement_areas || getLatestFeedbackForType(skillTypeEntry.value)?.additional_comments"
                  class="space-y-1.5">
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.strengths"
                    class="bg-green-50 border-l-2 border-green-400 rounded px-3 py-1.5">
                    <p class="text-[10px] font-semibold text-green-800 mb-1">
                      <i class="fa-solid fa-thumbs-up mr-1"></i>Strengths
                    </p>
                    <p class="text-xs text-green-700 whitespace-pre-wrap break-words">
                      {{ getLatestFeedbackForType(skillTypeEntry.value)?.strengths }}
                    </p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.improvement_areas"
                    class="bg-amber-50 border-l-2 border-amber-400 rounded px-3 py-1.5">
                    <p class="text-[10px] font-semibold text-amber-800 mb-1">
                      <i class="fa-solid fa-arrow-up mr-1"></i>Improvement Areas
                    </p>
                    <p class="text-xs text-amber-700 whitespace-pre-wrap break-words">
                      {{ getLatestFeedbackForType(skillTypeEntry.value)?.improvement_areas }}
                    </p>
                  </div>
                  <div *ngIf="getLatestFeedbackForType(skillTypeEntry.value)?.additional_comments"
                    class="bg-blue-50 border-l-2 border-blue-400 rounded px-3 py-1.5">
                    <p class="text-[10px] font-semibold text-blue-800 mb-1">
                      <i class="fa-solid fa-comment mr-1"></i>Comments
                    </p>
                    <p class="text-xs text-blue-700 whitespace-pre-wrap break-words">
                      {{ getLatestFeedbackForType(skillTypeEntry.value)?.additional_comments }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
      <div *ngIf="skillFeedbackByType.size === 0" class="text-center py-12 text-slate-500">
        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa-solid fa-comment-slash text-3xl text-slate-400"></i>
        </div>
        <p class="text-lg font-semibold text-slate-700 mb-2">No Feedback Available</p>
        <p class="text-sm text-slate-500 max-w-md mx-auto">No feedback has been provided for <span
            class="font-medium text-slate-700">{{ selectedSkillForFeedback }}</span> yet. Feedback will appear here once
          your manager reviews your training performance.</p>
      </div>
    </div>
  </div>
</div>

<!-- Skills Detail Modal -->
<div *ngIf="showSkillsModal" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl m-4" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-slate-50 rounded-t-2xl border-b border-slate-200">
      <h3 class="text-xl font-bold text-slate-900">{{ modalTitle }} ({{ modalSkills.length }})</h3>
      <button (click)="closeSkillsModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="max-h-[70vh] overflow-y-auto p-8">
      <div *ngIf="modalSkills.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div *ngFor="let competency of modalSkills" @fadeIn
          class="relative overflow-hidden bg-white p-6 rounded-2xl shadow-lg border border-slate-200/60" [ngClass]="{
                           'border-t-4 border-emerald-500': competency.status === 'Completed',
                           'border-t-4 border-orange-500': competency.status === 'Behind',
                           'border-t-4 border-sky-500': competency.status === 'On Track',
                           'border-t-4 border-slate-300': competency.status === 'Not Started' || !competency.status,
                           'border-t-4 border-red-500': competency.status === 'Error'
                       }">
          <div class="flex flex-col justify-between h-full">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center space-x-4">
                <div
                  class="w-12 h-12 bg-sky-500 text-white rounded-lg flex items-center justify-center text-xl shadow-md">
                  <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div>
                  <h3 class="font-extrabold text-xl text-slate-900">{{ competency.skill }}</h3>
                  <span class="text-sm font-medium text-slate-500">{{ competency.competency || 'Skill' }}</span>
                </div>
              </div>
              <span *ngIf="competency.status"
                class="px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wider" [ngClass]="{
                                   'bg-emerald-100 text-emerald-800': competency.status === 'Completed',
                                   'bg-orange-100 text-orange-800': competency.status === 'Behind',
                                   'bg-sky-100 text-sky-800': competency.status === 'On Track',
                                   'bg-slate-100 text-slate-700': competency.status === 'Not Started',
                                   'bg-red-100 text-red-800': competency.status === 'Error'
                               }">
                {{ competency.status }}
              </span>
            </div>
            <div class="space-y-4" *ngIf="competency.status">
              <div class="flex justify-between items-center text-sm">
                <div class="flex items-center text-slate-600">
                  <i class="fa-solid fa-bullseye text-slate-400 mr-2 w-4 text-center"></i>Current: <span
                    class="ml-1.5 font-semibold text-slate-900">{{ competency.current_expertise }}</span>
                </div>
                <div class="flex items-center text-slate-600">
                  <i class="fa-solid fa-rocket text-slate-400 mr-2 w-4 text-center"></i>Target: <span
                    class="ml-1.5 font-semibold text-slate-900">{{ competency.target_expertise }}</span>
                </div>
              </div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-slate-600">Progress</span>
                <span class="text-sm font-bold text-slate-700">{{ getSkillProgress(competency) }}%</span>
              </div>
              <div class="w-full bg-slate-200 rounded-full h-3 overflow-hidden shadow-inner">
                <div class="h-full rounded-full transition-all duration-700 bg-gradient-to-r from-cyan-400 to-cyan-600"
                  [style.width.%]="getSkillProgress(competency)">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <p *ngIf="modalSkills.length === 0" class="text-center text-slate-500 py-8">
        {{ modalTitle === 'Completed Skills' ? 'No skills have been marked as completed yet.' : 'No core skills data available.'
        }}
      </p>
    </div>
  </div>
</div>

<!-- Completed Trainings Modal -->
<div *ngIf="showCompletedTrainingsModal" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl m-4" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-green-50 rounded-t-2xl border-b border-green-200">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-green-100 text-green-600 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-check-circle text-2xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-900">Completed Trainings</h3>
          <p class="text-sm text-slate-600">{{ dashboardCompletedTrainings.length }} training{{
            dashboardCompletedTrainings.length !== 1 ? 's' : '' }} completed</p>
        </div>
      </div>
      <button (click)="closeCompletedTrainingsModal()"
        class="w-9 h-9 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="max-h-[70vh] overflow-y-auto p-6 pr-4 completed-trainings-scroll">
      <div *ngIf="dashboardCompletedTrainings.length === 0" class="text-center py-12 text-slate-500">
        <i class="fa-solid fa-check-circle text-4xl text-slate-400 mb-3"></i>
        <p class="text-lg font-semibold text-slate-700 mb-2">No Completed Trainings</p>
        <p class="text-sm text-slate-500">You have not completed any trainings yet.</p>
      </div>
      <div *ngIf="dashboardCompletedTrainings.length > 0" class="space-y-3 pr-2">
        <div *ngFor="let training of dashboardCompletedTrainings"
          class="flex items-center gap-4 p-4 bg-slate-50 rounded-xl border border-slate-200 hover:bg-white hover:shadow-md transition-all duration-200">
          <div class="w-12 h-12 bg-green-100 text-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fa-solid fa-check-circle text-xl"></i>
          </div>
          <div class="flex-1 min-w-0">
            <h4 class="font-bold text-slate-900 text-base mb-1">{{ training.training_name }}</h4>
            <div class="flex items-center gap-4 text-sm text-slate-600">
              <div class="flex items-center gap-1.5">
                <i class="fa-solid fa-user-tie text-slate-400"></i>
                <span>{{ training.trainer_name }}</span>
              </div>
              <div class="flex items-center gap-1.5">
                <i class="fa-solid fa-calendar-days text-slate-400"></i>
                <span>{{ training.training_date ? (training.training_date | date:'mediumDate') : 'TBD' }}</span>
              </div>
            </div>
            <div *ngIf="training.skill" class="mt-2">
              <span
                class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-100 text-green-800">
                <i class="fa-solid fa-tag mr-1"></i>{{ training.skill }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="flex items-center justify-end space-x-4 pt-6 border-t border-slate-200 px-6 pb-6">
      <button (click)="closeCompletedTrainingsModal()"
        class="px-6 py-2.5 font-semibold text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
        <i class="fa-solid fa-times mr-2"></i>Close
      </button>
    </div>
  </div>
</div>

<!-- Confirmation Dialog Modal -->
<div *ngIf="(confirmationDialogService.confirmation$ | async) as confirmation" @fadeIn
  class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div @modalScale class="bg-white rounded-2xl shadow-2xl w-full max-w-md m-4" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 bg-gradient-to-r from-blue-50 to-slate-50 rounded-t-2xl border-b border-slate-200">
      <h3 class="text-lg font-bold text-slate-900">{{ confirmation.title }}</h3>
      <button (click)="confirmationDialogService.cancel()"
        class="w-8 h-8 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors">
        <i class="fa-solid fa-times text-lg"></i>
      </button>
    </div>
    <div class="p-6">
      <p class="text-slate-700 text-base mb-6">{{ confirmation.message }}</p>
    </div>
    <div class="flex items-center justify-end gap-3 pt-4 border-t border-slate-200 px-6 pb-6">
      <button (click)="confirmationDialogService.cancel()"
        class="px-5 py-2.5 font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors">
        {{ confirmation.cancelText }}
      </button>
      <button (click)="confirmationDialogService.confirm()"
        class="px-5 py-2.5 font-semibold text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors shadow-md hover:shadow-lg">
        {{ confirmation.okText }}
      </button>
    </div>
  </div>
</div>
