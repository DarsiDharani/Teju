<!--
  ============================================================================
  ADMIN DASHBOARD COMPONENT TEMPLATE - PREMIUM UI
  ============================================================================
  Professional admin dashboard with polished UI matching engineer dashboard quality
  ============================================================================
-->

<!-- Main Container -->
<div class="flex h-screen bg-slate-100 font-sans text-slate-800">
    
    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col shadow-2xl z-20 overflow-hidden">
        <!-- User Profile Section -->
        <div class="px-6 py-4 text-center border-b border-slate-700/50">
            <div class="relative inline-block mb-4">
                <!-- Admin Avatar -->
                <div class="w-20 h-20 bg-slate-700 rounded-full flex items-center justify-center shadow-lg ring-4 ring-slate-800">
                    <i class="fa-solid fa-user-shield text-slate-400 text-3xl"></i>
                </div>
                <!-- Online Status Indicator -->
                <div class="absolute top-0 right-0 w-6 h-6 bg-green-400 rounded-full border-4 border-indigo-200"></div>
            </div>
            <!-- Admin Name -->
            <h3 class="text-white text-xl font-semibold">{{ adminName }}</h3>
            <!-- Admin ID -->
            <p class="text-slate-400 text-sm mt-1">({{ adminId }})</p>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 px-4 py-3 space-y-1 pb-4">
            <!-- Dashboard Tab -->
            <button (click)="selectTab('dashboard')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'dashboard',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'dashboard'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-sky-500 to-cyan-400 shadow-md">
                    <i class="fa-solid fa-chart-pie"></i>
                </div>
                <span class="font-medium">Dashboard</span>
            </button>

            <!-- User Management Tab -->
            <button (click)="selectTab('users')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'users',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'users'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-blue-500 to-cyan-500 shadow-md">
                    <i class="fa-solid fa-users"></i>
                </div>
                <span class="font-medium">User Management</span>
            </button>

            <!-- Training Management Tab -->
            <button (click)="selectTab('trainings')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'trainings',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'trainings'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-emerald-500 to-green-400 shadow-md">
                    <i class="fa-solid fa-book-open"></i>
                </div>
                <span class="font-medium">Training Management</span>
            </button>

            <!-- Skills Management Tab -->
            <button (click)="selectTab('skills')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'skills',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'skills'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-amber-500 to-yellow-400 shadow-md">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <span class="font-medium">Skills Management</span>
            </button>

            <!-- Analytics Tab -->
            <button (click)="selectTab('analytics')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'analytics',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'analytics'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-rose-500 to-pink-400 shadow-md">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
                <span class="font-medium">Analytics</span>
            </button>

            <!-- Data Management Tab -->
            <button (click)="selectTab('data')"
                class="w-full text-left px-4 py-2 rounded-lg flex items-center gap-4 transition-all duration-200" 
                [ngClass]="{
                    'bg-slate-800/80 text-white border-l-4 border-sky-400 px-3': activeTab === 'data',
                    'hover:bg-slate-800/50 hover:text-white': activeTab !== 'data'
                }">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-teal-500 to-cyan-500 shadow-md">
                    <i class="fa-solid fa-database"></i>
                </div>
                <span class="font-medium">Data Management</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content Area: Flexible container that adapts based on active tab -->
    <div class="flex-1 p-6 overflow-y-auto bg-gradient-to-br from-sky-100 to-cyan-500">
            <!-- Dashboard Tab -->
            <div *ngIf="activeTab === 'dashboard'" @fadeIn class="space-y-4">
            <!-- Loading State -->
            <div *ngIf="isLoading" class="flex justify-center items-center h-full text-slate-500">
                <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-sky-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                <span class="text-lg">Loading dashboard data...</span>
            </div>

            <div *ngIf="!isLoading" @slideFadeIn class="space-y-4">
                <!-- Welcome section -->
                <div @bouncyScale class="flex justify-between items-center bg-gradient-to-r from-blue-700 to-blue-700 text-white px-3 py-1.5 rounded-lg shadow-lg backdrop-blur-sm border border-white/10">
                    <div class="flex items-center gap-2">
                        <h2 class="text-xs font-bold tracking-tight">Welcome, {{ adminName }}!</h2>
                        <div class="w-px h-3 bg-white/20"></div>
                        <p class="text-white-300/90 text-[10px] hidden lg:block">System administration overview</p>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <button (click)="selectTab('users')" class="bg-white/10 px-1.5 py-0.5 rounded-md text-center ring-1 ring-white/15 transition-colors duration-200 hover:bg-white/20 flex items-center gap-1">
                            <span class="text-sm font-bold">{{ totalUsers }}</span>
                            <span class="text-[9px] text-slate-200 leading-tight">Total<br>Users</span>
                        </button>
                        <button (click)="selectTab('trainings')" class="bg-white/10 px-1.5 py-0.5 rounded-md text-center ring-1 ring-white/15 transition-colors duration-200 hover:bg-white/20 flex items-center gap-1">
                            <span class="text-sm font-bold">{{ totalTrainings }}</span>
                            <span class="text-[9px] text-slate-200 leading-tight">Total<br>Trainings</span>
                        </button>
                    </div>
                </div>
                
                <!-- Dashboard Metrics (Single Row) -->
                <div @slideFadeIn class="bg-white/40 backdrop-blur-sm rounded-lg border border-indigo-200 p-2">
                    <div class="grid grid-cols-6 gap-2">
                        <!-- Users -->
                        <button (click)="openUsersPopup()" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3 hover:shadow-xl transition-all duration-300 text-left">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-users text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="font-bold text-2xl text-slate-900 mb-1">{{ totalUsers }}</div>
                                <div class="text-xs text-slate-600 font-medium">Users</div>
                            </button>

                            <!-- Trainers -->
                            <button (click)="openTrainersPopup()" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3 hover:shadow-xl transition-all duration-300 text-left">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-chalkboard-teacher text-indigo-600"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 font-medium">Active</div>
                                </div>
                                <div class="font-bold text-2xl text-slate-900 mb-1">{{ activeTrainers }}</div>
                                <div class="text-xs text-slate-600 font-medium">Trainers</div>
                            </button>

                            <!-- Skills -->
                            <button (click)="openCoreSkillsPopup()" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3 hover:shadow-xl transition-all duration-300 text-left">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-graduation-cap text-purple-600"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 font-medium">Total</div>
                                </div>
                                <div class="font-bold text-2xl text-slate-900 mb-1">{{ coreSkills.length }}</div>
                                <div class="text-xs text-slate-600 font-medium">Skills</div>
                            </button>

                            <!-- Trainings -->
                            <button (click)="openTrainingsPopup()" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3 hover:shadow-xl transition-all duration-300 text-left">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-book-open text-emerald-600"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 font-medium">Total</div>
                                </div>
                                <div class="font-bold text-2xl text-slate-900 mb-1">{{ totalTrainings }}</div>
                                <div class="text-xs text-slate-600 font-medium">Total Trainings</div>
                            </button>

                            <!-- Attendance Rate - MODAL POPUP -->
                            <button (click)="openAttendanceModal()" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-4 hover:shadow-xl transition-all duration-300 text-left cursor-pointer hover:bg-indigo-50">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-percent text-amber-600"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 font-medium">Overall</div>
                                </div>
                                
                                <!-- Main Metric -->
                                <div class="font-bold text-3xl text-slate-900 mb-1">{{ attendanceRate | number:'1.0-2' }}%</div>
                                <div class="text-xs text-slate-600 font-medium mb-3">Attendance Rate</div>

                                <!-- Summary Stats -->
                                <div class="mt-2 pt-2 border-t border-slate-200/60 text-xs text-slate-600 space-y-1">
                                    <div class="flex items-center justify-between">
                                        <span>Attended</span>
                                        <span class="font-semibold text-slate-900">{{ attendedAssignments }}</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>Assigned</span>
                                        <span class="font-semibold text-slate-900">{{ totalAssignments }}</span>
                                    </div>
                                </div>

                                <!-- Click Info -->
                                <div class="mt-3 pt-3 border-t border-slate-200/60 text-xs text-indigo-600 font-semibold flex items-center gap-1">
                                    <i class="fa-solid fa-arrow-right text-xs"></i>
                                    Click to view by skill
                                </div>
                            </button>

                            <!-- Report Generation Icon -->
                            <button (click)="selectTab('analytics')" class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3 hover:shadow-xl transition-all duration-300 text-left" title="Reports">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="w-10 h-10 bg-rose-100 rounded-lg flex items-center justify-center">
                                        <i class="fa-solid fa-file-arrow-down text-rose-600"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 font-medium">Reports</div>
                                </div>
                                <div class="font-bold text-lg text-slate-900 mb-1">Generate</div>
                                <div class="text-xs text-slate-600 font-medium">Report</div>

                                <div class="mt-2 pt-2 border-t border-slate-200/60">
                                    <div class="w-full bg-gradient-to-r from-rose-600 to-pink-600 text-white px-3 py-1.5 rounded-lg shadow-sm font-semibold text-sm flex items-center justify-center">
                                        <i class="fa-solid fa-chart-line mr-2"></i>Open Reports
                                    </div>
                                </div>
                            </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div @slideFadeIn class="bg-white/80 backdrop-blur-sm rounded-lg shadow-lg border border-indigo-200 p-3">
                    <h3 class="text-base font-bold text-slate-900 mb-3"><b>Quick Actions</b></h3>
                    <div class="grid grid-cols-3 gap-3 text-center">
                        <button (click)="selectTab('users'); openCreateUserModal()" class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-1">
                                <i class="fa-solid fa-user-plus text-blue-600"></i>
                            </div>
                            <div class="text-xs text-slate-500 font-medium">Add User</div>
                        </button>
                        <button (click)="selectTab('trainings'); openCreateTrainingModal()" class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                            <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-1">
                                <i class="fa-solid fa-plus-circle text-emerald-600"></i>
                            </div>
                            <div class="text-xs text-slate-600 font-medium">Create Training</div>
                        </button>
                        <button (click)="selectTab('data')" class="p-2 rounded-lg hover:bg-slate-100 transition-colors duration-200 text-center">
                            <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center mx-auto mb-1">
                                <i class="fa-solid fa-upload text-teal-600"></i>
                            </div>
                            <div class="text-xs text-slate-600 font-medium">Import Data</div>
                        </button>
                    </div>
                </div>

                <!-- Users Popup (from Dashboard Users card) -->
                <div *ngIf="showUsersPopup" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn">
                    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" (click)="closeUsersPopup()"></div>

                    <div class="relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden border-t-4 border-cyan-500">
                        <!-- Cyan Professional Header -->
                        <div class="bg-gradient-to-br from-slate-900 via-slate-800 to-cyan-900 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-11 h-11 bg-cyan-500/20 rounded-xl flex items-center justify-center border border-cyan-400/30 backdrop-blur-sm">
                                        <i class="fa-solid fa-users text-cyan-400 text-lg"></i>
                                    </div>
                                    <div>
                                        <div class="text-lg font-semibold text-white">All Users</div>
                                        <div class="text-xs text-cyan-300">{{ (users | filter: usersPopupSearch : ['name', 'username', 'role']).length }} of {{ users.length }} users</div>
                                    </div>
                                </div>
                                <button (click)="closeUsersPopup()" class="p-2 rounded-lg hover:bg-cyan-500/20 text-cyan-300 hover:text-white transition-all" title="Close">
                                    <i class="fa-solid fa-times text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-gradient-to-b from-cyan-50/30 to-white">
                            <!-- Search Filter -->
                            <div class="px-6 pt-4 pb-3 border-b border-cyan-100">
                                <div class="relative">
                                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-cyan-500 text-sm"></i>
                                    <input 
                                        type="text" 
                                        [(ngModel)]="usersPopupSearch"
                                        placeholder="Search by name, username, or role..."
                                        class="w-full pl-10 pr-4 py-2.5 bg-white border border-cyan-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition-all"
                                    />
                                    <button 
                                        *ngIf="usersPopupSearch" 
                                        (click)="usersPopupSearch = ''"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-400 hover:text-cyan-600 transition-colors"
                                    >
                                        <i class="fa-solid fa-times-circle"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="px-6 py-4">
                                <div *ngIf="usersLoading" class="py-12 text-center">
                                    <div class="inline-block relative">
                                        <div class="animate-spin rounded-full h-10 w-10 border-4 border-cyan-100 border-t-cyan-500"></div>
                                    </div>
                                    <div class="mt-3 text-sm font-medium text-slate-600">Loading users...</div>
                                </div>

                                <div *ngIf="!usersLoading" class="max-h-[50vh] overflow-y-auto pr-1 space-y-1.5">
                                    <div *ngIf="(users | filter: usersPopupSearch : ['name', 'username', 'role']).length === 0" class="py-12 text-center text-slate-500">
                                        <i class="fa-solid fa-user-slash text-3xl text-cyan-200 mb-2"></i>
                                        <div class="font-medium text-sm">No users found</div>
                                    </div>

                                    <div *ngFor="let user of users | filter: usersPopupSearch : ['name', 'username', 'role']" 
                                         class="group flex items-center justify-between gap-3 p-3.5 rounded-lg bg-white hover:bg-cyan-50/50 border border-slate-200 hover:border-cyan-300 transition-all duration-150">
                                        <div class="flex items-center gap-3 min-w-0 flex-1">
                                            <div class="w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center text-white text-sm font-semibold shadow-sm">
                                                {{ (user.name || user.username).charAt(0).toUpperCase() }}
                                            </div>
                                            <div class="min-w-0 flex-1">
                                                <div class="font-semibold text-slate-800 truncate text-sm group-hover:text-cyan-700 transition-colors">{{ user.name || user.username }}</div>
                                                <div class="text-xs text-slate-500 truncate mt-0.5">
                                                    <span class="font-mono">{{ user.username }}</span> · {{ user.role }}<span *ngIf="user.is_trainer" class="text-cyan-600 font-medium"> · Trainer</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2 shrink-0">
                                            <span class="px-2.5 py-1 text-[11px] rounded-md bg-cyan-100 text-cyan-700 font-semibold uppercase tracking-wide">{{ user.role }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trainers Popup (from Dashboard Trainers card) -->
                <div *ngIf="showTrainersPopup" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn">
                    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" (click)="closeTrainersPopup()"></div>

                    <div class="relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden border-t-4 border-cyan-500">
                        <div class="bg-gradient-to-br from-slate-900 via-slate-800 to-cyan-900 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-11 h-11 bg-cyan-500/20 rounded-xl flex items-center justify-center border border-cyan-400/30 backdrop-blur-sm">
                                        <i class="fa-solid fa-chalkboard-teacher text-cyan-400 text-lg"></i>
                                    </div>
                                    <div>
                                        <div class="text-lg font-semibold text-white">All Trainers</div>
                                        <div class="text-xs text-cyan-300">{{ (trainerUsers | filter: trainersPopupSearch : ['name', 'username']).length }} of {{ trainerUsers.length }} trainers</div>
                                    </div>
                                </div>
                                <button (click)="closeTrainersPopup()" class="p-2 rounded-lg hover:bg-cyan-500/20 text-cyan-300 hover:text-white transition-all" title="Close">
                                    <i class="fa-solid fa-times text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-gradient-to-b from-cyan-50/30 to-white">
                            <div class="px-6 pt-4 pb-3 border-b border-cyan-100">
                                <div class="relative">
                                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-cyan-500 text-sm"></i>
                                    <input 
                                        type="text" 
                                        [(ngModel)]="trainersPopupSearch"
                                        placeholder="Search trainers by name or username..."
                                        class="w-full pl-10 pr-4 py-2.5 bg-white border border-cyan-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition-all"
                                    />
                                    <button 
                                        *ngIf="trainersPopupSearch" 
                                        (click)="trainersPopupSearch = ''"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-400 hover:text-cyan-600 transition-colors"
                                    >
                                        <i class="fa-solid fa-times-circle"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="px-6 py-4">
                                <div *ngIf="trainersPopupLoading" class="py-12 text-center">
                                    <div class="inline-block relative">
                                        <div class="animate-spin rounded-full h-10 w-10 border-4 border-cyan-100 border-t-cyan-500"></div>
                                    </div>
                                    <div class="mt-3 text-sm font-medium text-slate-600">Loading trainers...</div>
                                </div>

                                <div *ngIf="!trainersPopupLoading" class="max-h-[50vh] overflow-y-auto pr-1 space-y-1.5">
                                    <div *ngIf="(trainerUsers | filter: trainersPopupSearch : ['name', 'username']).length === 0" class="py-12 text-center text-slate-500">
                                        <i class="fa-solid fa-user-slash text-3xl text-cyan-200 mb-2"></i>
                                        <div class="font-medium text-sm">No trainers found</div>
                                    </div>

                                    <div *ngFor="let user of trainerUsers | filter: trainersPopupSearch : ['name', 'username']" 
                                         class="group flex items-center justify-between gap-3 p-3.5 rounded-lg bg-white hover:bg-cyan-50/50 border border-slate-200 hover:border-cyan-300 transition-all duration-150">
                                        <div class="flex items-center gap-3 min-w-0 flex-1">
                                            <div class="w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center text-white text-sm font-semibold shadow-sm">
                                                {{ (user.name || user.username).charAt(0).toUpperCase() }}
                                            </div>
                                            <div class="min-w-0 flex-1">
                                                <div class="font-semibold text-slate-800 truncate text-sm group-hover:text-cyan-700 transition-colors">{{ user.name || user.username }}</div>
                                                <div class="text-xs text-slate-500 truncate mt-0.5"><span class="font-mono">{{ user.username }}</span> · {{ user.role }}</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2 shrink-0">
                                            <span class="px-2.5 py-1 text-[11px] rounded-md bg-gradient-to-r from-cyan-500 to-cyan-600 text-white font-semibold uppercase tracking-wide shadow-sm">Trainer</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trainings Popup (from Dashboard Trainings card) -->
                <div *ngIf="showTrainingsPopup" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn">
                    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" (click)="closeTrainingsPopup()"></div>

                    <div class="relative w-full max-w-4xl bg-white rounded-2xl shadow-2xl overflow-hidden border-t-4 border-cyan-500">
                        <div class="bg-gradient-to-br from-slate-900 via-slate-800 to-cyan-900 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-11 h-11 bg-cyan-500/20 rounded-xl flex items-center justify-center border border-cyan-400/30 backdrop-blur-sm">
                                        <i class="fa-solid fa-book-open text-cyan-400 text-lg"></i>
                                    </div>
                                    <div>
                                        <div class="text-lg font-semibold text-white">Trainings Overview</div>
                                        <div class="text-xs text-cyan-300">{{ classroomTrainingsCount }} classroom • {{ recordedTrainingsCount }} recorded • {{ (trainings | filter: trainingsPopupSearch : ['training_name', 'trainer_name']).length }} results</div>
                                    </div>
                                </div>
                                <button (click)="closeTrainingsPopup()" class="p-2 rounded-lg hover:bg-cyan-500/20 text-cyan-300 hover:text-white transition-all" title="Close">
                                    <i class="fa-solid fa-times text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-gradient-to-b from-cyan-50/30 to-white">
                            <div class="px-6 pt-4 pb-3 border-b border-cyan-100">
                                <div class="relative">
                                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-cyan-500 text-sm"></i>
                                    <input 
                                        type="text" 
                                        [(ngModel)]="trainingsPopupSearch"
                                        placeholder="Search by training name or trainer..."
                                        class="w-full pl-10 pr-4 py-2.5 bg-white border border-cyan-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition-all"
                                    />
                                    <button 
                                        *ngIf="trainingsPopupSearch" 
                                        (click)="trainingsPopupSearch = ''"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-400 hover:text-cyan-600 transition-colors"
                                    >
                                        <i class="fa-solid fa-times-circle"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="px-6 py-4">
                                <div *ngIf="trainingsLoading" class="py-12 text-center">
                                    <div class="inline-block relative">
                                        <div class="animate-spin rounded-full h-10 w-10 border-4 border-cyan-100 border-t-cyan-500"></div>
                                    </div>
                                    <div class="mt-3 text-sm font-medium text-slate-600">Loading trainings...</div>
                                </div>

                                <div *ngIf="!trainingsLoading" class="max-h-[50vh] overflow-y-auto pr-1 space-y-1.5">
                                    <div *ngIf="(trainings | filter: trainingsPopupSearch : ['training_name', 'trainer_name']).length === 0" class="py-12 text-center text-slate-500">
                                        <i class="fa-solid fa-book-open text-3xl text-cyan-200 mb-2"></i>
                                        <div class="font-medium text-sm">No trainings found</div>
                                    </div>

                                    <div *ngFor="let t of trainings | filter: trainingsPopupSearch : ['training_name', 'trainer_name']" 
                                         class="group flex items-center justify-between gap-4 p-3.5 rounded-lg bg-white hover:bg-cyan-50/50 border border-slate-200 hover:border-cyan-300 transition-all duration-150">
                                        <div class="min-w-0 flex-1">
                                            <div class="flex items-center gap-2 min-w-0 mb-1">
                                                <div class="font-semibold text-slate-800 truncate text-sm group-hover:text-cyan-700 transition-colors">{{ t.training_name }}</div>
                                                <span class="shrink-0 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide"
                                                    [ngClass]="getTrainingTypeLabel(t) === 'Recorded' ? 'bg-cyan-500 text-white' : 'bg-slate-200 text-slate-700'">
                                                    {{ getTrainingTypeLabel(t) }}
                                                </span>
                                            </div>
                                            <div class="text-xs text-slate-500 truncate">
                                                <i class="fa-solid fa-user-tie text-cyan-400"></i> {{ t.trainer_name || 'Not Assigned' }}
                                                <span *ngIf="t.training_date"> • <i class="fa-solid fa-calendar text-cyan-400"></i> {{ t.training_date }}</span>
                                            </div>
                                        </div>

                                        <div class="flex items-center gap-2 shrink-0">
                                            <div class="text-center px-3 py-1.5 rounded-md bg-cyan-50 border border-cyan-200">
                                                <div class="text-[9px] text-cyan-600 font-semibold uppercase tracking-wider">Assigned</div>
                                                <div class="font-bold text-base text-cyan-700">{{ t.assigned_count || 0 }}</div>
                                            </div>
                                            <div class="text-center px-3 py-1.5 rounded-md bg-gradient-to-br from-cyan-500 to-cyan-600 border border-cyan-400 shadow-sm">
                                                <div class="text-[9px] text-cyan-100 font-semibold uppercase tracking-wider">Attended</div>
                                                <div class="font-bold text-base text-white">{{ t.attended_count || 0 }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Core Skills Popup (from Dashboard Skills card) -->
                <div *ngIf="showCoreSkillsPopup" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn">
                    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" (click)="closeCoreSkillsPopup()"></div>

                    <div class="relative w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden border-t-4 border-cyan-500">
                        <div class="bg-gradient-to-br from-slate-900 via-slate-800 to-cyan-900 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-11 h-11 bg-cyan-500/20 rounded-xl flex items-center justify-center border border-cyan-400/30 backdrop-blur-sm">
                                        <i class="fa-solid fa-graduation-cap text-cyan-400 text-lg"></i>
                                    </div>
                                    <div>
                                        <div class="text-lg font-semibold text-white">Core Skills</div>
                                        <div class="text-xs text-cyan-300">{{ (coreSkills | filter: skillsPopupSearch : ['title']).length }} of {{ coreSkills.length }} skills</div>
                                    </div>
                                </div>
                                <button (click)="closeCoreSkillsPopup()" class="p-2 rounded-lg hover:bg-cyan-500/20 text-cyan-300 hover:text-white transition-all" title="Close">
                                    <i class="fa-solid fa-times text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-gradient-to-b from-cyan-50/30 to-white">
                            <div class="px-6 pt-4 pb-3 border-b border-cyan-100">
                                <div class="relative">
                                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-cyan-500 text-sm"></i>
                                    <input 
                                        type="text" 
                                        [(ngModel)]="skillsPopupSearch"
                                        placeholder="Search skills..."
                                        class="w-full pl-10 pr-4 py-2.5 bg-white border border-cyan-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition-all"
                                    />
                                    <button 
                                        *ngIf="skillsPopupSearch" 
                                        (click)="skillsPopupSearch = ''"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-400 hover:text-cyan-600 transition-colors"
                                    >
                                        <i class="fa-solid fa-times-circle"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="px-6 py-5">
                                <div class="max-h-[50vh] overflow-y-auto pr-2">
                                    <div *ngIf="(coreSkills | filter: skillsPopupSearch : ['title']).length === 0" class="py-12 text-center text-slate-500">
                                        <i class="fa-solid fa-graduation-cap text-3xl text-cyan-200 mb-2"></i>
                                        <div class="font-medium text-sm">No skills found</div>
                                    </div>

                                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                        <div *ngFor="let skill of coreSkills | filter: skillsPopupSearch : ['title']" 
                                             class="group text-center p-4 rounded-lg bg-white hover:bg-cyan-50/50 border border-slate-200 hover:border-cyan-300 transition-all duration-150">
                                            <div class="w-14 h-14 mx-auto rounded-lg bg-cyan-100 group-hover:bg-cyan-200 flex items-center justify-center transition-colors">
                                                <i [class]="skill.iconClass + ' text-cyan-600 text-xl'" aria-hidden="true"></i>
                                            </div>
                                            <div class="mt-2.5 text-xs font-semibold text-slate-700 group-hover:text-cyan-700 transition-colors">{{ skill.title }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Tab -->
        <div *ngIf="activeTab === 'users'" @fadeIn>
            <!-- Header -->
            <div class="mb-6 flex flex-wrap justify-between items-center gap-3">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-5 py-3 shadow-lg rounded-xl flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                      <i class="fa-solid fa-users text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-white">User Management</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button *ngIf="getSelectedUsersCount() > 0" 
                            (click)="deleteSelectedUsers()" 
                            class="bg-gradient-to-r from-red-600 to-rose-600 text-white px-6 py-3 rounded-xl hover:from-red-700 hover:to-rose-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2">
                        <i class="fa-solid fa-trash"></i>
                        <span class="font-semibold">Delete Selected ({{ getSelectedUsersCount() }})</span>
                    </button>
                    <button (click)="openCreateUserModal()" 
                            class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i>
                        <span class="font-semibold">Add User</span>
                    </button>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl shadow-xl p-4 mb-6">
                <div class="flex flex-wrap items-center gap-3">
                    <div class="relative flex-1 min-w-[200px]">
                        <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-blue-200"></i>
                        <input type="text" [(ngModel)]="userSearch" (input)="loadUsers()" 
                               placeholder="Search users..." 
                               class="w-full pl-10 pr-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 placeholder-slate-400">
                    </div>
                    <select [(ngModel)]="userRoleFilter" (change)="loadUsers()" 
                            class="px-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 cursor-pointer font-medium">
                        <option value="all">All Roles</option>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                        <option value="employee">Employee</option>
                    </select>
                </div>
            </div>

            <!-- Users Table -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-indigo-200">
                <div *ngIf="usersLoading" class="p-12 text-center">
                    <div class="inline-block relative">
                        <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fa-solid fa-users text-blue-600"></i>
                        </div>
                    </div>
                    <p class="mt-4 text-slate-600 font-medium">Loading users...</p>
                </div>
                <div *ngIf="!usersLoading">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-slate-50 to-blue-50/50">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider w-12">
                                        <input type="checkbox" 
                                               [checked]="isSelectAll" 
                                               (change)="toggleSelectAll()"
                                               class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Username</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Trainer</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200/60">
                                <tr *ngFor="let user of users" 
                                    class="hover:bg-blue-50/30 transition-colors"
                                    [ngClass]="{'bg-blue-100/50': isUserSelected(user.username)}">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="checkbox" 
                                               [checked]="isUserSelected(user.username)" 
                                               (change)="toggleUserSelection(user)"
                                               class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center">
                                                <i class="fa-solid fa-user text-white text-xs"></i>
                                            </div>
                                            <span class="text-sm font-semibold text-slate-900">{{ user.username }}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700 font-medium">{{ user.name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1.5 text-xs font-bold rounded-full shadow-sm" 
                                              [ngClass]="{
                                                  'bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 border border-purple-300': user.role === 'admin',
                                                  'bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 border border-blue-300': user.role === 'manager',
                                                  'bg-gradient-to-r from-green-100 to-green-200 text-green-800 border border-green-300': user.role === 'employee'
                                              }">
                                            <i class="fa-solid fa-shield-halved mr-1" *ngIf="user.role === 'admin'"></i>
                                            <i class="fa-solid fa-user-tie mr-1" *ngIf="user.role === 'manager'"></i>
                                            <i class="fa-solid fa-user mr-1" *ngIf="user.role === 'employee'"></i>
                                            {{ user.role }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span *ngIf="user.is_trainer" class="px-3 py-1.5 bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-800 text-xs font-bold rounded-full border border-emerald-300">
                                            <i class="fa-solid fa-check mr-1"></i>Yes
                                        </span>
                                        <span *ngIf="!user.is_trainer" class="px-3 py-1.5 bg-slate-100 text-slate-500 text-xs font-bold rounded-full">
                                            <i class="fa-solid fa-times mr-1"></i>No
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <div class="flex items-center gap-2">
                                            <button (click)="openEditUserModal(user)" 
                                                    class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-all hover:scale-110" 
                                                    title="Edit User">
                                                <i class="fa-solid fa-edit"></i>
                                            </button>
                                            <button (click)="resetPassword(user)" 
                                                    class="p-2 bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-lg transition-all hover:scale-110" 
                                                    title="Reset Password">
                                                <i class="fa-solid fa-key"></i>
                                            </button>
                                            <button (click)="deleteUser(user)" 
                                                    class="p-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-all hover:scale-110" 
                                                    title="Delete User">
                                                <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="users.length === 0">
                                    <td colspan="6" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center gap-3">
                                            <i class="fa-solid fa-users text-slate-300 text-4xl"></i>
                                            <p class="text-slate-500 font-medium">No users found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Management Tab -->
        <div *ngIf="activeTab === 'trainings'" @fadeIn>
            <!-- Header -->
            <div class="mb-6 flex flex-wrap justify-between items-center gap-3">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-5 py-3 shadow-lg rounded-xl flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                      <i class="fa-solid fa-book-open text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-white">Training Management</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button *ngIf="getSelectedTrainingsCount() > 0" 
                            (click)="deleteSelectedTrainings()" 
                            class="bg-gradient-to-r from-red-600 to-rose-600 text-white px-6 py-3 rounded-xl hover:from-red-700 hover:to-rose-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2">
                        <i class="fa-solid fa-trash"></i>
                        <span class="font-semibold">Delete Selected ({{ getSelectedTrainingsCount() }})</span>
                    </button>
                    <button (click)="openCreateTrainingModal()" 
                            class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i>
                        <span class="font-semibold">Create Training</span>
                    </button>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl shadow-xl p-4 mb-6">
                <div class="flex flex-wrap items-center gap-3">
                    <div class="relative flex-1 min-w-[200px]">
                        <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-blue-200"></i>
                        <input type="text" [(ngModel)]="trainingSearch" (input)="loadTrainings()" 
                               placeholder="Search trainings..." 
                               class="w-full pl-10 pr-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 placeholder-slate-400">
                    </div>
                    <div class="relative flex-1 min-w-[200px]">
                        <i class="fa-solid fa-filter absolute left-3 top-1/2 -translate-y-1/2 text-blue-200"></i>
                        <input type="text" [(ngModel)]="trainingSkillFilter" (input)="loadTrainings()" 
                               placeholder="Filter by skill..." 
                               class="w-full pl-10 pr-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 placeholder-slate-400">
                    </div>
                    <div class="flex items-center gap-2 ml-auto bg-white/10 border border-white/20 rounded-xl p-1 shadow-inner">
                        <span class="text-xs font-semibold text-white/80 px-2">View</span>
                        <button (click)="setTrainingTypeView('all')"
                                class="px-3 py-1.5 rounded-lg text-xs font-bold tracking-wide uppercase"
                                [ngClass]="trainingTypeView === 'all' ? 'bg-white text-blue-700 shadow-md' : 'text-white/80 hover:bg-white/20'">
                            All ({{ trainings.length }})
                        </button>
                        <button (click)="setTrainingTypeView('classroom')"
                                class="px-3 py-1.5 rounded-lg text-xs font-bold tracking-wide uppercase"
                                [ngClass]="trainingTypeView === 'classroom' ? 'bg-white text-blue-700 shadow-md' : 'text-white/80 hover:bg-white/20'">
                            Classroom ({{ classroomTrainingsCount }})
                        </button>
                        <button (click)="setTrainingTypeView('recorded')"
                                class="px-3 py-1.5 rounded-lg text-xs font-bold tracking-wide uppercase"
                                [ngClass]="trainingTypeView === 'recorded' ? 'bg-white text-blue-700 shadow-md' : 'text-white/80 hover:bg-white/20'">
                            Recorded ({{ recordedTrainingsCount }})
                        </button>
                    </div>
                </div>
            </div>

            <!-- Trainings Table -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-indigo-200">
                <div *ngIf="trainingsLoading" class="p-12 text-center">
                    <div class="inline-block relative">
                        <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fa-solid fa-book-open text-blue-600"></i>
                        </div>
                    </div>
                    <p class="mt-4 text-slate-600 font-medium">Loading trainings...</p>
                </div>
                <div *ngIf="!trainingsLoading">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-slate-50 to-blue-50/50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider w-12">
                                        <input type="checkbox" 
                                               [checked]="isSelectAllTrainings" 
                                               (change)="toggleSelectAllTrainings()"
                                               class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Training Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Trainer</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Email</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Division</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Department</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Competency</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Skill</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Category</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Date</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Time</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Duration</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Seats</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Topics</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Assigned</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Completion</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200/60">
                                <tr *ngFor="let training of filteredTrainings" 
                                    class="hover:bg-blue-50/30 transition-colors"
                                    [ngClass]="{'bg-blue-100/50': isTrainingSelected(training.id)}">
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <input type="checkbox" 
                                               [checked]="isTrainingSelected(training.id)" 
                                               (change)="toggleTrainingSelection(training)"
                                               class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <i class="fa-solid fa-book text-white text-xs"></i>
                                            </div>
                                            <span class="text-sm font-semibold text-slate-900">{{ training.training_name }}</span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-slate-700 font-medium">{{ training.trainer_name || 'N/A' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.email || 'N/A' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.division || 'N/A' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.department || 'N/A' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.competency || 'N/A' }}</td>
                                    <td class="px-4 py-3">
                                        <span *ngIf="training.skill" class="px-2 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 border border-blue-300">{{ training.skill }}</span>
                                        <span *ngIf="!training.skill" class="text-sm text-slate-400">N/A</span>
                                    </td>
                                    <td class="px-4 py-3">
                                        <span *ngIf="training.skill_category" class="px-2 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-violet-100 to-violet-200 text-violet-800 border border-violet-300">{{ training.skill_category }}</span>
                                        <span *ngIf="!training.skill_category" class="text-sm text-slate-400">N/A</span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-slate-700">{{ training.training_date ? (training.training_date | date:'shortDate') : 'TBD' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.time || 'TBD' }}</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.duration || 'N/A' }}</td>
                                    <td class="px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-bold rounded-full border"
                                              [ngClass]="getTrainingTypeLabel(training) === 'Recorded' ? 'bg-cyan-100 text-cyan-800 border-cyan-300' : 'bg-slate-100 text-slate-800 border-slate-300'">
                                            {{ training.training_type ? getTrainingTypeLabel(training) : 'Not Set' }}
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-slate-600">{{ training.seats || 'N/A' }}</td>
                                    <td class="px-4 py-3 max-w-xs">
                                        <p class="text-xs text-slate-600 truncate" [title]="training.training_topics || 'N/A'">{{ training.training_topics || 'N/A' }}</p>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <span class="px-2 py-1 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 text-xs font-bold rounded-full border border-blue-300">{{ training.assigned_count }}</span>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden min-w-[50px]">
                                                <div class="h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full" [style.width.%]="training.completion_rate"></div>
                                            </div>
                                            <span class="text-xs font-bold text-slate-700">{{ training.completion_rate }}%</span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                                        <div class="flex items-center gap-1">
                                            <button (click)="openTrainingDetailModal(training)" 
                                                    class="p-1.5 bg-sky-100 hover:bg-sky-200 text-sky-700 rounded-lg transition-all hover:scale-110" 
                                                    title="View Details">
                                                <i class="fa-solid fa-eye text-xs"></i>
                                            </button>
                                            <button (click)="openEditTrainingModal(training)" 
                                                    class="p-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-all hover:scale-110" 
                                                    title="Edit Training">
                                                <i class="fa-solid fa-edit text-xs"></i>
                                            </button>
                                            <button (click)="deleteTraining(training)" 
                                                    class="p-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-all hover:scale-110" 
                                                    title="Delete Training">
                                                <i class="fa-solid fa-trash text-xs"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="filteredTrainings.length === 0">
                                    <td colspan="18" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center gap-3">
                                            <i class="fa-solid fa-book-open text-slate-300 text-4xl"></i>
                                            <p class="text-slate-500 font-medium">No trainings found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills Management Tab -->
        <div *ngIf="activeTab === 'skills'" @fadeIn>
            <!-- Header -->
            <div class="mb-6 flex flex-wrap justify-between items-center gap-3">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-5 py-3 shadow-lg rounded-xl flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                      <i class="fa-solid fa-graduation-cap text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-white">Skills Management</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button (click)="openCreateSkillModal()" 
                            class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i>
                        <span class="font-semibold">Add New Skill</span>
                    </button>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl shadow-xl p-4 mb-6">
                <div class="flex flex-wrap items-center gap-3">
                    <div class="relative flex-1 min-w-[200px]">
                        <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-blue-200"></i>
                        <input type="text" [(ngModel)]="skillSearch" (input)="loadCompetencies()" 
                               placeholder="Search by skill..." 
                               class="w-full pl-10 pr-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 placeholder-slate-400">
                    </div>
                    <div class="relative flex-1 min-w-[200px]">
                        <i class="fa-solid fa-user absolute left-3 top-1/2 -translate-y-1/2 text-blue-200"></i>
                        <input type="text" [(ngModel)]="skillEmployeeFilter" (input)="loadCompetencies()" 
                               placeholder="Filter by employee ID..." 
                               class="w-full pl-10 pr-4 py-2.5 rounded-lg border-0 bg-white/90 backdrop-blur-sm focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none text-slate-800 placeholder-slate-400">
                    </div>
                </div>
            </div>

            <!-- Competencies Table -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-indigo-200">
                <div *ngIf="competenciesLoading" class="p-12 text-center">
                    <div class="inline-block relative">
                        <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fa-solid fa-graduation-cap text-blue-600"></i>
                        </div>
                    </div>
                    <p class="mt-4 text-slate-600 font-medium">Loading competencies...</p>
                </div>
                <div *ngIf="!competenciesLoading">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-slate-50 to-blue-50/50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Employee</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Skill</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Competency</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Current</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Target</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Department</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Division</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Project</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Target Date</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200/60">
                                <tr *ngFor="let comp of competencies" class="hover:bg-blue-50/30 transition-colors">
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center">
                                                <i class="fa-solid fa-user text-white text-xs"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm font-semibold text-slate-900">{{ comp.employee_name || 'N/A' }}</p>
                                                <p class="text-xs text-slate-500">{{ comp.employee_empid }}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-700 font-medium">{{ comp.skill || 'N/A' }}</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600">{{ comp.competency || 'N/A' }}</td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <span class="px-2 py-1 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 text-xs font-bold rounded-full border border-blue-300 shadow-sm">{{ comp.current_expertise || 'N/A' }}</span>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <span class="px-2 py-1 bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 text-xs font-bold rounded-full border border-purple-300 shadow-sm">{{ comp.target_expertise || 'N/A' }}</span>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-bold rounded-full shadow-sm"
                                              [ngClass]="getStatusChipClass(getTimelineStatus(comp))">
                                            <ng-container [ngSwitch]="getTimelineStatus(comp)">
                                                <i *ngSwitchCase="'Completed'" class="fa-solid fa-check-circle mr-1"></i>
                                                <i *ngSwitchCase="'Behind'" class="fa-solid fa-exclamation-triangle mr-1"></i>
                                                <i *ngSwitchCase="'On Track'" class="fa-solid fa-bullseye mr-1"></i>
                                                <i *ngSwitchDefault class="fa-solid fa-clock mr-1"></i>
                                            </ng-container>
                                            {{ getTimelineStatus(comp) }}
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600">{{ comp.department || 'N/A' }}</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600">{{ comp.division || 'N/A' }}</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600">{{ comp.project || 'N/A' }}</td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600">
                                        <span *ngIf="comp.target_date">{{ comp.target_date | date:'shortDate' }}</span>
                                        <span *ngIf="!comp.target_date" class="text-slate-400">N/A</span>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                                        <button (click)="openEditSkillModal(comp)" 
                                                class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-all hover:scale-110" 
                                                title="Edit Skill">
                                            <i class="fa-solid fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr *ngIf="competencies.length === 0">
                                    <td colspan="11" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center gap-3">
                                            <i class="fa-solid fa-graduation-cap text-slate-300 text-4xl"></i>
                                            <p class="text-slate-500 font-medium">No competencies found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div *ngIf="activeTab === 'analytics'" @fadeIn>
            <div class="mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-5 py-3 shadow-lg rounded-xl flex items-center gap-3 inline-flex">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                      <i class="fa-solid fa-chart-line text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-white">Analytics & Reports</h1>
                </div>
            </div>

            <div *ngIf="analyticsLoading" class="text-center py-20">
                <div class="inline-block relative">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-rose-200 border-t-rose-600"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fa-solid fa-chart-line text-rose-600 text-2xl"></i>
                    </div>
                </div>
                <p class="mt-4 text-slate-600 font-medium">Loading analytics...</p>
            </div>

            <div *ngIf="!analyticsLoading && !analytics" class="text-center py-20">
                <div class="flex flex-col items-center gap-3">
                    <i class="fa-solid fa-chart-line text-slate-300 text-6xl"></i>
                    <p class="text-slate-500 font-medium text-lg">No analytics data available</p>
                    <button (click)="loadAnalytics()" 
                            class="mt-4 bg-gradient-to-r from-rose-600 to-pink-600 text-white px-6 py-3 rounded-xl hover:from-rose-700 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                        <i class="fa-solid fa-refresh mr-2"></i>Reload Analytics
                    </button>
                </div>
            </div>

            <div *ngIf="!analyticsLoading && analytics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- User Statistics -->
                <div class="bg-gradient-to-br from-white to-blue-50/50 rounded-2xl shadow-xl p-6 border border-blue-100/50">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                        <div class="w-1 h-8 bg-gradient-to-b from-blue-500 to-cyan-500 rounded-full"></div>
                        User Statistics
                    </h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Total Users:</span>
                            <span class="text-2xl font-bold text-blue-600">{{ analytics.user_statistics?.total_users || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Managers:</span>
                            <span class="text-2xl font-bold text-blue-600">{{ analytics.user_statistics?.managers || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Employees:</span>
                            <span class="text-2xl font-bold text-blue-600">{{ analytics.user_statistics?.employees || 0 }}</span>
                        </div>
                    </div>
                </div>

                <!-- Training Statistics -->
                <div class="bg-gradient-to-br from-white to-emerald-50/50 rounded-2xl shadow-xl p-6 border border-emerald-100/50">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                        <div class="w-1 h-8 bg-gradient-to-b from-emerald-500 to-green-500 rounded-full"></div>
                        Training Statistics
                    </h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Total Trainings:</span>
                            <span class="text-2xl font-bold text-emerald-600">{{ analytics.training_statistics?.total_trainings || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Total Assignments:</span>
                            <span class="text-2xl font-bold text-emerald-600">{{ analytics.training_statistics?.total_assignments || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Completion Rate:</span>
                            <span class="text-2xl font-bold text-emerald-600">{{ analytics.training_statistics?.completion_rate || 0 }}%</span>
                        </div>
                    </div>
                </div>

                <!-- Skill Statistics -->
                <div class="bg-gradient-to-br from-white to-purple-50/50 rounded-2xl shadow-xl p-6 border border-purple-100/50">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                        <div class="w-1 h-8 bg-gradient-to-b from-purple-500 to-indigo-500 rounded-full"></div>
                        Skill Statistics
                    </h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Total Competencies:</span>
                            <span class="text-2xl font-bold text-purple-600">{{ analytics.skill_statistics?.total_competencies || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Pending Requests:</span>
                            <span class="text-2xl font-bold text-purple-600">{{ analytics.additional_metrics?.pending_requests || 0 }}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/60 rounded-lg">
                            <span class="text-slate-600 font-medium">Active Trainers:</span>
                            <span class="text-2xl font-bold text-purple-600">{{ analytics.additional_metrics?.active_trainers || 0 }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Tab -->
        <div *ngIf="activeTab === 'data'" @fadeIn>
            <div class="mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-5 py-3 shadow-lg rounded-xl flex items-center gap-3 inline-flex">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                      <i class="fa-solid fa-database text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-white">Data Management</h1>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Excel Upload -->
                <div class="bg-gradient-to-br from-white to-teal-50/50 rounded-2xl shadow-xl p-6 border border-teal-100/50 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center shadow-lg">
                            <i class="fa-solid fa-file-excel text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-slate-800">Upload Excel File</h2>
                            <p class="text-sm text-slate-600">Trainers, trainings, and competencies</p>
                        </div>
                    </div>
                    <input type="file" accept=".xlsx,.xls" (change)="onExcelFileSelected($event)" 
                           class="mb-4 w-full px-4 py-3 border-2 border-dashed border-teal-300 rounded-xl bg-white/50 hover:border-teal-400 transition-colors cursor-pointer">
                    <button (click)="uploadExcel()" [disabled]="!excelFile || uploading" 
                            class="w-full bg-gradient-to-r from-teal-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-teal-700 hover:to-cyan-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 font-semibold">
                        <i class="fa-solid fa-upload mr-2"></i>{{ uploading ? 'Uploading...' : 'Upload Excel' }}
                    </button>
                </div>

                <!-- CSV Upload -->
                <div class="bg-gradient-to-br from-white to-cyan-50/50 rounded-2xl shadow-xl p-6 border border-cyan-100/50 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-xl flex items-center justify-center shadow-lg">
                            <i class="fa-solid fa-file-csv text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-slate-800">Upload CSV File</h2>
                            <p class="text-sm text-slate-600">Manager-employee relationships</p>
                        </div>
                    </div>
                    <input type="file" accept=".csv" (change)="onCsvFileSelected($event)" 
                           class="mb-4 w-full px-4 py-3 border-2 border-dashed border-cyan-300 rounded-xl bg-white/50 hover:border-cyan-400 transition-colors cursor-pointer">
                    <button (click)="uploadCsv()" [disabled]="!csvFile || uploading" 
                            class="w-full bg-gradient-to-r from-cyan-600 to-teal-600 text-white px-6 py-3 rounded-xl hover:from-cyan-700 hover:to-teal-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 font-semibold">
                        <i class="fa-solid fa-upload mr-2"></i>{{ uploading ? 'Uploading...' : 'Upload CSV' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create User Modal -->
<div *ngIf="showCreateUserModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md max-h-[90vh] overflow-y-auto" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Create New User</h2>
            <button (click)="showCreateUserModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="space-y-4">
            <input type="text" [(ngModel)]="newUser.username" placeholder="Username *" 
                   class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            <input type="password" [(ngModel)]="newUser.password" placeholder="Password *" 
                   class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            <input type="text" [(ngModel)]="newUser.name" placeholder="Name *" 
                   class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            <select [(ngModel)]="newUser.role" 
                    class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                <option value="employee">Employee</option>
                <option value="manager">Manager</option>
                <option value="admin">Admin</option>
            </select>
            <input *ngIf="newUser.role === 'employee'" type="text" [(ngModel)]="newUser.manager_empid" placeholder="Manager ID" 
                   class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-colors">
                <input type="checkbox" [(ngModel)]="newUser.is_trainer" class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500">
                <span class="font-medium text-slate-700">Is Trainer</span>
            </label>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="createUser()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                Create
            </button>
            <button (click)="showCreateUserModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div *ngIf="showEditUserModal && selectedUser" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Edit User</h2>
            <button (click)="showEditUserModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="space-y-4">
            <input type="text" [(ngModel)]="selectedUser.name" placeholder="Name" 
                   class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            <select [(ngModel)]="selectedUser.role" 
                    class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                <option value="employee">Employee</option>
                <option value="manager">Manager</option>
                <option value="admin">Admin</option>
            </select>
            <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-colors">
                <input type="checkbox" [(ngModel)]="selectedUser.is_trainer" class="w-5 h-5 rounded border-indigo-200 text-blue-600 focus:ring-blue-500">
                <span class="font-medium text-slate-700">Is Trainer</span>
            </label>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="updateUser()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                Update
            </button>
            <button (click)="showEditUserModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Create Training Modal -->
<div *ngIf="showCreateTrainingModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Create Training</h2>
            <button (click)="showCreateTrainingModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="space-y-6">
            <!-- Core Details -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Core Details</legend>
                <div class="space-y-4 mt-2">
                    <input type="text" [(ngModel)]="newTraining.training_name" placeholder="Training Name *" 
                           class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <textarea [(ngModel)]="newTraining.training_topics" placeholder="Training Topics" rows="3" 
                              class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>
            </fieldset>

            <!-- Classification -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Classification</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="text" [(ngModel)]="newTraining.division" placeholder="Division" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="newTraining.department" placeholder="Department" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="newTraining.competency" placeholder="Competency" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="newTraining.skill" placeholder="Skill" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <select [(ngModel)]="newTraining.skill_category" 
                            class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                        <option value="">Select Skill Category</option>
                        <option *ngFor="let level of skillCategoryLevels" [value]="level">{{ level }}</option>
                    </select>
                </div>
            </fieldset>

            <!-- Trainer Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Trainer Information</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="text" [(ngModel)]="newTraining.trainer_name" placeholder="Trainer Name *" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="email" [(ngModel)]="newTraining.email" placeholder="Trainer Email" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                </div>
            </fieldset>

            <!-- Logistics & Scheduling -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Logistics & Scheduling</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="date" [(ngModel)]="newTraining.training_date" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="time" [(ngModel)]="newTraining.time" placeholder="Time" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="newTraining.duration" placeholder="Duration (e.g., 2 hours)" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <select [(ngModel)]="newTraining.training_type" 
                            class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                        <option value="">Select Training Type</option>
                        <option>Online</option>
                        <option>In-Person</option>
                        <option>Hybrid</option>
                    </select>
                    <input type="text" [(ngModel)]="newTraining.seats" placeholder="Available Seats" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                </div>
            </fieldset>

            <!-- Additional Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Additional Information</legend>
                <div class="space-y-4 mt-2">
                    <input type="text" [(ngModel)]="newTraining.prerequisites" placeholder="Prerequisites" 
                           class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <textarea [(ngModel)]="newTraining.assessment_details" placeholder="Assessment Details" rows="3" 
                              class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>
            </fieldset>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="createTraining()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                Create
            </button>
            <button (click)="showCreateTrainingModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Edit Training Modal -->
<div *ngIf="showEditTrainingModal && selectedTraining" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Edit Training</h2>
            <button (click)="showEditTrainingModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="space-y-6">
            <!-- Core Details -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Core Details</legend>
                <div class="space-y-4 mt-2">
                    <input type="text" [(ngModel)]="selectedTraining.training_name" placeholder="Training Name *" 
                           class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <textarea [(ngModel)]="selectedTraining.training_topics" placeholder="Training Topics" rows="3" 
                              class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>
            </fieldset>

            <!-- Classification -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Classification</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="text" [(ngModel)]="selectedTraining.division" placeholder="Division" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="selectedTraining.department" placeholder="Department" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="selectedTraining.competency" placeholder="Competency" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="selectedTraining.skill" placeholder="Skill" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <select [(ngModel)]="selectedTraining.skill_category" 
                            class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                        <option value="">Select Skill Category</option>
                        <option *ngFor="let level of skillCategoryLevels" [value]="level">{{ level }}</option>
                    </select>
                </div>
            </fieldset>

            <!-- Trainer Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Trainer Information</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="text" [(ngModel)]="selectedTraining.trainer_name" placeholder="Trainer Name *" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="email" [(ngModel)]="selectedTraining.email" placeholder="Trainer Email" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                </div>
            </fieldset>

            <!-- Logistics & Scheduling -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Logistics & Scheduling</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <input type="date" [(ngModel)]="selectedTraining.training_date" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="time" [(ngModel)]="selectedTraining.time" placeholder="Time" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <input type="text" [(ngModel)]="selectedTraining.duration" placeholder="Duration (e.g., 2 hours)" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <select [(ngModel)]="selectedTraining.training_type" 
                            class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                        <option value="">Select Training Type</option>
                        <option>Online</option>
                        <option>In-Person</option>
                        <option>Hybrid</option>
                    </select>
                    <input type="text" [(ngModel)]="selectedTraining.seats" placeholder="Available Seats" 
                           class="px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                </div>
            </fieldset>

            <!-- Additional Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Additional Information</legend>
                <div class="space-y-4 mt-2">
                    <input type="text" [(ngModel)]="selectedTraining.prerequisites" placeholder="Prerequisites" 
                           class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    <textarea [(ngModel)]="selectedTraining.assessment_details" placeholder="Assessment Details" rows="3" 
                              class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>
            </fieldset>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="updateTraining()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                Update
            </button>
            <button (click)="showEditTrainingModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Training Detail Modal -->
<div *ngIf="showTrainingDetailModal && selectedTraining" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Training Details</h2>
            <button (click)="closeTrainingDetailModal()" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        
        <div class="space-y-6">
            <!-- Core Information -->
            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-info-circle text-blue-600"></i>
                    Core Information
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Training Name</label>
                        <p class="text-lg font-bold text-slate-800 mt-1">{{ selectedTraining.training_name }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Training ID</label>
                        <p class="text-lg font-bold text-slate-800 mt-1">#{{ selectedTraining.id }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Trainer Name</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.trainer_name }}</p>
                    </div>
                    <div *ngIf="selectedTraining.email">
                        <label class="text-sm font-semibold text-slate-600">Trainer Email</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.email }}</p>
                    </div>
                </div>
            </div>

            <!-- Classification -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-tags text-purple-600"></i>
                    Classification
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div *ngIf="selectedTraining.division">
                        <label class="text-sm font-semibold text-slate-600">Division</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.division }}</p>
                    </div>
                    <div *ngIf="selectedTraining.department">
                        <label class="text-sm font-semibold text-slate-600">Department</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.department }}</p>
                    </div>
                    <div *ngIf="selectedTraining.competency">
                        <label class="text-sm font-semibold text-slate-600">Competency</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.competency }}</p>
                    </div>
                    <div *ngIf="selectedTraining.skill">
                        <label class="text-sm font-semibold text-slate-600">Skill</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.skill }}</p>
                    </div>
                    <div *ngIf="selectedTraining.skill_category">
                        <label class="text-sm font-semibold text-slate-600">Skill Category</label>
                        <span class="inline-flex items-center px-3 py-1 mt-1 bg-violet-100 text-violet-800 text-sm font-bold rounded-full border border-violet-300">
                            <i class="fa-solid fa-layer-group mr-1"></i>{{ selectedTraining.skill_category }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Schedule & Logistics -->
            <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-6 border border-emerald-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-calendar-alt text-emerald-600"></i>
                    Schedule & Logistics
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Training Date</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.training_date ? (selectedTraining.training_date | date:'fullDate') : 'Date TBD' }}</p>
                    </div>
                    <div *ngIf="selectedTraining.time">
                        <label class="text-sm font-semibold text-slate-600">Time</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.time }}</p>
                    </div>
                    <div *ngIf="selectedTraining.duration">
                        <label class="text-sm font-semibold text-slate-600">Duration</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.duration }}</p>
                    </div>
                    <div *ngIf="selectedTraining.training_type">
                        <label class="text-sm font-semibold text-slate-600">Training Type</label>
                        <span class="inline-flex items-center px-3 py-1 mt-1 bg-sky-100 text-sky-800 text-sm font-bold rounded-full border border-sky-300">
                            <i class="fa-solid fa-display mr-1"></i>{{ selectedTraining.training_type }}
                        </span>
                    </div>
                    <div *ngIf="selectedTraining.seats">
                        <label class="text-sm font-semibold text-slate-600">Available Seats</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.seats }}</p>
                    </div>
                </div>
            </div>

            <!-- Content Details -->
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-6 border border-amber-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-book-open text-amber-600"></i>
                    Content Details
                </h3>
                <div class="space-y-4">
                    <div *ngIf="selectedTraining.training_topics">
                        <label class="text-sm font-semibold text-slate-600">Training Topics</label>
                        <p class="text-base text-slate-700 mt-1 whitespace-pre-wrap">{{ selectedTraining.training_topics }}</p>
                    </div>
                    <div *ngIf="selectedTraining.prerequisites">
                        <label class="text-sm font-semibold text-slate-600">Prerequisites</label>
                        <p class="text-base text-slate-700 mt-1">{{ selectedTraining.prerequisites }}</p>
                    </div>
                    <div *ngIf="selectedTraining.assessment_details">
                        <label class="text-sm font-semibold text-slate-600">Assessment Details</label>
                        <p class="text-base text-slate-700 mt-1 whitespace-pre-wrap">{{ selectedTraining.assessment_details }}</p>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl p-6 border border-indigo-200">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-chart-bar text-slate-600"></i>
                    Statistics
                </h3>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Assigned Count</label>
                        <p class="text-2xl font-bold text-blue-600 mt-1">{{ selectedTraining.assigned_count }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Attended Count</label>
                        <p class="text-2xl font-bold text-emerald-600 mt-1">{{ selectedTraining.attended_count }}</p>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-slate-600">Completion Rate</label>
                        <p class="text-2xl font-bold text-purple-600 mt-1">{{ selectedTraining.completion_rate }}%</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 flex gap-4">
            <button (click)="openEditTrainingModal(selectedTraining); closeTrainingDetailModal()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                <i class="fa-solid fa-edit mr-2"></i>Edit Training
            </button>
            <button (click)="closeTrainingDetailModal()" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Close
            </button>
        </div>
    </div>
</div>

<!-- Edit Skill Modal -->
<div *ngIf="showEditSkillModal && selectedCompetency" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Edit Skill</h2>
            <button (click)="showEditSkillModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
            <p class="text-sm text-slate-600 mb-1"><strong>Employee:</strong> {{ selectedCompetency.employee_name }}</p>
            <p class="text-sm text-slate-600"><strong>Skill:</strong> {{ selectedCompetency.skill }}</p>
        </div>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Current Expertise</label>
                <input type="text" [(ngModel)]="skillUpdate.current_expertise" placeholder="e.g., L3" 
                       class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Target Expertise</label>
                <input type="text" [(ngModel)]="skillUpdate.target_expertise" placeholder="e.g., L4" 
                       class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
            </div>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="updateSkill()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                Update
            </button>
            <button (click)="showEditSkillModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Create Skill Modal -->
<div *ngIf="showCreateSkillModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-3xl max-h-[90vh] overflow-y-auto" @slideFadeIn>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">Add New Skill</h2>
            <button (click)="showCreateSkillModal = false" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-lg flex items-center justify-center transition-colors">
                <i class="fa-solid fa-times text-slate-600"></i>
            </button>
        </div>
        <div class="space-y-6">
            <!-- Employee Selection -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Employee Information *</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Select Employee</label>
                        <select [(ngModel)]="newCompetency.employee_empid" 
                                (change)="onEmployeeSelected(newCompetency.employee_empid)"
                                class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                            <option value="">-- Select Employee --</option>
                            <option *ngFor="let emp of allEmployees" [value]="emp.username">
                                {{ emp.name }} ({{ emp.username }})
                            </option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Employee Name *</label>
                        <input type="text" [(ngModel)]="newCompetency.employee_name" placeholder="Employee Name" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>
            </fieldset>

            <!-- Skill Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Skill Information *</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Skill Name *</label>
                        <input type="text" [(ngModel)]="newCompetency.skill" placeholder="e.g., Python Programming" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Competency Area</label>
                        <input type="text" [(ngModel)]="newCompetency.competency" placeholder="e.g., Technical Skills" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>
            </fieldset>

            <!-- Expertise Levels -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Expertise Levels *</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Current Expertise *</label>
                        <select [(ngModel)]="newCompetency.current_expertise" 
                                class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                            <option value="">-- Select Level --</option>
                            <option *ngFor="let level of skillCategoryLevels" [value]="level">{{ level }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Target Expertise *</label>
                        <select [(ngModel)]="newCompetency.target_expertise" 
                                class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all bg-white">
                            <option value="">-- Select Level --</option>
                            <option *ngFor="let level of skillCategoryLevels" [value]="level">{{ level }}</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <!-- Additional Information -->
            <fieldset class="border-2 border-indigo-200 rounded-xl p-4">
                <legend class="px-2 text-sm font-semibold text-slate-700">Additional Information (Optional)</legend>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Department</label>
                        <input type="text" [(ngModel)]="newCompetency.department" placeholder="Department" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Division</label>
                        <input type="text" [(ngModel)]="newCompetency.division" placeholder="Division" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Project</label>
                        <input type="text" [(ngModel)]="newCompetency.project" placeholder="Project" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Target Date</label>
                        <input type="date" [(ngModel)]="newCompetency.target_date" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Role-Specific Competency</label>
                        <input type="text" [(ngModel)]="newCompetency.role_specific_comp" placeholder="Role-specific competency" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Destination</label>
                        <input type="text" [(ngModel)]="newCompetency.destination" placeholder="Destination" 
                               class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Comments</label>
                    <textarea [(ngModel)]="newCompetency.comments" placeholder="Additional comments..." rows="3" 
                              class="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>
            </fieldset>
        </div>
        <div class="mt-8 flex gap-4">
            <button (click)="createSkill()" 
                    class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-semibold">
                <i class="fa-solid fa-plus mr-2"></i>Create Skill
            </button>
            <button (click)="showCreateSkillModal = false" 
                    class="flex-1 bg-slate-200 text-slate-800 px-6 py-3 rounded-xl hover:bg-slate-300 transition-all font-semibold">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- ATTENDANCE BREAKDOWN MODAL - ENTERPRISE ANALYTICS DASHBOARD -->
<div *ngIf="showAttendanceModal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-xl flex items-center justify-center z-50 p-4" @fadeIn>
    <div class="bg-white rounded-3xl shadow-2xl max-w-7xl w-full max-h-[95vh] overflow-hidden flex flex-col" @slideFadeIn>
        
        <!-- Premium Header Section -->
        <div class="relative bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white px-10 py-8 overflow-hidden border-b-4 border-blue-500">
            <!-- Animated Background -->
            <div class="absolute inset-0 opacity-20">
                <div class="absolute top-0 left-0 w-96 h-96 bg-blue-400 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
                <div class="absolute bottom-0 right-0 w-96 h-96 bg-cyan-400 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
            </div>
            
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-2xl flex items-center justify-center shadow-2xl">
                            <i class="fa-solid fa-analytics text-3xl"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-black tracking-tight">Attendance Analytics</h1>
                            <p class="text-blue-200 text-sm mt-2 flex items-center gap-2">
                                <i class="fa-solid fa-database"></i>
                                Comprehensive skill-level performance metrics & insights
                            </p>
                        </div>
                    </div>
                    <button (click)="closeAttendanceModal()" 
                            class="w-14 h-14 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-xl transition-all hover:scale-110 duration-300 border border-white/20 flex items-center justify-center">
                        <i class="fa-solid fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Key Metrics Row -->
                <div class="grid grid-cols-4 gap-4">
                    <div class="bg-gradient-to-br from-emerald-400/20 to-green-500/20 backdrop-blur-sm rounded-2xl p-4 border border-emerald-300/30 hover:border-emerald-300/60 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-emerald-200 text-xs font-bold uppercase tracking-wide mb-1">Overall Rate</div>
                                <div class="text-4xl font-black text-white">{{ attendanceRate | number:'1.0-0' }}%</div>
                            </div>
                            <div class="text-5xl text-emerald-300 opacity-30"><i class="fa-solid fa-chart-pie"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-400/20 to-cyan-500/20 backdrop-blur-sm rounded-2xl p-4 border border-blue-300/30 hover:border-blue-300/60 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-blue-200 text-xs font-bold uppercase tracking-wide mb-1">Total Assigned</div>
                                <div class="text-4xl font-black text-white">{{ totalAssignments }}</div>
                            </div>
                            <div class="text-5xl text-blue-300 opacity-30"><i class="fa-solid fa-list-check"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-amber-400/20 to-orange-500/20 backdrop-blur-sm rounded-2xl p-4 border border-amber-300/30 hover:border-amber-300/60 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-amber-200 text-xs font-bold uppercase tracking-wide mb-1">Total Attended</div>
                                <div class="text-4xl font-black text-white">{{ attendedAssignments }}</div>
                            </div>
                            <div class="text-5xl text-amber-300 opacity-30"><i class="fa-solid fa-check-circle"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-violet-400/20 to-purple-500/20 backdrop-blur-sm rounded-2xl p-4 border border-violet-300/30 hover:border-violet-300/60 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-violet-200 text-xs font-bold uppercase tracking-wide mb-1">Skills Count</div>
                                <div class="text-4xl font-black text-white">10</div>
                            </div>
                            <div class="text-5xl text-violet-300 opacity-30"><i class="fa-solid fa-graduation-cap"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-y-auto bg-gradient-to-br from-slate-50 via-blue-50/20 to-slate-50">
            <!-- Loading State -->
            <div *ngIf="attendanceLoading" class="flex flex-col items-center justify-center h-full">
                <div class="relative w-32 h-32 mb-8">
                    <div class="absolute inset-0 rounded-full border-4 border-slate-200"></div>
                    <div class="absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 border-r-blue-600 animate-spin"></div>
                    <div class="absolute inset-2 rounded-full border-4 border-transparent border-b-cyan-500 animate-spin" style="animation-direction: reverse;"></div>
                </div>
                <p class="text-slate-700 font-bold text-xl">Loading Analytics...</p>
                <p class="text-slate-500 text-sm mt-2">Processing skill & level data</p>
            </div>

            <!-- Data Content - TABLE VIEW -->
            <div *ngIf="!attendanceLoading" class="p-8">
                <!-- Professional Table -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                    <!-- Table Header -->
                    <div class="bg-gradient-to-r from-slate-800 to-slate-900 text-white sticky top-0 z-10">
                        <div class="grid grid-cols-12 gap-4 px-8 py-5 font-bold text-sm uppercase tracking-wide">
                            <div class="col-span-1">Rank</div>
                            <div class="col-span-2">Skill Name</div>
                            <div class="col-span-1 text-center">Assigned</div>
                            <div class="col-span-1 text-center">Attended</div>
                            <div class="col-span-1 text-center">Missing</div>
                            <div class="col-span-1 text-center">Rate %</div>
                            <div class="col-span-5 text-center">Level-wise Breakdown (L1 • L2 • L3 • L4 • L5)</div>
                        </div>
                    </div>

                    <!-- Table Rows -->
                    <div *ngIf="getSkillBreakdownEntries().length > 0" class="divide-y divide-slate-200">
                        <ng-container *ngFor="let skill of getSkillBreakdownEntries(); let i = index">
                            <div class="group hover:bg-slate-50 transition-colors duration-200">
                                <!-- Main Row -->
                                <div class="grid grid-cols-12 gap-4 px-8 py-4 items-center border-b border-slate-100 group-hover:bg-blue-50/30">
                                    <!-- Rank -->
                                    <div class="col-span-1">
                                        <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white font-black text-sm shadow-md"
                                             [ngClass]="asAny(skill.value)['status'] === 'good' ? 'bg-gradient-to-br from-emerald-500 to-teal-600' :
                                                        asAny(skill.value)['status'] === 'warning' ? 'bg-gradient-to-br from-amber-500 to-orange-600' :
                                                        asAny(skill.value)['status'] === 'critical' ? 'bg-gradient-to-br from-rose-500 to-red-600' : 
                                                        'bg-gradient-to-br from-slate-500 to-slate-600'">
                                            {{ (i + 1) < 10 ? '0' : '' }}{{ i + 1 }}
                                        </div>
                                    </div>

                                    <!-- Skill Name -->
                                    <div class="col-span-2">
                                        <div class="font-bold text-slate-900 text-sm">{{ asAny(skill.value)['skill'] }}</div>
                                        <div class="text-xs text-slate-500 mt-1">
                                            <span class="inline-block px-2 py-1 rounded-full text-[10px] font-bold"
                                                  [ngClass]="asAny(skill.value)['status'] === 'good' ? 'bg-emerald-100 text-emerald-700' :
                                                             asAny(skill.value)['status'] === 'warning' ? 'bg-amber-100 text-amber-700' :
                                                             asAny(skill.value)['status'] === 'critical' ? 'bg-rose-100 text-rose-700' : 'bg-slate-100 text-slate-700'">
                                                {{ asAny(skill.value)['status'] | uppercase }}
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Assigned Count -->
                                    <div class="col-span-1 text-center">
                                        <div class="text-lg font-black text-blue-600">{{ asAny(skill.value)['total_assigned'] }}</div>
                                        <div class="text-xs text-slate-500">assigned</div>
                                    </div>

                                    <!-- Attended Count -->
                                    <div class="col-span-1 text-center">
                                        <div class="text-lg font-black text-emerald-600">{{ asAny(skill.value)['total_attended'] }}</div>
                                        <div class="text-xs text-slate-500">attended</div>
                                    </div>

                                    <!-- Missing Count -->
                                    <div class="col-span-1 text-center">
                                        <div class="text-lg font-black text-rose-600">{{ asAny(skill.value)['total_assigned'] - asAny(skill.value)['total_attended'] }}</div>
                                        <div class="text-xs text-slate-500">missing</div>
                                    </div>

                                    <!-- Attendance Rate -->
                                    <div class="col-span-1 text-center">
                                        <div class="text-2xl font-black"
                                             [ngClass]="asAny(skill.value)['attendance_rate'] >= 80 ? 'text-emerald-600' : asAny(skill.value)['attendance_rate'] >= 60 ? 'text-amber-600' : 'text-rose-600'">
                                            {{ asAny(skill.value)['attendance_rate'] | number:'1.0-0' }}%
                                        </div>
                                        <div class="w-full h-1.5 bg-slate-200 rounded-full overflow-hidden mt-2 shadow-inner">
                                            <div class="h-full rounded-full transition-all duration-500"
                                                 [ngClass]="asAny(skill.value)['attendance_rate'] >= 80 ? 'bg-emerald-500' : asAny(skill.value)['attendance_rate'] >= 60 ? 'bg-amber-500' : 'bg-rose-500'"
                                                 [style.width.%]="asAny(skill.value)['attendance_rate']"></div>
                                        </div>
                                    </div>

                                    <!-- Level-wise Breakdown -->
                                    <div class="col-span-5">
                                        <div class="flex items-center justify-between gap-2 px-3">
                                            <ng-container *ngFor="let level of ['L1', 'L2', 'L3', 'L4', 'L5']; let levelIdx = index">
                                                <div *ngIf="asAny(skill.value)['levels'] && asAny(skill.value)['levels'][level]"
                                                     class="flex flex-col items-center gap-1 flex-1 p-2 rounded-lg hover:bg-slate-100 transition-colors group/level cursor-pointer"
                                                     title="{{ level }}: {{ asAny(skill.value)['levels'][level]['attendance_rate'] | number:'1.0-0' }}% ({{ asAny(skill.value)['levels'][level]['total_attended'] }}/{{ asAny(skill.value)['levels'][level]['total_assigned'] }})">
                                                    <div class="text-xs font-bold text-slate-700">{{ level }}</div>
                                                    <div class="w-6 h-6 rounded-lg flex items-center justify-center text-white font-bold text-xs shadow-md"
                                                         [ngClass]="levelIdx === 0 ? 'bg-blue-500' :
                                                                    levelIdx === 1 ? 'bg-cyan-500' :
                                                                    levelIdx === 2 ? 'bg-indigo-500' :
                                                                    levelIdx === 3 ? 'bg-purple-500' : 'bg-rose-500'">
                                                        {{ asAny(skill.value)['levels'][level]['attendance_rate'] | number:'1.0-0' }}
                                                    </div>
                                                    <div class="text-[10px] text-slate-600">{{ asAny(skill.value)['levels'][level]['total_attended'] }}/{{ asAny(skill.value)['levels'][level]['total_assigned'] }}</div>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>

                    <!-- Empty State -->
                    <div *ngIf="getSkillBreakdownEntries().length === 0" class="flex flex-col items-center justify-center py-20 px-8">
                        <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mb-6">
                            <i class="fa-solid fa-inbox text-4xl text-slate-400"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800">No Data Available</h3>
                        <p class="text-slate-500 text-center mt-2">No training assignments have been created yet.</p>
                    </div>
                </div>

                <!-- No Data State -->
                <div *ngIf="getSkillBreakdownEntries().length === 0" class="flex flex-col items-center justify-center py-32">
                    <div class="w-40 h-40 bg-gradient-to-br from-slate-200 to-slate-300 rounded-full flex items-center justify-center mb-8 shadow-inner">
                        <i class="fa-solid fa-inbox text-6xl text-slate-400"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">No Data Available</h3>
                    <p class="text-slate-600 text-center max-w-md text-lg">No training assignments have been created yet. Begin assigning trainings to view analytics.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gradient-to-r from-slate-900 to-slate-800 text-white px-10 py-6 border-t-4 border-blue-500 flex justify-between items-center">
            <div class="flex items-center gap-4 text-sm">
                <div class="flex items-center gap-2">
                    <div class="w-2.5 h-2.5 bg-emerald-400 rounded-full animate-pulse"></div>
                    <span class="font-medium">Real-time Sync Active</span>
                </div>
                <span class="text-slate-400">|</span>
                <span class="text-slate-400">Last Updated: <span class="text-white font-semibold">Just Now</span></span>
            </div>
            <button (click)="closeAttendanceModal()" 
                    class="group bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-8 py-3 rounded-xl font-bold transition-all hover:shadow-2xl hover:scale-105 flex items-center gap-3 border-2 border-transparent hover:border-blue-400 shadow-lg">
                <i class="fa-solid fa-check-circle text-lg group-hover:scale-125 transition-transform"></i>
                <span>Close Analytics</span>
            </button>
        </div>
    </div>
</div>
